{"version":3,"file":"Portal.js","sources":["../../src/common/Portal.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useMemo, useImperativeHandle } from 'react';\nimport { createPortal } from 'react-dom';\nimport { AttachNode, AttachNodeReturnValue } from '../common';\nimport { canUseDocument } from '../_util/dom';\nimport useConfig from '../hooks/useConfig';\n\nexport interface PortalProps {\n  /**\n   * 指定挂载的 HTML 节点, false 为挂载在 body\n   */\n  attach?: React.ReactElement | AttachNode | boolean;\n  /**\n   * 触发元素\n   */\n  triggerNode?: HTMLElement;\n  children: React.ReactNode;\n}\n\nexport function getAttach(attach: PortalProps['attach']) {\n  if (!canUseDocument) return null;\n\n  let parent: AttachNodeReturnValue;\n  if (typeof attach === 'string') {\n    parent = document.querySelector(attach);\n  }\n  if (typeof attach === 'function') {\n    parent = attach();\n  }\n  if (typeof attach === 'object' && attach instanceof window.HTMLElement) {\n    parent = attach;\n  }\n  return parent || document.body;\n}\n\nconst Portal = forwardRef((props: PortalProps, ref) => {\n  const { attach, children, triggerNode } = props;\n  const { classPrefix } = useConfig();\n\n  const container = useMemo(() => {\n    if (!canUseDocument) return null;\n    const el = document.createElement('div');\n    el.className = `${classPrefix}-portal-wrapper`;\n    return el;\n  }, [classPrefix]);\n\n  useEffect(() => {\n    let parentElement = document.body;\n    let el = null;\n\n    // 处理 attach\n    if (typeof attach === 'function') {\n      el = attach(triggerNode);\n    } else if (typeof attach === 'string') {\n      el = document.querySelector(attach);\n    }\n\n    // fix el in iframe\n    if (el && el.nodeType === 1) {\n      parentElement = el;\n    }\n\n    parentElement.appendChild(container);\n\n    return () => {\n      parentElement?.removeChild(container);\n    };\n  }, [container, attach, triggerNode]);\n\n  useImperativeHandle(ref, () => container);\n\n  return canUseDocument ? createPortal(children, container) : null;\n});\n\nPortal.displayName = 'Portal';\n\nexport default Portal;\n"],"names":["getAttach","attach","canUseDocument","parent","document","querySelector","window","HTMLElement","body","Portal","forwardRef","props","ref","children","triggerNode","useConfig","classPrefix","container","useMemo","el","createElement","className","useEffect","parentElement","nodeType","appendChild","removeChild","useImperativeHandle","createPortal","displayName"],"mappings":"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"}