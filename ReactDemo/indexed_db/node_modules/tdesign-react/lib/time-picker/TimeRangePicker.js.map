{"version":3,"file":"TimeRangePicker.js","sources":["../../src/time-picker/TimeRangePicker.tsx"],"sourcesContent":["import React, { FC, useState, useEffect } from 'react';\nimport classNames from 'classnames';\n\nimport { TimeIcon as TdTimeIcon } from 'tdesign-icons-react';\nimport noop from '../_util/noop';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport { RangeInputPopup, RangeInputPosition } from '../range-input';\nimport TimePickerPanel from './panel/TimePickerPanel';\n\nimport { useTimePickerTextConfig } from './hooks/useTimePickerTextConfig';\nimport { formatInputValue, validateInputValue } from '../_common/js/time-picker/utils';\nimport { TIME_PICKER_EMPTY } from '../_common/js/time-picker/const';\n\nimport { TdTimeRangePickerProps, TimeRangeValue, TimeRangePickerPartial } from './type';\nimport { StyledProps } from '../common';\nimport { timeRangePickerDefaultProps } from './defaultProps';\n\nexport interface TimeRangePickerProps extends TdTimeRangePickerProps, StyledProps {}\n\nconst defaultArrVal = [undefined, undefined];\n\nconst TimeRangePicker: FC<TimeRangePickerProps> = (props) => {\n  const TEXT_CONFIG = useTimePickerTextConfig();\n\n  const {\n    allowInput,\n    clearable,\n    disabled,\n    format,\n    hideDisabledTime,\n    placeholder = TEXT_CONFIG.rangePlaceholder,\n    size,\n    steps,\n    disableTime,\n    onBlur = noop,\n    onFocus = noop,\n    onInput = noop,\n    style,\n    className,\n  } = props;\n\n  const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n  const { classPrefix } = useConfig();\n  const { TimeIcon } = useGlobalIcon({\n    TimeIcon: TdTimeIcon,\n  });\n  const [isPanelShowed, setPanelShow] = useState(false);\n  const [currentPanelIdx, setCurrentPanelIdx] = useState(undefined);\n  const [currentValue, setCurrentValue] = useState(['', '']);\n\n  const name = `${classPrefix}-time-picker`;\n\n  const inputClasses = classNames(`${name}__group`, {\n    [`${classPrefix}-is-focused`]: isPanelShowed,\n  });\n\n  const handleShowPopup = (visible: boolean) => {\n    setPanelShow(visible);\n  };\n\n  const handleClear = (context: { e: React.MouseEvent }) => {\n    const { e } = context;\n    e.stopPropagation();\n    onChange(undefined);\n  };\n\n  const handleClick = ({ position }: { position: 'first' | 'second' }) => {\n    setCurrentPanelIdx(position === 'first' ? 0 : 1);\n  };\n\n  const handleTimeChange = (newValue: string) => {\n    if (currentPanelIdx === 0) {\n      setCurrentValue([newValue, currentValue[1] ?? newValue]);\n    } else {\n      setCurrentValue([currentValue[0] ?? newValue, newValue]);\n    }\n  };\n\n  const handleInputBlur = (value: TimeRangeValue, { e }: { e: React.FocusEvent<HTMLInputElement> }) => {\n    if (allowInput) {\n      const isValidTime = validateInputValue(currentValue[currentPanelIdx], format);\n      if (isValidTime) {\n        const formattedVal = formatInputValue(currentValue[currentPanelIdx], format);\n        currentPanelIdx === 0\n          ? setCurrentValue([formattedVal, currentValue[1] ?? formattedVal])\n          : setCurrentValue([currentValue[0] ?? formattedVal, formattedVal]);\n      }\n    }\n    onBlur({ value, e });\n  };\n\n  const handleInputChange = (\n    inputVal: TimeRangeValue,\n    { e, position }: { e: React.FocusEvent<HTMLInputElement>; position: RangeInputPosition },\n  ) => {\n    setCurrentValue(inputVal);\n    onInput({ value, e, position: position as TimeRangePickerPartial });\n  };\n\n  const handleClickConfirm = () => {\n    const isValidTime = !currentValue.find((v) => !validateInputValue(v, format));\n    if (isValidTime) onChange(currentValue);\n    setPanelShow(false);\n  };\n\n  const handleFocus = (\n    value: TimeRangeValue,\n    { e, position }: { e: React.FocusEvent<HTMLInputElement>; position: RangeInputPosition },\n  ) => {\n    onFocus({ value, e, position: position as TimeRangePickerPartial });\n  };\n\n  useEffect(() => {\n    setCurrentValue(isPanelShowed ? value ?? TIME_PICKER_EMPTY : defaultArrVal);\n    if (!isPanelShowed) setCurrentPanelIdx(undefined);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isPanelShowed]);\n\n  return (\n    <div className={classNames(name, className)} style={style}>\n      <RangeInputPopup\n        style={style}\n        disabled={disabled}\n        popupVisible={isPanelShowed}\n        onPopupVisibleChange={handleShowPopup}\n        popupProps={{\n          overlayInnerStyle: {\n            width: 'auto',\n          },\n          ...props.popupProps,\n        }}\n        onInputChange={handleInputChange}\n        inputValue={isPanelShowed ? currentValue : value ?? defaultArrVal}\n        rangeInputProps={{\n          size,\n          clearable,\n          className: inputClasses,\n          value: isPanelShowed ? currentValue : value ?? undefined,\n          placeholder,\n          suffixIcon: <TimeIcon />,\n          onClear: handleClear,\n          onClick: handleClick,\n          onFocus: handleFocus,\n          onBlur: handleInputBlur,\n          readonly: !allowInput,\n          activeIndex: currentPanelIdx,\n          ...props.rangeInputProps,\n        }}\n        panel={\n          <TimePickerPanel\n            steps={steps}\n            format={format}\n            disableTime={disableTime}\n            isShowPanel={isPanelShowed}\n            hideDisabledTime={hideDisabledTime}\n            isFooterDisplay={true}\n            value={currentValue[currentPanelIdx || 0]}\n            onChange={handleTimeChange}\n            handleConfirmClick={handleClickConfirm}\n            position={currentPanelIdx === 0 ? 'start' : 'end'}\n          />\n        }\n      />\n    </div>\n  );\n};\n\nTimeRangePicker.displayName = 'TimeRangePicker';\nTimeRangePicker.defaultProps = timeRangePickerDefaultProps;\n\nexport default TimeRangePicker;\n"],"names":["defaultArrVal","TimeRangePicker","props","TEXT_CONFIG","useTimePickerTextConfig","allowInput","clearable","disabled","format","hideDisabledTime","placeholder","rangePlaceholder","size","steps","disableTime","onBlur","noop","onFocus","onInput","style","className","useControlled","onChange","value","useConfig","classPrefix","useGlobalIcon","TimeIcon","TdTimeIcon","useState","isPanelShowed","setPanelShow","currentPanelIdx","setCurrentPanelIdx","currentValue","setCurrentValue","name","inputClasses","classNames","handleShowPopup","visible","handleClear","context","e","stopPropagation","handleClick","position","handleTimeChange","newValue","handleInputBlur","isValidTime","validateInputValue","formattedVal","formatInputValue","handleInputChange","inputVal","handleClickConfirm","find","v","handleFocus","useEffect","TIME_PICKER_EMPTY","React","createElement","RangeInputPopup","popupVisible","onPopupVisibleChange","popupProps","overlayInnerStyle","width","onInputChange","inputValue","rangeInputProps","suffixIcon","onClear","onClick","readonly","activeIndex","panel","TimePickerPanel","isShowPanel","isFooterDisplay","handleConfirmClick","displayName","defaultProps","timeRangePickerDefaultProps"],"mappings":"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"}