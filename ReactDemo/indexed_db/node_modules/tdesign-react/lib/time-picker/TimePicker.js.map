{"version":3,"file":"TimePicker.js","sources":["../../src/time-picker/TimePicker.tsx"],"sourcesContent":["import React, { useState, Ref, useEffect } from 'react';\nimport classNames from 'classnames';\nimport dayjs from 'dayjs';\nimport customParseFormat from 'dayjs/plugin/customParseFormat';\nimport { TimeIcon as TdTimeIcon } from 'tdesign-icons-react';\n\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport noop from '../_util/noop';\n\nimport SelectInput from '../select-input';\nimport TimeRangePicker from './TimeRangePicker';\nimport TimePickerPanel from './panel/TimePickerPanel';\n\nimport { useTimePickerTextConfig } from './hooks/useTimePickerTextConfig';\n\nimport { StyledProps } from '../common';\nimport { TdTimePickerProps } from './type';\nimport { formatInputValue, validateInputValue } from '../_common/js/time-picker/utils';\nimport { DEFAULT_STEPS, DEFAULT_FORMAT } from '../_common/js/time-picker/const';\nimport { timePickerDefaultProps } from './defaultProps';\n\n// https://github.com/iamkun/dayjs/issues/1552\ndayjs.extend(customParseFormat);\n\nexport interface TimePickerProps extends TdTimePickerProps, StyledProps {}\n\nconst TimePicker = forwardRefWithStatics(\n  (props: TimePickerProps, ref: Ref<HTMLDivElement>) => {\n    const TEXT_CONFIG = useTimePickerTextConfig();\n    const {\n      allowInput,\n      className,\n      clearable,\n      disabled,\n      style,\n      format = DEFAULT_FORMAT,\n      hideDisabledTime = true,\n      steps = DEFAULT_STEPS,\n      placeholder = TEXT_CONFIG.placeholder,\n      disableTime,\n      onBlur = noop,\n      onClose = noop,\n      onFocus = noop,\n      onOpen = noop,\n    } = props;\n\n    const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n    const [isPanelShowed, setPanelShow] = useState(false);\n    const [currentValue, setCurrentValue] = useState('');\n\n    const { classPrefix } = useConfig();\n    const { TimeIcon } = useGlobalIcon({\n      TimeIcon: TdTimeIcon,\n    });\n    const name = `${classPrefix}-time-picker`;\n    const inputClasses = classNames(`${name}__group`, {\n      [`${classPrefix}-is-focused`]: isPanelShowed,\n    });\n\n    const handleShowPopup = (visible: boolean, context: { e: React.MouseEvent<HTMLDivElement, MouseEvent> }) => {\n      setPanelShow(visible);\n      visible ? onOpen(context) : onClose(context); // trigger on-open and on-close\n    };\n\n    const handleClear = (context: { e: React.MouseEvent }) => {\n      const { e } = context;\n      e.stopPropagation();\n      setCurrentValue('');\n      onChange(null);\n    };\n\n    const handleInputChange = (value: string) => {\n      setCurrentValue(value);\n    };\n\n    const handleInputBlur = (value: string, { e }: { e: React.FocusEvent<HTMLInputElement> }) => {\n      if (allowInput) {\n        const isValidTime = validateInputValue(currentValue, format);\n        if (isValidTime) {\n          onChange(formatInputValue(currentValue, format));\n        }\n      }\n      onBlur({ value, e });\n    };\n\n    const handleClickConfirm = () => {\n      const isValidTime = validateInputValue(currentValue, format);\n      if (isValidTime) onChange(currentValue);\n      setPanelShow(false);\n    };\n\n    useEffect(() => {\n      setCurrentValue(isPanelShowed ? value ?? '' : '');\n    }, [isPanelShowed, value]);\n\n    return (\n      <div className={classNames(name, className)} ref={ref} style={style}>\n        <SelectInput\n          onFocus={onFocus}\n          onClear={handleClear}\n          disabled={disabled}\n          clearable={clearable}\n          allowInput={allowInput}\n          className={inputClasses}\n          suffixIcon={<TimeIcon />}\n          popupVisible={isPanelShowed}\n          onInputChange={handleInputChange}\n          onBlur={handleInputBlur}\n          onPopupVisibleChange={handleShowPopup}\n          placeholder={!value ? placeholder : undefined}\n          value={isPanelShowed ? currentValue : value ?? undefined}\n          inputValue={isPanelShowed ? currentValue : value ?? undefined}\n          inputProps={props.inputProps}\n          popupProps={{ overlayInnerStyle: { width: 'auto' }, ...props.popupProps }}\n          panel={\n            <TimePickerPanel\n              steps={steps}\n              format={format}\n              value={currentValue}\n              isFooterDisplay={true}\n              isShowPanel={isPanelShowed}\n              disableTime={disableTime}\n              onChange={setCurrentValue}\n              hideDisabledTime={hideDisabledTime}\n              handleConfirmClick={handleClickConfirm}\n            />\n          }\n        />\n      </div>\n    );\n  },\n  {\n    TimeRangePicker,\n    TimePickerPanel,\n  },\n);\n\nTimePicker.displayName = 'TimePicker';\nTimePicker.defaultProps = timePickerDefaultProps;\n\nexport default TimePicker;\n"],"names":["dayjs","extend","customParseFormat","TimePicker","forwardRefWithStatics","props","ref","TEXT_CONFIG","useTimePickerTextConfig","allowInput","className","clearable","disabled","style","format","DEFAULT_FORMAT","hideDisabledTime","steps","DEFAULT_STEPS","placeholder","disableTime","onBlur","noop","onClose","onFocus","onOpen","useControlled","onChange","value","useState","isPanelShowed","setPanelShow","currentValue","setCurrentValue","useConfig","classPrefix","useGlobalIcon","TimeIcon","TdTimeIcon","name","inputClasses","classNames","handleShowPopup","visible","context","handleClear","e","stopPropagation","handleInputChange","handleInputBlur","isValidTime","validateInputValue","formatInputValue","handleClickConfirm","useEffect","React","createElement","SelectInput","onClear","suffixIcon","popupVisible","onInputChange","onPopupVisibleChange","inputValue","inputProps","popupProps","overlayInnerStyle","width","panel","TimePickerPanel","isFooterDisplay","isShowPanel","handleConfirmClick","TimeRangePicker","displayName","defaultProps","timePickerDefaultProps"],"mappings":"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"}