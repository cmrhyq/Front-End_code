{"version":3,"file":"useMultiple.js","sources":["../../src/select-input/useMultiple.tsx"],"sourcesContent":["import React, { useRef, MouseEvent } from 'react';\nimport isObject from 'lodash/isObject';\nimport classNames from 'classnames';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys } from './type';\nimport TagInput, { TagInputValue } from '../tag-input';\nimport { SelectInputCommonProperties } from './interface';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../hooks/useConfig';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent<SVGElement> }) => void;\n  popupVisible: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport default function useMultiple(props: TdSelectInputProps) {\n  const { value } = props;\n  const { classPrefix } = useConfig();\n  const tagInputRef = useRef();\n  const [tInputValue, setTInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n  const iKeys: SelectInputKeys = { ...DEFAULT_KEYS, ...props.keys };\n\n  const getTags = () => {\n    if (!(value instanceof Array)) {\n      return isObject(value) ? [value[iKeys.label]] : [value];\n    }\n    return value.map((item) => (isObject(item) ? item[iKeys.label] : item));\n  };\n  const tags = getTags();\n\n  const tPlaceholder = !tags || !tags.length ? props.placeholder : '';\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n  };\n\n  const renderSelectMultiple = (p: RenderSelectMultipleParams) => (\n    <TagInput\n      ref={tagInputRef}\n      {...p.commonInputProps}\n      autoWidth={props.autoWidth}\n      readonly={props.readonly}\n      minCollapsedNum={props.minCollapsedNum}\n      collapsedItems={props.collapsedItems}\n      tag={props.tag}\n      valueDisplay={props.valueDisplay}\n      placeholder={tPlaceholder}\n      value={tags}\n      inputValue={tInputValue || ''}\n      onChange={onTagInputChange}\n      onInputChange={(val, context) => {\n        // 筛选器统一特性：筛选器按下回车时不清空输入框\n        if (context?.trigger === 'enter') return;\n        setTInputValue(val, { trigger: context.trigger, e: context.e });\n      }}\n      tagProps={props.tagProps}\n      onClear={p.onInnerClear}\n      onBlur={(val, context) => {\n        props.onBlur?.(props.value, { ...context, tagInputValue: val });\n      }}\n      onFocus={(val, context) => {\n        props.onFocus?.(props.value, { ...context, tagInputValue: val });\n      }}\n      {...props.tagInputProps}\n      inputProps={{\n        readonly: !props.allowInput || props.readonly,\n        inputClass: classNames(props.tagInputProps?.className, {\n          [`${classPrefix}-input--focused`]: p.popupVisible,\n        }),\n      }}\n    />\n  );\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","value","useConfig","classPrefix","tagInputRef","useRef","useControlled","onInputChange","tInputValue","setTInputValue","iKeys","keys","getTags","Array","isObject","map","item","tags","tPlaceholder","length","placeholder","onTagInputChange","val","context","trigger","e","stopPropagation","onTagChange","renderSelectMultiple","p","React","createElement","TagInput","ref","commonInputProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","inputValue","onChange","tagProps","onClear","onInnerClear","onBlur","tagInputValue","onFocus","tagInputProps","inputProps","allowInput","inputClass","classNames","className","popupVisible"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAeA,IAAMA,YAAe,GAAA;AACnBC,EAAAA,KAAO,EAAA,OADY;AAEnBC,EAAAA,GAAK,EAAA,KAFc;AAGnBC,EAAAA,QAAU,EAAA,UAAA;AAHS,CAArB,CAAA;AAMA,SAAwBC,WAAxB,CAAoCC,KAApC,EAA+D;AACvD,EAAA,IAAEC,KAAF,GAAYD,KAAZ,CAAEC,KAAF,CAAA;;AACA,EAAA,IAAA,UAAA,GAAkBC,SAAU,EAA5B;MAAEC,WAAF,cAAEA,WAAF,CAAA;;EACN,IAAMC,cAAcC,MAAO,EAA3B,CAAA;;EACM,IAAgCC,cAAAA,GAAAA,cAAcN,OAAO,cAAcA,MAAMO,cAAzE;AAAA,MAAA,eAAA,GAAA,cAAA,CAAA,cAAA,EAAA,CAAA,CAAA;AAAA,MAACC,WAAD,GAAA,eAAA,CAAA,CAAA,CAAA;AAAA,MAAcC,cAAd,GAAA,eAAA,CAAA,CAAA,CAAA,CAAA;;AACN,EAAA,IAAMC,QAA8Bf,aAAAA,CAAAA,aAAAA,CAAAA,EAAAA,EAAAA,eAAiBK,MAAMW,KAA3D,CAAA;;AAEA,EAAA,IAAMC,UAAU,SAAVA,OAAU,GAAM;AAChB,IAAA,IAAA,EAAEX,iBAAiBY,KAAnB,CAAA,EAA2B;AACtB,MAAA,OAAAC,UAAA,CAASb,KAAT,CAAA,GAAkB,CAACA,MAAMS,KAAM,CAAAd,MAAb,CAAlB,GAAyC,CAACK,KAAD,CAAzC,CAAA;AACT,KAAA;;AACO,IAAA,OAAAA,KAAA,CAAMc,GAAN,CAAU,UAACC,IAAD,EAAA;AAAA,MAAA,OAAWF,UAAA,CAASE,IAAT,CAAA,GAAiBA,IAAA,CAAKN,KAAM,CAAAd,KAAX,CAAjB,GAAqCoB,IAAhD,CAAA;AAAA,KAAV,CAAA,CAAA;GAJT,CAAA;;EAMA,IAAMC,OAAOL,OAAQ,EAArB,CAAA;AAEA,EAAA,IAAMM,eAAe,CAACD,IAAD,IAAS,CAACA,IAAK,CAAAE,MAAf,GAAwBnB,MAAMoB,WAA9B,GAA4C,EAAjE,CAAA;;EAEM,IAAAC,gBAAA,GAAmB,SAAnBA,gBAAmB,CAACC,GAAD,EAAqBC,OAArB,EAA2D;AAAA,IAAA,IAAA,kBAAA,CAAA;;AAE9E,IAAA,IAAAA,OAAA,CAAQC,OAAR,KAAoB,YAApB,EAAkC;AAAA,MAAA,IAAA,UAAA,CAAA;;AACpC,MAAA,CAAA,UAAA,GAAAD,OAAA,CAAQE,CAAR,MAAA,IAAA,IAAA,UAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,UAAA,CAAWC,eAAX,EAAA,CAAA;AACF,KAAA;;IACM,CAAA1B,kBAAAA,GAAAA,KAAA,CAAA2B,WAAA,MAAA,IAAA,IAAA,kBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,kBAAA,CAAA,IAAA,CAAA3B,KAAA,EAAcsB,GAAd,EAAmBC,OAAnB,CAAA,CAAA;GALF,CAAA;;AAQA,EAAA,IAAAK,oBAAA,GAAuB,SAAvBA,oBAAuB,CAACC,CAAD,EAAA;AAAA,IAAA,IAAA,oBAAA,CAAA;;AAAA,IAAA,sBAC1BC,KAAA,CAAAC,aAAA,CAAAC,QAAA,EAAA,aAAA,CAAA,aAAA,CAAA,aAAA,CAAA;AACCC,MAAAA,GAAK,EAAA7B,WAAAA;KACDyB,EAAAA,CAAE,CAAAK,gBAFP,CAAA,EAAA,EAAA,EAAA;MAGCC,WAAWnC,KAAM,CAAAmC,SAHlB;MAICC,UAAUpC,KAAM,CAAAoC,QAJjB;MAKCC,iBAAiBrC,KAAM,CAAAqC,eALxB;MAMCC,gBAAgBtC,KAAM,CAAAsC,cANvB;MAOCC,KAAKvC,KAAM,CAAAuC,GAPZ;MAQCC,cAAcxC,KAAM,CAAAwC,YARrB;AASCpB,MAAAA,WAAa,EAAAF,YATd;AAUCjB,MAAAA,KAAO,EAAAgB,IAVR;MAWCwB,YAAYjC,WAAe,IAAA,EAX5B;AAYCkC,MAAAA,QAAU,EAAArB,gBAZX;AAaCd,MAAAA,aAAA,EAAe,SAAA,aAAA,CAACe,GAAD,EAAMC,OAAN,EAAkB;AAE/B,QAAA,IAAI,CAAAA,YAAA,IAAA,IAAAA,kBAAA,GAAAA,KAAAA,CAAAA,GAAAA,QAASC,OAAT,MAAqB,OAAzB,EAAkC,OAAA;QACnBf,cAAA,CAAAa,GAAA,EAAK;UAAEE,OAAS,EAAAD,OAAA,CAAQC,OAAnB;UAA4BC,CAAG,EAAAF,OAAA,CAAQE,CAAAA;AAAvC,SAAL,CAAA,CAAA;OAhBlB;MAkBCkB,UAAU3C,KAAM,CAAA2C,QAlBjB;MAmBCC,SAASf,CAAE,CAAAgB,YAnBZ;AAoBCC,MAAAA,MAAA,EAAQ,SAAA,MAAA,CAACxB,GAAD,EAAMC,OAAN,EAAkB;AAAA,QAAA,IAAA,aAAA,CAAA;;QAClB,CAAAvB,aAAAA,GAAAA,KAAA,CAAA8C,MAAA,MAAA9C,IAAAA,IAAAA,aAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,aAAAA,CAAAA,IAAAA,CAAAA,KAAA,EAASA,MAAMC,KAAf,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAA2BsB,OAA3B,CAAA,EAAA,EAAA,EAAA;AAAoCwB,UAAAA,aAAA,EAAezB,GAAAA;SAAnD,CAAA,CAAA,CAAA;OArBT;AAuBC0B,MAAAA,OAAA,EAAS,SAAA,OAAA,CAAC1B,GAAD,EAAMC,OAAN,EAAkB;AAAA,QAAA,IAAA,cAAA,CAAA;;QACnB,CAAAvB,cAAAA,GAAAA,KAAA,CAAAgD,OAAA,MAAAhD,IAAAA,IAAAA,cAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,cAAAA,CAAAA,IAAAA,CAAAA,KAAA,EAAUA,MAAMC,KAAhB,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAA4BsB,OAA5B,CAAA,EAAA,EAAA,EAAA;AAAqCwB,UAAAA,aAAA,EAAezB,GAAAA;SAApD,CAAA,CAAA,CAAA;AACR,OAAA;KACItB,EAAAA,KAAM,CAAAiD,aA1BX,CAAA,EAAA,EAAA,EAAA;AA2BCC,MAAAA,UAAY,EAAA;QACVd,QAAU,EAAA,CAACpC,KAAM,CAAAmD,UAAP,IAAqBnD,KAAM,CAAAoC,QAD3B;AAEVgB,QAAAA,UAAY,EAAAC,UAAA,CAAWrD,CAAAA,oBAAAA,GAAAA,KAAM,CAAAiD,aAAjB,MAAA,IAAA,IAAA,oBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAW,oBAAqBK,CAAAA,SAAhC,EACNnD,eAAAA,CAAAA,EAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WADM,EACyB0B,iBAAAA,CAAAA,EAAAA,CAAE,CAAA0B,YAD3B,CAAA,CAAA;AAFF,OAAA;KA5Ba,CAAA,CAAA,CAAA;GAAvB,CAAA;;EAqCC,OAAA;AACLtC,IAAAA,IAAA,EAAAA,IADK;AAELC,IAAAA,YAAA,EAAAA,YAFK;AAGLd,IAAAA,WAAA,EAAAA,WAHK;AAILwB,IAAAA,oBAAA,EAAAA,oBAAAA;GAJK,CAAA;AAMT;;;;"}