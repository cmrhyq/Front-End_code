{"version":3,"file":"useSingle.js","sources":["../../src/select-input/useSingle.tsx"],"sourcesContent":["import React, { useRef, MouseEvent, FormEvent, useMemo } from 'react';\nimport isObject from 'lodash/isObject';\nimport pick from 'lodash/pick';\nimport classNames from 'classnames';\nimport { SelectInputCommonProperties } from './interface';\nimport Input, { InputValue } from '../input';\nimport { TdSelectInputProps } from './type';\nimport { Loading } from '../loading';\nimport useConfig from '../hooks/useConfig';\nimport useControlled from '../hooks/useControlled';\n\nexport interface RenderSelectSingleInputParams {\n  tPlaceholder: string;\n}\n\n// single 和 multiple 共有特性\nconst COMMON_PROPERTIES = [\n  'status',\n  'clearable',\n  'disabled',\n  'label',\n  'placeholder',\n  'readonly',\n  'suffix',\n  'suffixIcon',\n  'onPaste',\n  'onEnter',\n  'onMouseenter',\n  'onMouseleave',\n];\n\nconst DEFAULT_KEYS: TdSelectInputProps['keys'] = {\n  label: 'label',\n  value: 'value',\n};\n\nfunction getInputValue(value: TdSelectInputProps['value'], keys: TdSelectInputProps['keys']) {\n  const iKeys = keys || DEFAULT_KEYS;\n  return isObject(value) ? value[iKeys.label] : value;\n}\n\nexport default function useSingle(props: TdSelectInputProps) {\n  const { value, keys, loading, disabled } = props;\n  const { classPrefix } = useConfig();\n  const inputRef = useRef();\n  const [inputValue, setInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n\n  const showLoading = useMemo(() => !disabled && loading, [loading, disabled]);\n\n  const commonInputProps: SelectInputCommonProperties = {\n    ...pick(props, COMMON_PROPERTIES),\n    suffixIcon: showLoading ? <Loading loading size=\"small\" /> : props.suffixIcon,\n  };\n\n  const onInnerClear = (context: { e: MouseEvent<SVGElement> }) => {\n    context?.e?.stopPropagation();\n    props.onClear?.(context);\n    setInputValue('', { trigger: 'clear' });\n  };\n\n  const onInnerInputChange = (\n    value: InputValue,\n    context: { e: FormEvent<HTMLInputElement> | MouseEvent<HTMLElement | SVGElement> },\n  ) => {\n    if (props.allowInput) {\n      setInputValue(value, { ...context, trigger: 'input' });\n    }\n  };\n\n  const renderSelectSingle = (popupVisible: boolean) => {\n    // 单选，值的呈现方式\n    const singleValueDisplay = !props.multiple ? props.valueDisplay : null;\n    const displayedValue = popupVisible && props.allowInput ? inputValue : getInputValue(value, keys);\n    return (\n      <Input\n        ref={inputRef}\n        {...commonInputProps}\n        autoWidth={props.autoWidth}\n        placeholder={singleValueDisplay ? '' : props.placeholder}\n        value={singleValueDisplay ? undefined : displayedValue}\n        label={\n          <>\n            {props.label}\n            {singleValueDisplay}\n          </>\n        }\n        onChange={onInnerInputChange}\n        readonly={!props.allowInput}\n        onClear={onInnerClear}\n        onBlur={(val, context) => {\n          props.onBlur?.(value, { ...context, inputValue: val });\n        }}\n        onFocus={(val, context) => {\n          props.onFocus?.(value, { ...context, inputValue: val });\n          !popupVisible && setInputValue(getInputValue(value, keys), { ...context, trigger: 'input' });\n        }}\n        onEnter={(val, context) => {\n          props.onEnter?.(value, { ...context, inputValue: val });\n        }}\n        {...props.inputProps}\n        inputClass={classNames(props.inputProps?.className, {\n          [`${classPrefix}-input--focused`]: popupVisible,\n        })}\n      />\n    );\n  };\n\n  return {\n    inputRef,\n    commonInputProps,\n    onInnerClear,\n    renderSelectSingle,\n  };\n}\n"],"names":["COMMON_PROPERTIES","DEFAULT_KEYS","label","value","getInputValue","keys","iKeys","isObject","useSingle","props","loading","disabled","useConfig","classPrefix","inputRef","useRef","useControlled","onInputChange","inputValue","setInputValue","showLoading","useMemo","commonInputProps","pick","suffixIcon","React","createElement","Loading","size","onInnerClear","context","e","stopPropagation","onClear","trigger","onInnerInputChange","allowInput","renderSelectSingle","popupVisible","singleValueDisplay","multiple","valueDisplay","displayedValue","Input","ref","autoWidth","placeholder","Fragment","onChange","readonly","onBlur","val","onFocus","onEnter","inputProps","inputClass","classNames","className"],"mappings":"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"}