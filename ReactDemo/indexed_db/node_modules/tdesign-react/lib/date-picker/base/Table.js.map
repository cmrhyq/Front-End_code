{"version":3,"file":"Table.js","sources":["../../../src/date-picker/base/Table.tsx"],"sourcesContent":["import React from 'react';\nimport classNames from 'classnames';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport useConfig from '../../hooks/useConfig';\nimport DatePickerCell from './Cell';\nimport { TdDatePickerProps } from '../type';\nimport { SinglePanelProps } from '../panel/SinglePanel';\nimport { PanelContentProps } from '../panel/PanelContent';\nimport { parseToDayjs } from '../../_common/js/date-picker/format';\n\nexport interface DatePickerTableProps\n  extends Pick<TdDatePickerProps, 'mode' | 'firstDayOfWeek' | 'format'>,\n    Pick<SinglePanelProps, 'onCellClick' | 'onCellMouseEnter' | 'onCellMouseLeave'>,\n    Pick<PanelContentProps, 'value'> {\n  data?: Array<any>;\n  time?: string;\n}\n\nconst DatePickerTable = (props: DatePickerTableProps) => {\n  const { classPrefix } = useConfig();\n\n  const { value, format, mode, data, time, onCellClick, onCellMouseEnter, onCellMouseLeave, firstDayOfWeek } = props;\n\n  const [local, t] = useLocaleReceiver('datePicker');\n  const weekdays = t(local.weekdays);\n  const weekAbbreviation = t(local.weekAbbreviation);\n\n  const weekArr = [];\n  let wi = firstDayOfWeek - 1;\n  const len = weekdays.length;\n  while (weekArr.length < len) {\n    weekArr.push(weekdays[wi]);\n    wi = (wi + len + 1) % len;\n  }\n  if (mode === 'week') weekArr.unshift(weekAbbreviation);\n\n  const showThead = mode === 'date' || mode === 'week';\n\n  // 高亮周区间\n  const weekRowClass = (value, format, targetValue) => {\n    if (mode !== 'week') return {};\n\n    if (Array.isArray(value)) {\n      if (!value.length) return {};\n      const [startObj, endObj] = value.map((v) => v && parseToDayjs(v, format));\n      const startYear = startObj?.year?.();\n      const startWeek = startObj?.week?.();\n      const endYear = endObj?.year?.();\n      const endWeek = endObj?.week?.();\n\n      const targetObj = parseToDayjs(targetValue, format);\n      const targetYear = targetObj.year();\n      const targetWeek = targetObj.week();\n      const isActive =\n        (targetYear === startYear && targetWeek === startWeek) || (targetYear === endYear && targetWeek === endWeek);\n      const isRange =\n        targetYear >= startYear && targetYear <= endYear && targetWeek > startWeek && targetWeek < endWeek;\n      return {\n        // 同年同周\n        [`${classPrefix}-date-picker__table-${mode}-row--active`]: isActive,\n        [`${classPrefix}-date-picker__table-${mode}-row--range`]: isRange,\n      };\n    }\n\n    return {\n      [`${classPrefix}-date-picker__table-${mode}-row--active`]:\n        parseToDayjs(value, format).week() === parseToDayjs(targetValue, format).week(),\n    };\n  };\n\n  return (\n    <div className={`${classPrefix}-date-picker__table`} onMouseLeave={(e) => onCellMouseLeave?.({ e })}>\n      <table>\n        {showThead && (\n          <thead>\n            <tr>\n              {weekArr.map((value: string, i: number) => (\n                <th key={i}>{value}</th>\n              ))}\n            </tr>\n          </thead>\n        )}\n        <tbody>\n          {data.map((row, i: number) => (\n            <tr\n              key={i}\n              className={classNames(`${classPrefix}-date-picker__table-${mode}-row`, {\n                ...weekRowClass(value, format, row[0].value),\n              })}\n            >\n              {row.map((col: any, j: number) => (\n                <DatePickerCell {...col} key={j} time={time} onClick={onCellClick} onMouseEnter={onCellMouseEnter} />\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n};\n\nDatePickerTable.displayName = 'DatePickerTable';\n\nexport default DatePickerTable;\n"],"names":["DatePickerTable","props","useConfig","classPrefix","value","format","mode","data","time","onCellClick","onCellMouseEnter","onCellMouseLeave","firstDayOfWeek","useLocaleReceiver","local","t","weekdays","weekAbbreviation","weekArr","wi","len","length","push","unshift","showThead","weekRowClass","targetValue","Array","isArray","map","v","parseToDayjs","startObj","endObj","startYear","year","startWeek","week","endYear","endWeek","targetObj","targetYear","targetWeek","isActive","isRange","React","createElement","className","onMouseLeave","e","i","key","row","classNames","col","j","DatePickerCell","onClick","onMouseEnter","displayName"],"mappings":"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"}