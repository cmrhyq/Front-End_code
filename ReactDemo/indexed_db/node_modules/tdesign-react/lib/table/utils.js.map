{"version":3,"file":"utils.js","sources":["../../src/table/utils.ts"],"sourcesContent":["import isFunction from 'lodash/isFunction';\nimport get from 'lodash/get';\nimport isObject from 'lodash/isObject';\nimport { PrimaryTableCol, RowClassNameParams, TableRowData, TdBaseTableProps } from './type';\nimport { ClassName, HTMLElementAttributes } from '../common';\nimport { AffixProps } from '../affix';\n\nexport function toString(obj: any): string {\n  return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase();\n}\n\nexport function debounce<T = any>(fn: Function, delay = 200): () => void {\n  let timer: ReturnType<typeof setTimeout>;\n  return function newFn(this: T, ...args: Array<any>): void {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const context = this;\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      fn.apply(context, args);\n    }, delay);\n  };\n}\n\nexport interface FormatRowAttributesParams {\n  row: TableRowData;\n  rowIndex: number;\n  type: 'body' | 'foot';\n}\n\n// 行属性\nexport function formatRowAttributes(attributes: TdBaseTableProps['rowAttributes'], params: FormatRowAttributesParams) {\n  if (!attributes) return undefined;\n  const attrList = attributes instanceof Array ? attributes : [attributes];\n  let result: HTMLElementAttributes = {};\n  for (let i = 0; i < attrList.length; i++) {\n    const attrItem = attrList[i];\n    if (!attrItem) continue;\n    const attrProperty = isFunction(attrItem) ? attrItem(params) : attrItem;\n    result =\n      attrProperty instanceof Array ? formatRowAttributes(attrProperty, params) : Object.assign(result, attrProperty);\n  }\n  return result;\n}\n\n// 行类名，['A', 'B']，[() => 'A', () => 'B']\nexport function formatRowClassNames(\n  rowClassNames: TdBaseTableProps['rowClassName'],\n  params: RowClassNameParams<TableRowData>,\n  rowKey: string,\n): ClassName {\n  const rowClassList = rowClassNames instanceof Array ? rowClassNames : [rowClassNames];\n  const { row, rowIndex } = params;\n  // 自定义行类名\n  let customClasses: ClassName = [];\n  for (let i = 0, len = rowClassList.length; i < len; i++) {\n    const rName = rowClassList[i];\n    let tClass = isFunction(rName) ? rName(params) : rName;\n    if (isObject(tClass) && !(tClass instanceof Array)) {\n      // 根据下标设置行类名\n      tClass[rowIndex] && (tClass = tClass[rowIndex]);\n      // 根据行唯一标识设置行类名\n      const rowId = get(row, rowKey || 'id');\n      tClass[rowId] && (tClass = tClass[rowId]);\n    } else if (tClass instanceof Array) {\n      tClass = formatRowClassNames(tClass, params, rowKey);\n    }\n    customClasses = customClasses.concat(tClass);\n  }\n  return customClasses;\n}\n\nexport function filterDataByIds(\n  data: Array<object> = [],\n  ids: Array<string | number> = [],\n  byId = 'id',\n): Array<object> {\n  return data.filter((d: Record<string, any> = {}) => ids.includes(d[byId]));\n}\n\nexport const INNER_PRE_NAME = '@@inner-';\n\nexport enum SCROLL_DIRECTION {\n  X = 'x',\n  Y = 'y',\n  UNKNOWN = 'unknown',\n}\n\nlet preScrollLeft: any;\nlet preScrollTop: any;\n\nexport const getScrollDirection = (scrollLeft: number, scrollTop: number): SCROLL_DIRECTION => {\n  let direction = SCROLL_DIRECTION.UNKNOWN;\n  if (preScrollTop !== scrollTop) {\n    direction = SCROLL_DIRECTION.Y;\n  } else if (preScrollLeft !== scrollLeft) {\n    direction = SCROLL_DIRECTION.X;\n  }\n  preScrollTop = scrollTop;\n  preScrollLeft = scrollLeft;\n  return direction;\n};\n\nexport const getRecord = (record: Record<any, any>) => {\n  if (!record) {\n    return record;\n  }\n  const result = {};\n  Object.keys(record).forEach((key) => {\n    const descriptor = Object.getOwnPropertyDescriptor(record, key);\n    descriptor &&\n      Reflect.defineProperty(result, key, {\n        set(val) {\n          descriptor.set(val);\n        },\n        get() {\n          console.warn('The parameter `record` will be deprecated, please use `row` instead');\n          return descriptor.get();\n        },\n      });\n  });\n  return result;\n};\n\nexport function isRowSelectedDisabled(\n  selectColumn: PrimaryTableCol,\n  row: Record<string, any>,\n  rowIndex: number,\n): boolean {\n  if (!selectColumn) return false;\n  let disabled = isFunction(selectColumn.disabled) ? selectColumn.disabled({ row, rowIndex }) : selectColumn.disabled;\n  if (selectColumn.checkProps) {\n    if (isFunction(selectColumn.checkProps)) {\n      disabled = disabled || selectColumn.checkProps({ row, rowIndex }).disabled;\n    } else if (selectColumn.checkProps === 'object') {\n      disabled = disabled || selectColumn.checkProps.disabled;\n    }\n  }\n  return !!disabled;\n}\n\n// 多级表头，列配置场景，获取 currentRow\nexport function getCurrentRowByKey<T extends { colKey?: string; children?: any[] }>(columns: T[], key: string): T {\n  if (!columns || !key) return;\n  const col = columns?.find((t) => t.colKey === key);\n  if (col) return col;\n  for (let i = 0, len = columns.length; i < len; i++) {\n    if (columns[i]?.children?.length) {\n      return getCurrentRowByKey(columns[i]?.children, key);\n    }\n  }\n}\n\n/** 透传 Affix 组件全部特性 */\nexport function getAffixProps(mainAffixProps: boolean | AffixProps, subAffixProps?: AffixProps) {\n  if (typeof mainAffixProps === 'object') return mainAffixProps;\n  if (typeof subAffixProps === 'object') return subAffixProps;\n  return {};\n}\n\nexport function getEditableKeysMap(keys: Array<string | number>, list: any[], rowKey: string) {\n  const map: { [key: string | number]: boolean } = {};\n  for (let i = 0, len = list.length; i < len; i++) {\n    const rowValue = get(list[i], rowKey);\n    if (keys.includes(rowValue)) {\n      map[rowValue] = true;\n    }\n  }\n  return map;\n}\n"],"names":["toString","obj","Object","prototype","call","slice","toLowerCase","debounce","fn","delay","timer","newFn","args","context","clearTimeout","setTimeout","apply","formatRowAttributes","attributes","params","attrList","Array","result","i","length","attrItem","attrProperty","isFunction","assign","formatRowClassNames","rowClassNames","rowKey","rowClassList","row","rowIndex","customClasses","len","rName","tClass","isObject","rowId","get","concat","filterDataByIds","data","ids","byId","filter","d","includes","INNER_PRE_NAME","SCROLL_DIRECTION","preScrollLeft","preScrollTop","getScrollDirection","scrollLeft","scrollTop","direction","getRecord","record","keys","forEach","key","descriptor","getOwnPropertyDescriptor","Reflect","defineProperty","set","val","console","warn","isRowSelectedDisabled","selectColumn","disabled","checkProps","getCurrentRowByKey","columns","col","find","t","colKey","children","getAffixProps","mainAffixProps","subAffixProps","getEditableKeysMap","list","map","rowValue"],"mappings":"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"}