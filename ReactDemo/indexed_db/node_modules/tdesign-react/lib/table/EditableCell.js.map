{"version":3,"file":"EditableCell.js","sources":["../../node_modules/lodash/set.js","../../src/table/EditableCell.tsx"],"sourcesContent":["var baseSet = require('./_baseSet');\n\n/**\n * Sets the value at `path` of `object`. If a portion of `path` doesn't exist,\n * it's created. Arrays are created for missing index properties while objects\n * are created for all other missing properties. Use `_.setWith` to customize\n * `path` creation.\n *\n * **Note:** This method mutates `object`.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to modify.\n * @param {Array|string} path The path of the property to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns `object`.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.set(object, 'a[0].b.c', 4);\n * console.log(object.a[0].b.c);\n * // => 4\n *\n * _.set(object, ['x', '0', 'y', 'z'], 5);\n * console.log(object.x[0].y.z);\n * // => 5\n */\nfunction set(object, path, value) {\n  return object == null ? object : baseSet(object, path, value);\n}\n\nmodule.exports = set;\n","import React, { useEffect, useMemo, useRef, useState, MouseEvent } from 'react';\nimport get from 'lodash/get';\nimport set from 'lodash/set';\nimport isFunction from 'lodash/isFunction';\nimport { Edit1Icon as TdEdit1Icon } from 'tdesign-icons-react';\nimport classNames from 'classnames';\nimport {\n  TableRowData,\n  PrimaryTableCol,\n  PrimaryTableRowEditContext,\n  PrimaryTableRowValidateContext,\n  TdBaseTableProps,\n  PrimaryTableCellParams,\n} from './type';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport { TableClassName } from './hooks/useClassName';\nimport { renderCell } from './TR';\nimport { validate } from '../form/formModel';\nimport log from '../_common/js/log';\nimport { AllValidateResult } from '../form/type';\n\nexport interface EditableCellProps {\n  row: TableRowData;\n  rowIndex: number;\n  col: PrimaryTableCol<TableRowData>;\n  colIndex: number;\n  oldCell: PrimaryTableCol<TableRowData>['cell'];\n  tableBaseClass?: TableClassName['tableBaseClass'];\n  /** 行编辑需要使用 editable。单元格编辑则无需使用，设置为 undefined */\n  editable?: boolean;\n  readonly?: boolean;\n  errors?: AllValidateResult[];\n  cellEmptyContent?: TdBaseTableProps['cellEmptyContent'];\n  onChange?: (context: PrimaryTableRowEditContext<TableRowData>) => void;\n  onValidate?: (context: PrimaryTableRowValidateContext<TableRowData>) => void;\n  onRuleChange?: (context: PrimaryTableRowEditContext<TableRowData>) => void;\n}\n\nconst EditableCell = (props: EditableCellProps) => {\n  const { row, col, rowIndex, colIndex, errors, editable, tableBaseClass } = props;\n  const { Edit1Icon } = useGlobalIcon({ Edit1Icon: TdEdit1Icon });\n  const tableEditableCellRef = useRef(null);\n  const [isEdit, setIsEdit] = useState(props.col.edit?.defaultEditable || false);\n  const [editValue, setEditValue] = useState();\n  const [errorList, setErrorList] = useState<AllValidateResult[]>([]);\n\n  const getCurrentRow = (row: TableRowData, colKey: string, value: any) => {\n    const newRow = { ...row };\n    set(newRow, colKey, value);\n    return newRow;\n  };\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const currentRow = useMemo(() => getCurrentRow(row, col.colKey, editValue), [col.colKey, editValue, row]);\n\n  const cellNode = useMemo(() => {\n    const node = renderCell(\n      {\n        row: currentRow,\n        col: { ...col, cell: props.oldCell },\n        rowIndex: props.rowIndex,\n        colIndex: props.colIndex,\n      },\n      { cellEmptyContent: props.cellEmptyContent },\n    );\n    return node;\n  }, [col, currentRow, props.cellEmptyContent, props.colIndex, props.oldCell, props.rowIndex]);\n\n  const componentProps = useMemo(() => {\n    const { edit } = col;\n    if (!edit) return {};\n    const editProps = isFunction(edit.props)\n      ? edit.props({ col, row, rowIndex, colIndex, editedRow: currentRow })\n      : { ...edit.props };\n    // to remove warn: runtime-core.esm-bundler.js:38 [Vue warn]: Invalid prop: type check failed for prop \"onChange\". Expected Function, got Array\n    delete editProps.onChange;\n    delete editProps.value;\n    edit.abortEditOnEvent?.forEach((item) => {\n      delete editProps[item];\n    });\n    return editProps;\n  }, [col, colIndex, currentRow, row, rowIndex]);\n\n  const isAbortEditOnChange = useMemo(() => {\n    const { edit } = col;\n    if (!edit) return false;\n    return Boolean(edit.abortEditOnEvent?.includes('onChange'));\n  }, [col]);\n\n  const validateEdit = (trigger: 'self' | 'parent') =>\n    new Promise((resolve) => {\n      const cellParams: PrimaryTableCellParams<TableRowData> = {\n        col: props.col,\n        row: props.row,\n        colIndex: props.colIndex,\n        rowIndex: props.rowIndex,\n      };\n      const params: PrimaryTableRowValidateContext<TableRowData> = {\n        result: [\n          {\n            ...cellParams,\n            errorList: [],\n            value: editValue,\n          },\n        ],\n        trigger,\n      };\n      const rules = isFunction(col.edit.rules) ? col.edit.rules(cellParams) : col.edit.rules;\n      if (!col.edit || !rules || !rules.length) {\n        props.onValidate?.(params);\n        resolve(true);\n        return;\n      }\n      validate(editValue, rules).then((result) => {\n        const list = result?.filter((t) => !t.result);\n        params.result[0].errorList = list;\n        props.onValidate?.(params);\n        if (!list || !list.length) {\n          resolve(true);\n        } else {\n          setErrorList(list);\n          resolve(list);\n        }\n      });\n    });\n\n  const isSame = (a: any, b: any) => {\n    if (typeof a === 'object' && typeof b === 'object') {\n      return JSON.stringify(a) === JSON.stringify(b);\n    }\n    return a === b;\n  };\n\n  const updateAndSaveAbort = (outsideAbortEvent: Function, ...args: any) => {\n    validateEdit('self').then((result) => {\n      if (result !== true) return;\n      const oldValue = get(row, col.colKey);\n      // 相同的值无需触发变化\n      if (!isSame(args[0].value, oldValue)) {\n        // 恢复数据，保持受控\n        setEditValue(oldValue);\n        outsideAbortEvent?.(...args);\n      }\n      // 此处必须在事件执行完成后异步销毁编辑组件，否则会导致事件清除不及时引起的其他问题\n      const timer = setTimeout(() => {\n        setIsEdit(false);\n        setErrorList([]);\n        clearTimeout(timer);\n      }, 0);\n    });\n  };\n\n  const listeners = useMemo<{ [key: string]: Function }>(() => {\n    const { edit } = col;\n    const isCellEditable = props.editable === undefined;\n    if (!isEdit || !isCellEditable) return;\n    if (!edit?.abortEditOnEvent?.length) return {};\n    // 自定义退出编辑态的事件\n    const tListeners = {};\n    const outsideAbortEvent = edit?.onEdited;\n    edit.abortEditOnEvent.forEach((itemEvent) => {\n      if (itemEvent === 'onChange') return;\n      tListeners[itemEvent] = (...args: any) => {\n        updateAndSaveAbort(\n          outsideAbortEvent,\n          {\n            value: editValue,\n            trigger: itemEvent,\n            newRowData: currentRow,\n            rowIndex: props.rowIndex,\n          },\n          ...args,\n        );\n      };\n    });\n    return tListeners;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [col, currentRow, isEdit, props.rowIndex]);\n\n  const onEditChange = (val: any, ...args: any) => {\n    setEditValue(val);\n    const params = {\n      row: props.row,\n      rowIndex: props.rowIndex,\n      value: val,\n      col: props.col,\n      colIndex: props.colIndex,\n      editedRow: { ...props.row, [props.col.colKey]: val },\n    };\n    props.onChange?.(params);\n    props.onRuleChange?.(params);\n    const isCellEditable = props.editable === undefined;\n    if (isCellEditable && isAbortEditOnChange) {\n      const outsideAbortEvent = col.edit?.onEdited;\n      // editValue 和 currentRow 更新完成后再执行这个函数\n      updateAndSaveAbort(\n        outsideAbortEvent,\n        {\n          value: val,\n          trigger: 'onChange',\n          newRowData: getCurrentRow(currentRow, col.colKey, val),\n          rowIndex: props.rowIndex,\n        },\n        ...args,\n      );\n    }\n  };\n\n  const documentClickHandler = (e: PointerEvent) => {\n    if (!col.edit || !col.edit.component) return;\n    if (!isEdit) return;\n    // @ts-ignore\n    if (e.path?.includes(tableEditableCellRef?.current?.currentElement)) return;\n    const outsideAbortEvent = col.edit.onEdited;\n    updateAndSaveAbort(outsideAbortEvent, {\n      value: editValue,\n      trigger: 'document',\n      newRowData: currentRow,\n      rowIndex: props.rowIndex,\n    });\n  };\n\n  const cellValue = useMemo(() => get(row, col.colKey), [row, col.colKey]);\n\n  useEffect(() => {\n    let val = cellValue;\n    if (typeof val === 'object' && val !== null) {\n      val = val instanceof Array ? [...val] : { ...val };\n    }\n    setEditValue(val);\n  }, [cellValue]);\n\n  useEffect(() => {\n    const isCellEditable = props.editable === undefined;\n    if (!col.edit || !col.edit.component || !isCellEditable) return;\n    if (isEdit) {\n      document.addEventListener('click', documentClickHandler);\n    } else {\n      document.removeEventListener('click', documentClickHandler);\n    }\n    return () => {\n      document.removeEventListener('click', documentClickHandler);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [col.edit, isEdit, editValue]);\n\n  useEffect(() => {\n    // 退出编辑态时，恢复原始值，等待父组件传入新的 data 值\n    if (props.editable === false) {\n      setEditValue(cellValue);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [cellValue, editable]);\n\n  useEffect(() => {\n    if (props.editable === true) {\n      props.onRuleChange?.({\n        col,\n        row,\n        rowIndex,\n        colIndex,\n        value: cellValue,\n        editedRow: row,\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [cellValue, col, colIndex, row, rowIndex]);\n\n  useEffect(() => {\n    setErrorList(errors);\n  }, [errors]);\n\n  if (props.readonly) {\n    return cellNode || null;\n  }\n\n  // 这是非编辑态\n  if ((props.editable === undefined && !isEdit) || editable === false) {\n    return (\n      <div\n        className={classNames(tableBaseClass.cellEditable)}\n        onClick={(e: MouseEvent<HTMLDivElement>) => {\n          setIsEdit(true);\n          e.stopPropagation();\n        }}\n      >\n        {cellNode}\n        {col.edit?.showEditIcon !== false && <Edit1Icon size=\"12px\" />}\n      </div>\n    );\n  }\n  const Component = col.edit?.component;\n  if (!Component) {\n    log.error('Table', 'edit.component is required.');\n    return null;\n  }\n  const errorMessage = errorList?.[0]?.message;\n  return (\n    <div\n      className={tableBaseClass.cellEditWrap}\n      onClick={(e) => {\n        e.stopPropagation();\n      }}\n    >\n      <Component\n        ref={tableEditableCellRef}\n        status={errorMessage ? errorList?.[0]?.type || 'error' : undefined}\n        tips={errorMessage}\n        {...componentProps}\n        {...listeners}\n        value={editValue}\n        onChange={onEditChange}\n      />\n    </div>\n  );\n};\n\nEditableCell.displayName = 'EditableCell';\n\nexport default EditableCell;\n"],"names":["baseSet","require$$0","set","object","path","value","set_1","EditableCell","props","row","col","rowIndex","colIndex","errors","editable","tableBaseClass","useGlobalIcon","Edit1Icon","TdEdit1Icon","tableEditableCellRef","useRef","useState","edit","defaultEditable","isEdit","setIsEdit","editValue","setEditValue","errorList","setErrorList","getCurrentRow","colKey","newRow","currentRow","useMemo","cellNode","node","renderCell","cell","oldCell","cellEmptyContent","componentProps","editProps","isFunction","editedRow","onChange","abortEditOnEvent","forEach","item","isAbortEditOnChange","Boolean","includes","validateEdit","trigger","Promise","resolve","cellParams","params","result","rules","length","onValidate","validate","then","list","filter","t","isSame","a","b","JSON","stringify","updateAndSaveAbort","outsideAbortEvent","args","oldValue","get","timer","setTimeout","clearTimeout","listeners","isCellEditable","tListeners","onEdited","itemEvent","newRowData","onEditChange","val","onRuleChange","documentClickHandler","e","component","current","currentElement","cellValue","useEffect","Array","document","addEventListener","removeEventListener","readonly","React","createElement","className","classNames","cellEditable","onClick","stopPropagation","showEditIcon","size","Component","log","error","errorMessage","message","cellEditWrap","ref","status","type","tips","displayName"],"mappings":"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"}