{"version":3,"file":"Form.js","sources":["../../src/form/Form.tsx"],"sourcesContent":["import React, { useRef, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../hooks/useConfig';\nimport noop from '../_util/noop';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport type { TdFormProps } from './type';\nimport useInstance from './hooks/useInstance';\nimport useForm from './hooks/useForm';\nimport { StyledProps } from '../common';\nimport FormContext from './FormContext';\nimport FormItem from './FormItem';\nimport FormList from './FormList';\nimport { formDefaultProps } from './defaultProps';\n\nexport interface FormProps extends TdFormProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nconst Form = forwardRefWithStatics(\n  (props: FormProps, ref) => {\n    const { classPrefix, form: globalFormConfig } = useConfig();\n\n    const {\n      style,\n      className,\n      form,\n      labelWidth,\n      statusIcon,\n      labelAlign,\n      layout,\n      colon,\n      initialData,\n      requiredMark = globalFormConfig.requiredMark,\n      scrollToFirstError,\n      showErrorMessage,\n      resetType,\n      rules,\n      errorMessage = globalFormConfig.errorMessage,\n      preventSubmitDefault,\n      disabled,\n      children,\n      onReset,\n      onValuesChange = noop,\n    } = props;\n\n    const formClass = classNames(`${classPrefix}-form`, className, {\n      [`${classPrefix}-form-inline`]: layout === 'inline',\n    });\n\n    const formRef: React.RefObject<HTMLFormElement> = useRef();\n    const formMapRef = useRef(new Map()); // 收集所有 formItem 实例\n    const formInstance = useInstance(props, formRef, formMapRef);\n\n    useImperativeHandle(ref, () => formInstance);\n    form && Object.assign(form, { ...formInstance });\n\n    function onResetHandler(e: React.FormEvent<HTMLFormElement>) {\n      [...formMapRef.current.values()].forEach((formItemRef) => {\n        formItemRef?.current.resetField();\n      });\n      onReset?.({ e });\n    }\n\n    function onFormItemValueChange(changedValue: Record<string, unknown>) {\n      const allFields = formInstance.getFieldsValue(true);\n      onValuesChange(changedValue, allFields);\n    }\n\n    function onKeyDownHandler(e: React.KeyboardEvent<HTMLFormElement>) {\n      // 禁用 input 输入框回车自动提交 form\n      if ((e.target as Element).tagName.toLowerCase() !== 'input') return;\n      if (preventSubmitDefault && e.key === 'Enter') {\n        e.preventDefault?.();\n        e.stopPropagation?.();\n      }\n    }\n\n    return (\n      <FormContext.Provider\n        value={{\n          labelWidth,\n          statusIcon,\n          labelAlign,\n          layout,\n          colon,\n          initialData,\n          requiredMark,\n          errorMessage,\n          showErrorMessage,\n          scrollToFirstError,\n          resetType,\n          rules,\n          disabled,\n          formMapRef,\n          onFormItemValueChange,\n        }}\n      >\n        <form\n          ref={formRef}\n          style={style}\n          className={formClass}\n          onSubmit={formInstance.submit}\n          onReset={onResetHandler}\n          onKeyDown={onKeyDownHandler}\n        >\n          {children}\n        </form>\n      </FormContext.Provider>\n    );\n  },\n  { useForm, FormItem, FormList },\n);\n\nForm.displayName = 'Form';\nForm.defaultProps = formDefaultProps;\n\nexport default Form;\n"],"names":["Form","forwardRefWithStatics","props","ref","useConfig","classPrefix","globalFormConfig","form","style","className","labelWidth","statusIcon","labelAlign","layout","colon","initialData","requiredMark","scrollToFirstError","showErrorMessage","resetType","rules","errorMessage","preventSubmitDefault","disabled","children","onReset","onValuesChange","noop","formClass","classNames","formRef","useRef","formMapRef","Map","formInstance","useInstance","useImperativeHandle","Object","assign","onResetHandler","e","current","values","forEach","formItemRef","resetField","onFormItemValueChange","changedValue","allFields","getFieldsValue","onKeyDownHandler","target","tagName","toLowerCase","key","preventDefault","stopPropagation","React","createElement","FormContext","Provider","value","onSubmit","submit","onKeyDown","useForm","FormItem","FormList","displayName","defaultProps","formDefaultProps"],"mappings":"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"}