{"version":3,"file":"ImageViewer.js","sources":["../../src/image-viewer/ImageViewer.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport isFunction from 'lodash/isFunction';\nimport { TdImageViewerProps } from './type';\nimport { ImageModal } from './ImageViewerModel';\nimport { StyledProps, TNode } from '../common';\nimport { imageViewerDefaultProps } from './defaultProps';\nimport useImageScale from './hooks/useImageScale';\nimport useList from './hooks/useList';\nimport useViewerScale from './hooks/useViewerScale';\nimport useControlled from '../hooks/useControlled';\n\nexport interface ImageViewerProps extends TdImageViewerProps, StyledProps {}\n\nconst ImageViewer = (props: ImageViewerProps) => {\n  const { mode, trigger, images, title, imageScale: imageScaleD, viewerScale: viewerScaleD } = props;\n\n  const [visible, setVisible] = useControlled(props, 'visible', (visible, context) => {\n    isFunction(props.onClose) && props.onClose(context);\n  });\n\n  const [visibled, setVisibled] = useState(false);\n  const list = useList(images);\n  const imageScale = useImageScale(imageScaleD);\n  const viewerScale = useViewerScale(viewerScaleD);\n\n  const isMini = mode === 'modeless';\n\n  const close = (context) => {\n    setVisible(false, context);\n    setTimeout(() => setVisibled(false), 196);\n  };\n\n  const open = () => {\n    if (!images) return;\n    setVisible(true, null);\n    setVisibled(true);\n  };\n  // todo 兼容旧api，新： open close 旧： onOpen, onClose\n  const uiImage: TNode = isFunction(trigger) ? trigger({ open, close, onOpen: open, onClose: close }) : trigger;\n\n  return (\n    <>\n      {uiImage}\n      {visibled &&\n        createPortal(\n          <ImageModal\n            title={title}\n            visible={visible}\n            images={list}\n            isMini={isMini}\n            imageScale={imageScale}\n            viewerScale={viewerScale}\n            zIndex={props.zIndex}\n            defaultIndex={props.defaultIndex}\n            index={props.index}\n            onIndexChange={props.onIndexChange}\n            draggable={props.draggable}\n            closeOnOverlay={props.closeOnOverlay}\n            closeBtn={props.closeBtn}\n            showOverlay={props.showOverlay}\n            onClose={close}\n            onOpen={open}\n          />,\n          document.body,\n        )}\n    </>\n  );\n};\n\nImageViewer.displayName = 'ImageViewer';\n\nImageViewer.defaultProps = imageViewerDefaultProps;\n\nexport default ImageViewer;\n"],"names":["ImageViewer","props","mode","trigger","images","title","imageScaleD","imageScale","viewerScaleD","viewerScale","useControlled","visible","context","isFunction","onClose","setVisible","useState","visibled","setVisibled","list","useList","useImageScale","useViewerScale","isMini","close","setTimeout","open","uiImage","onOpen","React","createElement","Fragment","createPortal","ImageModal","zIndex","defaultIndex","index","onIndexChange","draggable","closeOnOverlay","closeBtn","showOverlay","document","body","displayName","defaultProps","imageViewerDefaultProps"],"mappings":"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"}