{"version":3,"file":"usePosition.js","sources":["../../../src/image-viewer/hooks/usePosition.ts"],"sourcesContent":["import { MouseEventHandler, useCallback, useEffect, useRef, useState } from 'react';\nimport isFunction from 'lodash/isFunction';\n\nexport type PositionType = [number, number];\n\ninterface UsePositionArg {\n  initPosition?: PositionType;\n  move?: boolean;\n  computed?: (XY: PositionType, screenXY: PositionType, oldXY: PositionType) => PositionType;\n  onMouseUp?: (event?: MouseEvent) => void;\n  onMouseMove?: (event?: MouseEvent) => void;\n  onMouseDown?: (event?: MouseEventHandler<HTMLDivElement>) => void;\n}\n\nconst usePosition = (\n  { initPosition, move = true, onMouseUp: onEnd, onMouseMove: onUpdate, onMouseDown: onStart }: UsePositionArg,\n  $dom?: HTMLElement | Document,\n): [PositionType, MouseEventHandler<HTMLDivElement>] => {\n  const [position, setPosition] = useState<PositionType>(initPosition);\n  const cacheMoveDataRef = useRef(null);\n\n  const onMouseUp = useCallback(() => {\n    if (!cacheMoveDataRef.current) return;\n    cacheMoveDataRef.current = null;\n    if (!move) return;\n    isFunction(onEnd) && onEnd();\n  }, [move, onEnd]);\n\n  const onMouseMove = useCallback(\n    (event: MouseEvent | any) => {\n      if (!event.buttons) cacheMoveDataRef.current = null;\n      if (!cacheMoveDataRef.current || cacheMoveDataRef.current.updating || !move) return;\n      cacheMoveDataRef.current.updating = true;\n      const { screenX: oldX, screenY: oldY } = cacheMoveDataRef.current;\n      const { screenX, screenY } = event;\n\n      requestAnimationFrame(() => {\n        if (!cacheMoveDataRef.current) return;\n        setPosition(([X, Y]) => [X + screenX - oldX, Y + screenY - oldY]);\n        cacheMoveDataRef.current.screenX = screenX;\n        cacheMoveDataRef.current.screenY = screenY;\n        cacheMoveDataRef.current.updating = false;\n        isFunction(onUpdate) && onUpdate();\n      });\n    },\n    [move, onUpdate],\n  );\n\n  const onMouseDown: MouseEventHandler<HTMLDivElement> = useCallback(\n    (event) => {\n      const { screenX, screenY } = event;\n      cacheMoveDataRef.current = {\n        screenX,\n        screenY,\n      };\n      if (!move) return;\n      isFunction(onStart) && onStart();\n    },\n    [move, onStart],\n  );\n\n  useEffect(() => {\n    const dom = $dom || document;\n    dom.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('mouseup', onMouseUp);\n    return () => {\n      dom.removeEventListener('mousemove', onMouseMove);\n      document.removeEventListener('mouseup', onMouseUp);\n    };\n  }, [$dom, move, onMouseMove, onMouseUp]);\n\n  return [position, onMouseDown];\n};\n\nexport default usePosition;\n"],"names":["usePosition","$dom","initPosition","move","onEnd","onMouseUp","onUpdate","onMouseMove","onStart","onMouseDown","useState","position","setPosition","cacheMoveDataRef","useRef","useCallback","current","isFunction","event","buttons","updating","oldX","screenX","oldY","screenY","requestAnimationFrame","X","Y","useEffect","dom","document","addEventListener","removeEventListener"],"mappings":"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"}