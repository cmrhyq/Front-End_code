{"version":3,"file":"Watermark.js","sources":["../../src/watermark/Watermark.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\nimport React, { useState, useEffect, useRef } from 'react';\nimport { StyledProps } from '../common';\nimport generateBase64Url from '../_common/js/watermark/generateBase64Url';\nimport randomMovingStyle from '../_common/js/watermark/randomMovingStyle';\nimport injectStyle from '../_common/js/utils/injectStyle';\nimport useConfig from '../hooks/useConfig';\nimport useMutationObserver from '../_util/useMutationObserver';\nimport { TdWatermarkProps } from './type';\nimport { watermarkDefaultProps as defaultProps } from './defaultProps';\n\nexport interface WatermarkProps extends TdWatermarkProps, StyledProps {}\n\nconst Watermark: React.FC<WatermarkProps> = ({\n  alpha = defaultProps.alpha,\n  x = 200,\n  y = 210,\n  width = 120,\n  height = 60,\n  rotate: tempRotate = defaultProps.rotate,\n  zIndex = 10,\n  lineSpace = defaultProps.lineSpace,\n  isRepeat = defaultProps.isRepeat,\n  removable = defaultProps.removable,\n  movable = defaultProps.movable,\n  moveInterval = defaultProps.moveInterval,\n  offset = [],\n  content,\n  children,\n  watermarkContent,\n  className,\n  style = {},\n}) => {\n  const { classPrefix } = useConfig();\n\n  let gapX = x;\n  let gapY = y;\n  let rotate = tempRotate;\n  if (movable) {\n    gapX = 0;\n    gapY = 0;\n    rotate = 0;\n  }\n  const clsName = `${classPrefix}-watermark`;\n  const [base64Url, setBase64Url] = useState('');\n  const watermarkRef = useRef<HTMLDivElement>();\n  const offsetLeft = offset[0] || gapX / 2;\n  const offsetTop = offset[1] || gapY / 2;\n\n  useEffect(() => {\n    generateBase64Url(\n      {\n        width,\n        height,\n        rotate,\n        lineSpace,\n        alpha,\n        gapX,\n        gapY,\n        watermarkContent,\n        offsetLeft,\n        offsetTop,\n      },\n      (url) => {\n        setBase64Url(url);\n      },\n    );\n  }, [width, height, rotate, zIndex, lineSpace, alpha, offsetLeft, offsetTop, gapX, gapY, watermarkContent]);\n\n  useMutationObserver(watermarkRef.current, (mutations) => {\n    if (removable) return;\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'childList') {\n        const removeNodes = mutation.removedNodes;\n        removeNodes.forEach((node) => {\n          watermarkRef.current.appendChild(node);\n        });\n      }\n    });\n  });\n\n  const parent = useRef<HTMLElement>();\n  useEffect(() => {\n    parent.current = watermarkRef.current.parentElement;\n    const keyframesStyle = randomMovingStyle();\n    injectStyle(keyframesStyle);\n  }, []);\n\n  useMutationObserver(document.body, (mutations) => {\n    if (removable) return;\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'childList') {\n        const removeNodes = mutation.removedNodes;\n        removeNodes.forEach((node) => {\n          const element = node as HTMLElement;\n          if (element === watermarkRef.current) {\n            parent.current.appendChild(element);\n          }\n        });\n      }\n    });\n  });\n\n  return (\n    <div style={{ position: 'relative', overflow: 'hidden' }} className={clsName} ref={watermarkRef}>\n      {children || content}\n      <div\n        className={className}\n        style={{\n          zIndex,\n          position: 'absolute',\n          left: 0,\n          right: 0,\n          top: 0,\n          bottom: 0,\n          width: '100%',\n          height: '100%',\n          backgroundSize: `${gapX + width}px`,\n          pointerEvents: 'none',\n          backgroundRepeat: movable ? 'no-repeat' : isRepeat ? 'repeat' : 'no-repeat',\n          backgroundImage: `url('${base64Url}')`,\n          animation: movable ? `watermark infinite ${(moveInterval * 4) / 60}s` : 'none',\n          ...style,\n        }}\n      />\n    </div>\n  );\n};\n\nexport default Watermark;\n"],"names":["Watermark","alpha","defaultProps","x","y","width","height","rotate","tempRotate","zIndex","lineSpace","isRepeat","removable","movable","moveInterval","offset","content","children","watermarkContent","className","style","useConfig","classPrefix","gapX","gapY","clsName","useState","base64Url","setBase64Url","watermarkRef","useRef","offsetLeft","offsetTop","useEffect","generateBase64Url","url","useMutationObserver","current","mutations","forEach","mutation","type","removeNodes","removedNodes","node","appendChild","parent","parentElement","keyframesStyle","randomMovingStyle","injectStyle","document","body","element","React","createElement","position","overflow","ref","left","right","top","bottom","backgroundSize","pointerEvents","backgroundRepeat","backgroundImage","animation"],"mappings":"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"}