{"version":3,"file":"Tooltip.js","sources":["../../src/tooltip/Tooltip.tsx"],"sourcesContent":["import React, {\n  forwardRef,\n  useState,\n  useEffect,\n  useRef,\n  useImperativeHandle,\n  cloneElement,\n  isValidElement,\n} from 'react';\nimport classNames from 'classnames';\nimport Popup, { PopupVisibleChangeContext, PopupRef } from '../popup';\nimport useConfig from '../hooks/useConfig';\nimport { TdTooltipProps } from './type';\nimport { tooltipDefaultProps } from './defaultProps';\n\nexport type TooltipProps = TdTooltipProps;\n\nexport interface TooltipRef extends PopupRef {\n  setVisible?: (v: boolean) => void;\n}\n\nconst Tooltip = forwardRef((props: TdTooltipProps, ref) => {\n  const {\n    theme,\n    showArrow = true,\n    destroyOnClose = true,\n    overlayClassName,\n    children,\n    duration = 0,\n    placement = 'top',\n    ...restProps\n  } = props;\n  const { classPrefix } = useConfig();\n  const [isTipShowed, setTipshow] = useState(duration !== 0);\n  const [timeup, setTimeup] = useState(false);\n  const popupRef = useRef<PopupRef>();\n  const timerRef = useRef<number | null>(null);\n  const [offset, setOffset] = useState([0, 0]);\n  const toolTipClass = classNames(\n    `${classPrefix}-tooltip`,\n    {\n      [`${classPrefix}-tooltip--${theme}`]: theme,\n    },\n    overlayClassName,\n  );\n  const isPlacedByMouse = placement === 'mouse';\n\n  const setVisible = (v: boolean) => {\n    if (duration !== 0) setTimeup(false);\n    setTipshow(v);\n  };\n\n  const calculatePos = (e) => {\n    const rect = (e.target as HTMLElement).getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    return {\n      x,\n      y,\n    };\n  };\n\n  const getTriggerChildren = (children) => {\n    const displayName = children.type?.displayName;\n    // disable情况下button不响应mouse事件，但需要展示tooltip，所以要包裹一层\n    if ((children.type === 'button' || displayName === 'Button') && children?.props?.disabled) {\n      const displayStyle = children.props?.style?.display ? children.props.style.display : 'inline-block';\n      const child = cloneElement(children, {\n        style: {\n          ...children.props.style,\n          pointerEvents: 'none',\n        },\n      });\n      return <span style={{ display: displayStyle, cursor: 'not-allowed' }}>{child}</span>;\n    }\n    return children;\n  };\n\n  const handleShowTip = (visible: boolean, { e, trigger }: PopupVisibleChangeContext) => {\n    if (duration === 0 || (duration !== 0 && timeup)) {\n      if (\n        visible &&\n        placement === 'mouse' &&\n        (trigger === 'trigger-element-hover' || trigger === 'trigger-element-click')\n      ) {\n        const { x } = calculatePos(e);\n        setOffset([x, 0]);\n      }\n      setTipshow(visible);\n    }\n  };\n\n  useEffect(() => {\n    if (duration !== 0 && !timeup) {\n      timerRef.current = window.setTimeout(() => {\n        setTipshow(false);\n        setTimeup(true);\n      }, duration);\n    }\n    return () => {\n      if (timerRef.current) window.clearTimeout(timerRef.current);\n    };\n  }, [duration, timeup]);\n\n  useImperativeHandle(ref, () => ({\n    setVisible,\n    ...((popupRef.current || {}) as any),\n  }));\n\n  return (\n    <Popup\n      ref={popupRef}\n      destroyOnClose={destroyOnClose}\n      showArrow={isPlacedByMouse ? false : showArrow}\n      overlayClassName={toolTipClass}\n      visible={isTipShowed}\n      onVisibleChange={handleShowTip}\n      popperOptions={{\n        modifier: isPlacedByMouse ? [{ name: 'offset', options: { offset } }] : [],\n      }}\n      placement={isPlacedByMouse ? 'bottom-left' : placement}\n      {...restProps}\n    >\n      {isValidElement(children) ? getTriggerChildren(children) : children}\n    </Popup>\n  );\n});\n\nTooltip.displayName = 'Tooltip';\nTooltip.defaultProps = tooltipDefaultProps;\n\nexport default Tooltip;\n"],"names":["Tooltip","forwardRef","props","ref","theme","showArrow","destroyOnClose","overlayClassName","children","duration","placement","restProps","useConfig","classPrefix","useState","isTipShowed","setTipshow","timeup","setTimeup","popupRef","useRef","timerRef","offset","setOffset","toolTipClass","classNames","isPlacedByMouse","setVisible","v","calculatePos","e","rect","target","getBoundingClientRect","x","clientX","left","y","clientY","top","getTriggerChildren","displayName","type","disabled","displayStyle","style","display","child","cloneElement","pointerEvents","React","createElement","cursor","handleShowTip","visible","trigger","useEffect","current","window","setTimeout","clearTimeout","useImperativeHandle","Popup","onVisibleChange","popperOptions","modifier","name","options","isValidElement","defaultProps","tooltipDefaultProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqBMA,IAAAA,OAAU,gBAAAC,UAAA,CAAW,UAACC,KAAD,EAAwBC,GAAxB,EAAgC;AACnD,EAAA,IACJC,KADI,GASFF,KATE,CACJE,KADI;MASFF,gBAAAA,GAAAA,KATE,CAEJG,SAFI;MAEJA,SAFI,iCAEQ,IAFR,GAAA,gBAAA;MASFH,qBAAAA,GAAAA,KATE,CAGJI,cAHI;MAGJA,cAHI,sCAGa,IAHb,GAAA,qBAAA;AAAA,MAIJC,gBAJI,GASFL,KATE,CAIJK,gBAJI;AAAA,MAKJC,QALI,GASFN,KATE,CAKJM,QALI;MASFN,eAAAA,GAAAA,KATE,CAMJO,QANI;MAMJA,QANI,gCAMO,CANP,GAAA,eAAA;MASFP,gBAAAA,GAAAA,KATE,CAOJQ,SAPI;MAOJA,SAPI,iCAOQ,KAPR,GAAA,gBAAA;MAQDC,SARC,4BASFT,KATE,EAAA,SAAA,CAAA,CAAA;;AAUA,EAAA,IAAA,UAAA,GAAkBU,SAAU,EAA5B;MAAEC,WAAF,cAAEA,WAAF,CAAA;;AACN,EAAA,IAAA,SAAA,GAAkCC,QAAA,CAASL,aAAa,CAAtB,CAAlC;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOM,WAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAoBC,UAApB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAA4BF,UAAAA,GAAAA,SAAS,MAArC;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAA,MAAOG,MAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAeC,SAAf,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAAMC,WAAWC,MAAiB,EAAlC,CAAA;AACM,EAAA,IAAAC,QAAA,GAAWD,OAAsB,KAAjC,CAAA;;AACA,EAAA,IAAA,UAAA,GAAsBN,SAAS,CAAC,CAAD,EAAI,CAAJ,EAA/B;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAA,MAACQ,MAAD,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAASC,SAAT,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;AACN,EAAA,IAAMC,YAAe,GAAAC,UAAA,CAAA,EAAA,CAAA,MAAA,CAChBZ,WADgB,EAAA,UAAA,CAAA,EAAA,eAAA,CAAA,EAAA,EAAA,EAAA,CAAA,MAAA,CAGbA,WAHa,EAAA,YAAA,CAAA,CAAA,MAAA,CAGWT,KAHX,CAAA,EAGqBA,KAHrB,CAAA,EAKnBG,gBALmB,CAArB,CAAA;AAOA,EAAA,IAAMmB,kBAAkBhB,SAAc,KAAA,OAAtC,CAAA;;AAEM,EAAA,IAAAiB,UAAA,GAAa,SAAbA,UAAa,CAACC,CAAD,EAAgB;AACjC,IAAA,IAAInB,QAAa,KAAA,CAAjB,EAAoBS,SAAA,CAAU,KAAV,CAAA,CAAA;IACpBF,UAAA,CAAWY,CAAX,CAAA,CAAA;GAFI,CAAA;;AAKA,EAAA,IAAAC,YAAA,GAAe,SAAfA,YAAe,CAACC,CAAD,EAAO;AACpB,IAAA,IAAAC,IAAA,GAAQD,CAAE,CAAAE,MAAF,CAAyBC,qBAAzB,EAAR,CAAA;IACA,IAAAC,CAAA,GAAIJ,CAAE,CAAAK,OAAF,GAAYJ,IAAK,CAAAK,IAArB,CAAA;IACA,IAAAC,CAAA,GAAIP,CAAE,CAAAQ,OAAF,GAAYP,IAAK,CAAAQ,GAArB,CAAA;IACC,OAAA;AACLL,MAAAA,CAAA,EAAAA,CADK;AAELG,MAAAA,CAAA,EAAAA,CAAAA;KAFK,CAAA;GAJH,CAAA;;AAUA,EAAA,IAAAG,kBAAA,GAAqB,SAArBA,kBAAqB,CAAChC,SAAD,EAAc;AAAA,IAAA,IAAA,eAAA,EAAA,gBAAA,CAAA;;AACjC,IAAA,IAAAiC,WAAA,GAAcjC,CAAAA,eAAAA,GAAAA,UAASkC,IAAvB,MAAA,IAAA,IAAA,eAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAclC,gBAAeiC,WAA7B,CAAA;;IAEN,IAAA,CAAKjC,UAASkC,IAATlC,KAAkB,QAAlBA,IAA8BiC,gBAAgB,QAAnD,KAAgEjC,SAAhE,KAAA,IAAA,IAAgEA,SAAhE,KAAgEA,KAAAA,CAAAA,IAAAA,CAAAA,gBAAAA,GAAAA,SAAAA,CAAUN,KAA1E,MAAA,IAAA,IAAA,gBAAA,KAAA,KAAA,CAAA,IAAgEM,gBAAiBmC,CAAAA,QAAjF,EAA2F;AAAA,MAAA,IAAA,iBAAA,EAAA,qBAAA,CAAA;;AACnF,MAAA,IAAAC,YAAA,GAAepC,CAAAA,iBAAAA,GAAAA,UAASN,KAATM,yFAAgBqC,KAAhBrC,MAAAA,IAAAA,IAAAA,qBAAAA,KAAAA,KAAAA,CAAAA,IAAAA,qBAAAA,CAAuBsC,OAAvBtC,GAAiCA,SAAS,CAAAN,KAATM,CAAeqC,KAAfrC,CAAqBsC,OAAtDtC,GAAgE,cAA/E,CAAA;AACA,MAAA,IAAAuC,KAAA,gBAAQC,aAAaxC,WAAU;AACnCqC,QAAAA,KAAO,EACFrC,aAAAA,CAAAA,aAAAA,CAAAA,EAAAA,EAAAA,UAASN,KAATM,CAAeqC,KADb,CAAA,EAAA,EAAA,EAAA;AAELI,UAAAA,aAAe,EAAA,MAAA;AAFV,SAAA,CAAA;AAD4B,QAA/B,CAAA;AAMN,MAAA,sBAAQC,KAAA,CAAAC,aAAA,CAAA,MAAA,EAAA;AAAKN,QAAAA,KAAO,EAAA;AAAEC,UAAAA,OAAS,EAAAF,YAAX;AAAyBQ,UAAAA,QAAQ,aAAA;AAAjC,SAAA;OAAZ,EAA+DL,KAA/D,CAAR,CAAA;AACF,KAAA;;AACOvC,IAAAA,OAAAA,SAAAA,CAAAA;GAbH,CAAA;;AAgBN,EAAA,IAAM6C,gBAAgB,SAAhBA,aAAgB,CAACC,OAAD,EAAiE,IAAA,EAAA;IAAA,IAA5CxB,CAA4C,QAA5CA,CAA4C;QAAzCyB,OAAyC,QAAzCA,OAAyC,CAAA;;IACrF,IAAI9C,QAAa,KAAA,CAAb,IAAmBA,QAAa,KAAA,CAAb,IAAkBQ,MAAzC,EAAkD;AAChD,MAAA,IACEqC,WACA5C,SAAc,KAAA,OADd,KAEC6C,OAAY,KAAA,uBAAZ,IAAuCA,YAAY,uBAFpD,CADF,EAIE;QACA,IAAc1B,aAAAA,GAAAA,YAAA,CAAaC,CAAb,CAAd;YAAQI,CAAR,iBAAQA,CAAR,CAAA;;AACUX,QAAAA,SAAA,CAAA,CAACW,CAAD,EAAI,CAAJ,CAAA,CAAA,CAAA;AACZ,OAAA;;MACAlB,UAAA,CAAWsC,OAAX,CAAA,CAAA;AACF,KAAA;GAXF,CAAA;;AAcAE,EAAAA,SAAA,CAAU,YAAM;AACV,IAAA,IAAA/C,QAAA,KAAa,CAAb,IAAkB,CAACQ,MAAnB,EAA2B;AACpBI,MAAAA,QAAA,CAAAoC,OAAA,GAAUC,MAAO,CAAAC,UAAP,CAAkB,YAAM;QACzC3C,UAAA,CAAW,KAAX,CAAA,CAAA;QACAE,SAAA,CAAU,IAAV,CAAA,CAAA;OAFiB,EAGhBT,QAHgB,CAAV,CAAA;AAIX,KAAA;;AACA,IAAA,OAAO,YAAM;MACX,IAAIY,QAAS,CAAAoC,OAAb,EAA6BC,MAAA,CAAAE,YAAA,CAAavC,SAASoC,OAAtB,CAAA,CAAA;KAD/B,CAAA;AAGC,GAVH,EAUG,CAAChD,QAAD,EAAWQ,MAAX,CAVH,CAAA,CAAA;EAYA4C,mBAAA,CAAoB1D,GAApB,EAAyB,YAAA;AAAA,IAAA,OAAA,aAAA,CAAA;AACvBwB,MAAAA,UAAA,EAAAA,UAAAA;AADuB,KAAA,EAElBR,QAAS,CAAAsC,OAAT,IAAoB,EAFF,CAAA,CAAA;AAAA,GAAzB,CAAA,CAAA;AAKA,EAAA,sBACGP,KAAA,CAAAC,aAAA,CAAAW,KAAA,EAAA,aAAA,CAAA;AACC3D,IAAAA,GAAK,EAAAgB,QADN;AAECb,IAAAA,cAAA,EAAAA,cAFD;AAGCD,IAAAA,SAAA,EAAWqB,kBAAkB,QAAQrB,SAHtC;AAICE,IAAAA,gBAAkB,EAAAiB,YAJnB;AAKC8B,IAAAA,OAAS,EAAAvC,WALV;AAMCgD,IAAAA,eAAiB,EAAAV,aANlB;AAOCW,IAAAA,aAAe,EAAA;MACbC,QAAU,EAAAvC,eAAA,GAAkB,CAAC;AAAEwC,QAAAA,IAAM,EAAA,QAAR;AAAkBC,QAAAA,OAAS,EAAA;AAAE7C,UAAAA,MAAO,EAAPA,MAAAA;AAAF,SAAA;AAA3B,OAAD,CAAlB,GAA8D,EAAA;KAR3E;AAUCZ,IAAAA,SAAA,EAAWgB,kBAAkB,gBAAgBhB,SAAAA;AAV9C,GAAA,EAWKC,SAXL,CAAA,eAaEyD,eAAe5D,SAAf,GAA2BgC,kBAAmB,CAAAhC,QAAA,CAA9C,GAA0DA,QAb5D,CADH,CAAA;AAiBD,CAzGe,EAAhB;AA2GAR,OAAA,CAAQyC,WAAR,GAAsB,SAAtB,CAAA;AACAzC,OAAA,CAAQqE,YAAR,GAAuBC,mBAAvB;;;;"}