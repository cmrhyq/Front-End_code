{"version":3,"file":"DateRangePicker.js","sources":["../../src/date-picker/DateRangePicker.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useState } from 'react';\nimport classNames from 'classnames';\nimport dayjs from 'dayjs';\nimport useConfig from '../hooks/useConfig';\nimport { StyledProps } from '../common';\nimport { TdDateRangePickerProps } from './type';\nimport { RangeInputPopup } from '../range-input';\nimport RangePanel from './panel/RangePanel';\nimport useRange from './hooks/useRange';\nimport { initYearMonthTime } from './hooks/useRangeValue';\nimport { parseToDayjs, formatTime, formatDate, isValidDate, getDefaultFormat } from '../_common/js/date-picker/format';\nimport { subtractMonth, addMonth, extractTimeObj } from '../_common/js/date-picker/utils';\nimport { dateRangePickerDefaultProps } from './defaultProps';\nimport log from '../_common/js/log';\n\nexport interface DateRangePickerProps extends TdDateRangePickerProps, StyledProps {}\n\nconst DateRangePicker = forwardRef<HTMLDivElement, DateRangePickerProps>((props, ref) => {\n  const { classPrefix, datePicker: globalDatePickerConfig } = useConfig();\n\n  const {\n    className,\n    style,\n    disabled,\n    mode,\n    enableTimePicker,\n    disableDate,\n    firstDayOfWeek = globalDatePickerConfig.firstDayOfWeek,\n    presets,\n    timePickerProps,\n    presetsPlacement,\n    panelPreselection,\n    onPick,\n  } = props;\n\n  const {\n    inputValue,\n    popupVisible,\n    rangeInputProps,\n    popupProps,\n    value,\n    year,\n    month,\n    time,\n    activeIndex,\n    isHoverCell,\n    setActiveIndex,\n    onChange,\n    setIsHoverCell,\n    setInputValue,\n    setPopupVisible,\n    setTime,\n    setYear,\n    setMonth,\n    isFirstValueSelected,\n    setIsFirstValueSelected,\n    cacheValue,\n    setCacheValue,\n  } = useRange(props);\n\n  const { format, valueType, timeFormat } = getDefaultFormat({\n    mode,\n    enableTimePicker,\n    format: props.format,\n    valueType: props.valueType,\n  });\n\n  // 记录面板是否选中过\n  const [isSelected, setIsSelected] = useState(false);\n\n  useEffect(() => {\n    // 面板展开重置数据\n    if (popupVisible) {\n      setIsSelected(false);\n      setCacheValue(formatDate(value || [], { format, targetFormat: format }));\n      setTime(formatTime(value || [dayjs().format(timeFormat), dayjs().format(timeFormat)], timeFormat));\n\n      // 空数据重置为当前年月\n      if (!value.length) {\n        setYear(initYearMonthTime({ value, mode, format }).year);\n        setMonth(initYearMonthTime({ value, mode, format, enableTimePicker }).month);\n      } else if (value.length === 2 && !enableTimePicker) {\n        // 确保右侧面板月份比左侧大 避免两侧面板月份一致\n        const nextMonth = value.map((v: string) => parseToDayjs(v || new Date(), format).month());\n        if (year[0] === year[1] && nextMonth[0] === nextMonth[1]) {\n          nextMonth[0] === 11 ? (nextMonth[0] -= 1) : (nextMonth[1] += 1);\n        }\n        setMonth(nextMonth);\n      } else {\n        setYear(value.map((v: string) => parseToDayjs(v || new Date(), format).year()));\n        setMonth(value.map((v: string) => parseToDayjs(v || new Date(), format).month()));\n      }\n    } else {\n      setIsHoverCell(false);\n      setIsFirstValueSelected(false);\n      setInputValue(formatDate(value || [], { format, targetFormat: format }));\n    }\n    // eslint-disable-next-line\n  }, [popupVisible]);\n\n  // 日期 hover\n  function onCellMouseEnter(date: Date) {\n    setIsHoverCell(true);\n    const nextValue = [...inputValue];\n    nextValue[activeIndex] = formatDate(date, { format, targetFormat: format });\n    setInputValue(nextValue);\n  }\n\n  // 日期 leave\n  function onCellMouseLeave() {\n    setIsHoverCell(false);\n    setInputValue(cacheValue);\n  }\n\n  // 日期点击\n  function onCellClick(date: Date, { e, partial }) {\n    onPick?.(date, { e, partial: activeIndex ? 'end' : 'start' });\n\n    setIsHoverCell(false);\n    setIsSelected(true);\n\n    const nextValue = [...inputValue];\n    nextValue[activeIndex] = formatDate(date, { format, targetFormat: format });\n    setCacheValue(nextValue);\n    setInputValue(nextValue);\n\n    // date 模式自动切换年月\n    if (mode === 'date') {\n      // 选择了不属于面板中展示月份的日期\n      const partialIndex = partial === 'start' ? 0 : 1;\n      const isAdditional = dayjs(date).month() !== month[partialIndex];\n      if (isAdditional) {\n        // 保证左侧时间小于右侧\n        if (activeIndex === 0) setMonth([dayjs(date).month(), Math.min(dayjs(date).month() + 1, 11)]);\n        if (activeIndex === 1) setMonth([Math.max(dayjs(date).month() - 1, 0), dayjs(date).month()]);\n      }\n    }\n\n    // 有时间选择器走 confirm 逻辑\n    if (enableTimePicker) return;\n\n    // 确保两端都是有效值\n    const notValidIndex = nextValue.findIndex((v) => !v || !isValidDate(v, format));\n\n    // 当两端都有有效值时更改 value\n    if (notValidIndex === -1 && nextValue.length === 2) {\n      onChange(formatDate(nextValue, { format, targetFormat: valueType }), {\n        dayjsValue: nextValue.map((v) => dayjs(v)),\n        trigger: 'pick',\n      });\n    }\n\n    // 首次点击不关闭、确保两端都有有效值并且无时间选择器时点击后自动关闭\n    if (!isFirstValueSelected) {\n      let nextIndex = notValidIndex;\n      if (nextIndex === -1) nextIndex = activeIndex ? 0 : 1;\n      setActiveIndex(nextIndex);\n      setIsFirstValueSelected(true);\n    } else {\n      setPopupVisible(false);\n    }\n  }\n\n  // 头部快速切换\n  function onJumperClick({ trigger, partial }) {\n    const partialIndex = partial === 'start' ? 0 : 1;\n\n    const monthCountMap = { date: 1, week: 1, month: 12, quarter: 12, year: 120 };\n    const monthCount = monthCountMap[mode] || 0;\n    const current = new Date(year[partialIndex], month[partialIndex]);\n\n    let next = null;\n    if (trigger === 'prev') {\n      next = subtractMonth(current, monthCount);\n    } else if (trigger === 'current') {\n      next = new Date();\n    } else if (trigger === 'next') {\n      next = addMonth(current, monthCount);\n    }\n\n    const nextYear = [...year];\n    nextYear[partialIndex] = next.getFullYear();\n    const nextMonth = [...month];\n    nextMonth[partialIndex] = next.getMonth();\n\n    // 保证左侧时间不大于右侧\n    if (partialIndex === 0) {\n      nextYear[1] = Math.max(nextYear[0], nextYear[1]);\n\n      if (nextYear[0] === nextYear[1]) {\n        nextMonth[1] = Math.max(nextMonth[0], nextMonth[1]);\n      }\n    }\n\n    // 保证左侧时间不大于右侧\n    if (partialIndex === 1) {\n      nextYear[0] = Math.min(nextYear[0], nextYear[1]);\n\n      if (nextYear[0] === nextYear[1]) {\n        nextMonth[0] = Math.min(nextMonth[0], nextMonth[1]);\n      }\n    }\n\n    setYear(nextYear);\n    setMonth(nextMonth);\n  }\n\n  // time-picker 点击\n  function onTimePickerChange(val: string) {\n    const { hours, minutes, seconds, milliseconds, meridiem } = extractTimeObj(val);\n\n    const nextInputValue = [...inputValue];\n    const changedInputValue = inputValue[activeIndex];\n    const currentDate = !dayjs(changedInputValue, format).isValid()\n      ? dayjs().year(year[activeIndex]).month(month[activeIndex])\n      : dayjs(changedInputValue, format);\n    // am pm 12小时制转化 24小时制\n    let nextHours = hours;\n    if (/am/i.test(meridiem) && nextHours === 12) nextHours -= 12;\n    if (/pm/i.test(meridiem) && nextHours < 12) nextHours += 12;\n\n    const nextDate = currentDate.hour(nextHours).minute(minutes).second(seconds).millisecond(milliseconds).toDate();\n    nextInputValue[activeIndex] = nextDate;\n\n    const nextTime = [...time];\n    nextTime[activeIndex] = val;\n    setTime(nextTime);\n\n    setIsSelected(true);\n    setInputValue(formatDate(nextInputValue, { format, targetFormat: format }));\n    setCacheValue(formatDate(nextInputValue, { format, targetFormat: format }));\n  }\n\n  // 确定\n  function onConfirmClick() {\n    const nextValue = [...inputValue];\n\n    const notValidIndex = nextValue.findIndex((v) => !v || !isValidDate(v, format));\n\n    // 当两端都有有效值时更改 value\n    if (notValidIndex === -1 && nextValue.length === 2) {\n      onChange(formatDate(nextValue, { format, targetFormat: valueType }), {\n        dayjsValue: nextValue.map((v) => dayjs(v)),\n        trigger: 'confirm',\n      });\n      setYear(nextValue.map((v) => dayjs(v, format).year()));\n      setMonth(nextValue.map((v) => dayjs(v, format).month()));\n    }\n\n    // 首次点击不关闭、确保两端都有有效值并且无时间选择器时点击后自动关闭\n    if (!isFirstValueSelected) {\n      let nextIndex = notValidIndex;\n      if (nextIndex === -1) nextIndex = activeIndex ? 0 : 1;\n      setActiveIndex(nextIndex);\n      setIsFirstValueSelected(true);\n    } else {\n      setPopupVisible(false);\n    }\n  }\n\n  // 预设\n  function onPresetClick(preset: any) {\n    let presetValue = preset;\n    if (typeof preset === 'function') {\n      presetValue = preset();\n    }\n    if (!Array.isArray(presetValue)) {\n      log.error('DateRangePicker', `preset: ${preset} 预设值必须是数组!`);\n    } else {\n      onChange(formatDate(presetValue, { format, targetFormat: valueType }), {\n        dayjsValue: presetValue.map((p) => dayjs(p)),\n        trigger: 'preset',\n      });\n      setPopupVisible(false);\n    }\n  }\n\n  function onYearChange(nextVal: number, { partial }) {\n    let partialIndex = partial === 'start' ? 0 : 1;\n    if (enableTimePicker) partialIndex = activeIndex;\n\n    const nextYear = [...year];\n    nextYear[partialIndex] = nextVal;\n    // 保证左侧时间不大于右侧\n    if (partialIndex === 0) nextYear[1] = Math.max(nextYear[0], nextYear[1]);\n    if (partialIndex === 1) nextYear[0] = Math.min(nextYear[0], nextYear[1]);\n\n    setYear(nextYear);\n  }\n\n  function onMonthChange(nextVal: number, { partial }) {\n    let partialIndex = partial === 'start' ? 0 : 1;\n    if (enableTimePicker) partialIndex = activeIndex;\n\n    const nextMonth = [...month];\n    nextMonth[partialIndex] = nextVal;\n    // 保证左侧时间不大于右侧\n    if (year[0] === year[1]) {\n      if (partialIndex === 0) nextMonth[1] = Math.max(nextMonth[0], nextMonth[1]);\n      if (partialIndex === 1) nextMonth[0] = Math.min(nextMonth[0], nextMonth[1]);\n    }\n\n    setMonth(nextMonth);\n  }\n\n  const panelProps = {\n    hoverValue: isHoverCell ? inputValue : [],\n    value: isSelected ? cacheValue : value,\n    isFirstValueSelected,\n    panelPreselection,\n    year,\n    month,\n    mode,\n    format,\n    presets,\n    time,\n    disableDate,\n    firstDayOfWeek,\n    timePickerProps,\n    enableTimePicker,\n    presetsPlacement,\n    activeIndex,\n    popupVisible,\n    onCellClick,\n    onCellMouseEnter,\n    onCellMouseLeave,\n    onJumperClick,\n    onConfirmClick,\n    onPresetClick,\n    onYearChange,\n    onMonthChange,\n    onTimePickerChange,\n  };\n\n  return (\n    <div className={classNames(`${classPrefix}-date-range-picker`, className)} style={style} ref={ref}>\n      <RangeInputPopup\n        disabled={disabled}\n        status={props.status}\n        tips={props.tips}\n        inputValue={inputValue}\n        popupProps={popupProps}\n        rangeInputProps={rangeInputProps}\n        popupVisible={popupVisible}\n        panel={<RangePanel {...panelProps} />}\n      />\n    </div>\n  );\n});\n\nDateRangePicker.displayName = 'DateRangePicker';\nDateRangePicker.defaultProps = dateRangePickerDefaultProps;\n\nexport default DateRangePicker;\n"],"names":["DateRangePicker","forwardRef","props","ref","useConfig","classPrefix","globalDatePickerConfig","datePicker","className","style","disabled","mode","enableTimePicker","disableDate","firstDayOfWeek","presets","timePickerProps","presetsPlacement","panelPreselection","onPick","useRange","inputValue","popupVisible","rangeInputProps","popupProps","value","year","month","time","activeIndex","isHoverCell","setActiveIndex","onChange","setIsHoverCell","setInputValue","setPopupVisible","setTime","setYear","setMonth","isFirstValueSelected","setIsFirstValueSelected","cacheValue","setCacheValue","getDefaultFormat","format","valueType","timeFormat","useState","isSelected","setIsSelected","useEffect","formatDate","targetFormat","formatTime","dayjs","length","initYearMonthTime","nextMonth","map","v","parseToDayjs","Date","onCellMouseEnter","date","nextValue","onCellMouseLeave","onCellClick","e","partial","partialIndex","isAdditional","Math","min","max","notValidIndex","findIndex","isValidDate","dayjsValue","trigger","nextIndex","onJumperClick","monthCountMap","week","quarter","monthCount","current","next","subtractMonth","addMonth","nextYear","getFullYear","getMonth","onTimePickerChange","val","extractTimeObj","hours","minutes","seconds","milliseconds","meridiem","nextInputValue","changedInputValue","currentDate","isValid","nextHours","test","nextDate","hour","minute","second","millisecond","toDate","nextTime","onConfirmClick","onPresetClick","preset","presetValue","Array","isArray","log","error","p","onYearChange","nextVal","onMonthChange","panelProps","hoverValue","React","createElement","classNames","RangeInputPopup","status","tips","panel","RangePanel","displayName","defaultProps","dateRangePickerDefaultProps"],"mappings":"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"}