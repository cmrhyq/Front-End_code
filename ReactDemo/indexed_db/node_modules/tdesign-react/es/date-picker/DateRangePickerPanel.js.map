{"version":3,"file":"DateRangePickerPanel.js","sources":["../../src/date-picker/DateRangePickerPanel.tsx"],"sourcesContent":["import React, { forwardRef, useState, useMemo } from 'react';\nimport dayjs from 'dayjs';\nimport { StyledProps } from '../common';\nimport {\n  TdDateRangePickerPanelProps,\n  DatePickerYearChangeTrigger,\n  DatePickerMonthChangeTrigger,\n  DatePickerTimeChangeTrigger,\n} from './type';\nimport RangePanel from './panel/RangePanel';\nimport useRangeValue from './hooks/useRangeValue';\nimport { formatDate, getDefaultFormat } from '../_common/js/date-picker/format';\nimport { subtractMonth, addMonth, extractTimeObj } from '../_common/js/date-picker/utils';\nimport log from '../_common/js/log';\n\nexport interface DateRangePickerPanelProps extends TdDateRangePickerPanelProps, StyledProps {}\n\nconst DateRangePickerPanel = forwardRef<HTMLDivElement, DateRangePickerPanelProps>((props, ref) => {\n  const {\n    className,\n    style,\n    mode,\n    enableTimePicker,\n    disableDate,\n    firstDayOfWeek,\n    presets,\n    timePickerProps,\n    presetsPlacement,\n    panelPreselection,\n    onPanelClick,\n  } = props;\n\n  const {\n    value,\n    year,\n    month,\n    time,\n    onChange,\n    setTime,\n    setYear,\n    setMonth,\n    isFirstValueSelected,\n    setIsFirstValueSelected,\n    cacheValue,\n    setCacheValue,\n  } = useRangeValue(props);\n\n  const { format, valueType } = getDefaultFormat({\n    mode,\n    enableTimePicker,\n    format: props.format,\n    valueType: props.valueType,\n  });\n\n  // 记录面板是否选中过\n  const [isSelected, setIsSelected] = useState(false);\n  const [isHoverCell, setIsHoverCell] = useState(false);\n  const [hoverValue, setHoverValue] = useState([]);\n  const activeIndex = useMemo(() => (isFirstValueSelected ? 1 : 0), [isFirstValueSelected]);\n\n  // 日期 hover\n  function onCellMouseEnter(date: Date) {\n    setIsHoverCell(true);\n    const nextValue = [...hoverValue];\n    nextValue[activeIndex] = formatDate(date, { format, targetFormat: format });\n    setHoverValue(nextValue);\n  }\n\n  // 日期 leave\n  function onCellMouseLeave() {\n    setIsHoverCell(false);\n    setHoverValue(cacheValue);\n  }\n\n  // 日期点击\n  function onCellClick(date: Date, { e, partial }) {\n    setIsSelected(true);\n\n    const nextValue = [...cacheValue];\n    nextValue[activeIndex] = formatDate(date, { format, targetFormat: format });\n    setCacheValue(nextValue);\n\n    props.onCellClick?.({ date: nextValue.map((v) => dayjs(v).toDate()), e, partial: activeIndex ? 'end' : 'start' });\n\n    // date 模式自动切换年月\n    if (mode === 'date') {\n      // 选择了不属于面板中展示月份的日期\n      const partialIndex = partial === 'start' ? 0 : 1;\n      const isAdditional = dayjs(date).month() !== month[partialIndex];\n      if (isAdditional) {\n        // 保证左侧时间小于右侧\n        if (activeIndex === 0) setMonth([dayjs(date).month(), Math.min(dayjs(date).month() + 1, 11)]);\n        if (activeIndex === 1) setMonth([Math.max(dayjs(date).month() - 1, 0), dayjs(date).month()]);\n      }\n    }\n\n    // 有时间选择器走 confirm 逻辑\n    if (enableTimePicker) return;\n\n    // 首次点击不关闭、确保两端都有有效值并且无时间选择器时点击后自动关闭\n    if (nextValue.length === 2 && isFirstValueSelected) {\n      onChange(formatDate(nextValue, { format, targetFormat: valueType }), {\n        dayjsValue: nextValue.map((v) => dayjs(v)),\n        trigger: 'pick',\n      });\n      setIsFirstValueSelected(false);\n    } else {\n      // 记录选中一次\n      setIsFirstValueSelected(true);\n    }\n  }\n\n  // 头部快速切换\n  function onJumperClick({ trigger, partial }) {\n    const partialIndex = partial === 'start' ? 0 : 1;\n\n    const triggerMap = { '-1': 'arrow-previous', 1: 'arrow-next' };\n    const monthCountMap = { date: 1, week: 1, month: 12, quarter: 12, year: 120 };\n    const monthCount = monthCountMap[mode] || 0;\n    const current = new Date(year[partialIndex], month[partialIndex]);\n\n    let next = null;\n    if (trigger === 'prev') {\n      next = subtractMonth(current, monthCount);\n    } else if (trigger === 'current') {\n      next = new Date();\n    } else if (trigger === 'next') {\n      next = addMonth(current, monthCount);\n    }\n\n    const nextYear = [...year];\n    nextYear[partialIndex] = next.getFullYear();\n    const nextMonth = [...month];\n    nextMonth[partialIndex] = next.getMonth();\n\n    // 保证左侧时间不大于右侧\n    if (partialIndex === 0) {\n      nextYear[1] = Math.max(nextYear[0], nextYear[1]);\n\n      if (nextYear[0] === nextYear[1]) {\n        nextMonth[1] = Math.max(nextMonth[0], nextMonth[1]);\n      }\n    }\n\n    // 保证左侧时间不大于右侧\n    if (partialIndex === 1) {\n      nextYear[0] = Math.min(nextYear[0], nextYear[1]);\n\n      if (nextYear[0] === nextYear[1]) {\n        nextMonth[0] = Math.min(nextMonth[0], nextMonth[1]);\n      }\n    }\n\n    if (year.some((y) => !nextYear.includes(y))) {\n      props.onYearChange?.({\n        partial,\n        year: nextYear[partialIndex],\n        date: value.map((v) => dayjs(v).toDate()),\n        trigger: trigger === 'current' ? 'today' : (`year-${triggerMap[trigger]}` as DatePickerYearChangeTrigger),\n      });\n    }\n\n    if (month.some((m) => !nextMonth.includes(m))) {\n      props.onMonthChange?.({\n        partial,\n        month: nextMonth[partialIndex],\n        date: value.map((v) => dayjs(v).toDate()),\n        trigger: trigger === 'current' ? 'today' : (`month-${triggerMap[trigger]}` as DatePickerMonthChangeTrigger),\n      });\n    }\n\n    setYear(nextYear);\n    setMonth(nextMonth);\n  }\n\n  // time-picker 点击\n  function onTimePickerChange(val: string) {\n    const { hours, minutes, seconds, milliseconds, meridiem } = extractTimeObj(val);\n\n    const nextInputValue = [...cacheValue];\n    const changedInputValue = cacheValue[activeIndex];\n    const currentDate = !dayjs(changedInputValue, format).isValid()\n      ? dayjs().year(year[activeIndex]).month(month[activeIndex])\n      : dayjs(changedInputValue, format);\n    // am pm 12小时制转化 24小时制\n    let nextHours = hours;\n    if (/am/i.test(meridiem) && nextHours === 12) nextHours -= 12;\n    if (/pm/i.test(meridiem) && nextHours < 12) nextHours += 12;\n\n    const nextDate = currentDate.hour(nextHours).minute(minutes).second(seconds).millisecond(milliseconds).toDate();\n    nextInputValue[activeIndex] = nextDate;\n\n    const nextTime = [...time];\n    nextTime[activeIndex] = val;\n    setTime(nextTime);\n\n    setIsSelected(true);\n    setCacheValue(formatDate(nextInputValue, { format, targetFormat: format }));\n\n    props.onTimeChange?.({\n      time: val,\n      partial: activeIndex ? 'end' : 'start',\n      date: value.map((v) => dayjs(v).toDate()),\n      trigger: 'time-hour' as DatePickerTimeChangeTrigger,\n    });\n  }\n\n  // 确定\n  function onConfirmClick({ e }) {\n    const nextValue = [...cacheValue];\n\n    // 首次点击不关闭、确保两端都有有效值并且无时间选择器时点击后自动关闭\n    if (nextValue.length === 2 && isFirstValueSelected) {\n      onChange(formatDate(nextValue, { format, targetFormat: valueType }), {\n        dayjsValue: nextValue.map((v) => dayjs(v)),\n        trigger: 'confirm',\n      });\n      setYear(nextValue.map((v) => dayjs(v, format).year()));\n      setMonth(nextValue.map((v) => dayjs(v, format).month()));\n      setIsFirstValueSelected(false);\n    } else {\n      setIsFirstValueSelected(true);\n    }\n\n    props.onConfirm?.({ date: value.map((v) => dayjs(v).toDate()), e });\n  }\n\n  // 预设\n  function onPresetClick(presetValue: any, { e, preset }) {\n    const presetVal = typeof presetValue === 'function' ? presetValue() : presetValue;\n\n    if (!Array.isArray(presetVal)) {\n      log.error('DateRangePickerPanel', `preset: ${presetValue} 预设值必须是数组!`);\n    } else {\n      onChange(formatDate(presetVal, { format, targetFormat: valueType }), {\n        dayjsValue: presetVal.map((p) => dayjs(p)),\n        trigger: 'preset',\n      });\n    }\n\n    props.onPresetClick?.({ e, preset });\n  }\n\n  function onYearChange(nextVal: number, { partial }) {\n    let partialIndex = partial === 'start' ? 0 : 1;\n    if (enableTimePicker) partialIndex = activeIndex;\n\n    const nextYear = [...year];\n    nextYear[partialIndex] = nextVal;\n    // 保证左侧时间不大于右侧\n    if (partialIndex === 0) nextYear[1] = Math.max(nextYear[0], nextYear[1]);\n    if (partialIndex === 1) nextYear[0] = Math.min(nextYear[0], nextYear[1]);\n\n    setYear(nextYear);\n\n    props.onYearChange({\n      partial,\n      year: nextYear[partialIndex],\n      date: value.map((v) => dayjs(v).toDate()),\n      trigger: 'year-select',\n    });\n  }\n\n  function onMonthChange(nextVal: number, { partial }) {\n    let partialIndex = partial === 'start' ? 0 : 1;\n    if (enableTimePicker) partialIndex = activeIndex;\n\n    const nextMonth = [...month];\n    nextMonth[partialIndex] = nextVal;\n    // 保证左侧时间不大于右侧\n    if (year[0] === year[1]) {\n      if (partialIndex === 0) nextMonth[1] = Math.max(nextMonth[0], nextMonth[1]);\n      if (partialIndex === 1) nextMonth[0] = Math.min(nextMonth[0], nextMonth[1]);\n    }\n\n    setMonth(nextMonth);\n\n    props.onMonthChange({\n      partial,\n      month: nextMonth[partialIndex],\n      date: value.map((v) => dayjs(v).toDate()),\n      trigger: 'month-select',\n    });\n  }\n\n  const panelProps = {\n    hoverValue: isHoverCell ? hoverValue : [],\n    value: isSelected ? cacheValue : value,\n    year,\n    month,\n    mode,\n    format,\n    presets,\n    time,\n    disableDate,\n    firstDayOfWeek,\n    timePickerProps,\n    enableTimePicker,\n    presetsPlacement,\n    activeIndex,\n    panelPreselection,\n    onCellMouseEnter,\n    onCellMouseLeave,\n    onCellClick,\n    onJumperClick,\n    onConfirmClick,\n    onPresetClick,\n    onYearChange,\n    onMonthChange,\n    onTimePickerChange,\n    onPanelClick,\n  };\n\n  return <RangePanel ref={ref} className={className} style={style} {...panelProps} />;\n});\n\nDateRangePickerPanel.displayName = 'DateRangePickerPanel';\nDateRangePickerPanel.defaultProps = {\n  mode: 'date',\n  defaultValue: [],\n  panelPreselection: true,\n};\n\nexport default DateRangePickerPanel;\n"],"names":["DateRangePickerPanel","forwardRef","props","ref","className","style","mode","enableTimePicker","disableDate","firstDayOfWeek","presets","timePickerProps","presetsPlacement","panelPreselection","onPanelClick","useRangeValue","value","year","month","time","onChange","setTime","setYear","setMonth","isFirstValueSelected","setIsFirstValueSelected","cacheValue","setCacheValue","getDefaultFormat","format","valueType","useState","isSelected","setIsSelected","isHoverCell","setIsHoverCell","hoverValue","setHoverValue","activeIndex","useMemo","onCellMouseEnter","date","nextValue","formatDate","targetFormat","onCellMouseLeave","onCellClick","e","partial","map","v","dayjs","toDate","partialIndex","isAdditional","Math","min","max","length","dayjsValue","trigger","onJumperClick","triggerMap","monthCountMap","week","quarter","monthCount","current","Date","next","subtractMonth","addMonth","nextYear","getFullYear","nextMonth","getMonth","some","y","includes","onYearChange","m","onMonthChange","onTimePickerChange","val","extractTimeObj","hours","minutes","seconds","milliseconds","meridiem","nextInputValue","changedInputValue","currentDate","isValid","nextHours","test","nextDate","hour","minute","second","millisecond","nextTime","onTimeChange","onConfirmClick","onConfirm","onPresetClick","presetValue","preset","presetVal","Array","isArray","log","error","p","nextVal","panelProps","React","createElement","RangePanel","displayName","defaultProps","defaultValue"],"mappings":"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"}