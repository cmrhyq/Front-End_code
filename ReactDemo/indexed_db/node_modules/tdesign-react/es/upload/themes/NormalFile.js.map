{"version":3,"file":"NormalFile.js","sources":["../../../src/upload/themes/NormalFile.tsx"],"sourcesContent":["import React from 'react';\nimport {\n  CloseIcon as TdCloseIcon,\n  TimeFilledIcon as TdTimeFilledIcon,\n  CheckCircleFilledIcon as TdCheckCircleFilledIcon,\n  ErrorCircleFilledIcon as TdErrorCircleFilledIcon,\n  CloseCircleFilledIcon as TdCloseCircleFilledIcon,\n} from 'tdesign-icons-react';\nimport classNames from 'classnames';\nimport TLoading from '../../loading';\nimport Link from '../../link';\nimport { UploadFile } from '../type';\nimport { abridgeName } from '../../_common/js/upload/utils';\nimport useGlobalIcon from '../../hooks/useGlobalIcon';\nimport { CommonDisplayFileProps } from '../interface';\n\nexport interface NormalFileProps extends CommonDisplayFileProps {\n  multiple: boolean;\n}\n\nexport default function NormalFile(props: NormalFileProps) {\n  const { theme, disabled, classPrefix, locale } = props;\n\n  const { CloseIcon, TimeFilledIcon, CheckCircleFilledIcon, ErrorCircleFilledIcon, CloseCircleFilledIcon } =\n    useGlobalIcon({\n      CloseIcon: TdCloseIcon,\n      TimeFilledIcon: TdTimeFilledIcon,\n      CheckCircleFilledIcon: TdCheckCircleFilledIcon,\n      ErrorCircleFilledIcon: TdErrorCircleFilledIcon,\n      CloseCircleFilledIcon: TdCloseCircleFilledIcon,\n    });\n\n  const uploadPrefix = `${classPrefix}-upload`;\n\n  const renderProgress = (percent: number) => (\n    <div className={`${uploadPrefix}__single-progress`}>\n      <TLoading />\n      <span className={`${uploadPrefix}__single-percent`}>{percent}%</span>\n    </div>\n  );\n\n  // 文本型预览\n  const renderFilePreviewAsText = (files: UploadFile[]) => {\n    if (theme !== 'file') return null;\n    if (!props.multiple && files[0]?.status === 'fail') {\n      return null;\n    }\n    return files.map((file, index) => (\n      <div\n        className={`${uploadPrefix}__single-display-text ${uploadPrefix}__display-text--margin`}\n        key={file.name + index}\n      >\n        {file.url ? (\n          <Link href={file.url} target=\"_blank\" hover=\"color\" size=\"small\" className={`${uploadPrefix}__single-name`}>\n            {file.name}\n          </Link>\n        ) : (\n          <span className={`${uploadPrefix}__single-name`}>{file.name}</span>\n        )}\n        {file.status === 'fail' && (\n          <div className={`${uploadPrefix}__flow-status`}>\n            <ErrorCircleFilledIcon />\n          </div>\n        )}\n        {file.status === 'waiting' && (\n          <div className={`${uploadPrefix}__flow-status`}>\n            <TimeFilledIcon />\n          </div>\n        )}\n        {file.status === 'progress' && renderProgress(file.percent)}\n        {!disabled && file.status !== 'progress' && (\n          <CloseIcon className={`${uploadPrefix}__icon-delete`} onClick={(e) => props.onRemove({ e, file, index })} />\n        )}\n      </div>\n    ));\n  };\n\n  // 输入框型预览\n  const renderFilePreviewAsInput = () => {\n    if (theme !== 'file-input') return;\n    const file = props.displayFiles[0];\n    const inputTextClass = [\n      `${classPrefix}-input__inner`,\n      { [`${uploadPrefix}__placeholder`]: !props.displayFiles[0] },\n    ];\n    const disabledClass = disabled ? `${classPrefix}-is-disabled` : '';\n    return (\n      <div className={`${uploadPrefix}__single-input-preview ${classPrefix}-input ${disabledClass}`}>\n        <div className={classNames(inputTextClass)}>\n          <span className={`${uploadPrefix}__single-input-text`}>\n            {file?.name ? abridgeName(file.name, 4, 6) : props.placeholder}\n          </span>\n          {file?.status === 'progress' && renderProgress(file.percent)}\n          {file?.status === 'waiting' && <TimeFilledIcon className={`${uploadPrefix}__status-icon`} />}\n          {file?.url && file.status === 'success' && (\n            <CheckCircleFilledIcon className={`${uploadPrefix}__status-icon`} />\n          )}\n          {file?.name && file.status === 'fail' && <ErrorCircleFilledIcon className={`${uploadPrefix}__status-icon`} />}\n          {!disabled && (\n            <CloseCircleFilledIcon\n              className={`${uploadPrefix}__single-input-clear`}\n              onClick={(e) => props.onRemove({ e, file, index: 0 })}\n            />\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  const { displayFiles } = props;\n  const fileListDisplay = props.fileListDisplay?.({ files: displayFiles });\n\n  const classes = [`${uploadPrefix}__single`, `${uploadPrefix}__single-${theme}`];\n  return (\n    <div className={classNames(classes)}>\n      {theme === 'file-input' && renderFilePreviewAsInput()}\n\n      {props.children}\n\n      {props.tips && <small className={classNames(props.tipsClasses)}>{props.tips}</small>}\n      {theme === 'file' && props.placeholder && !displayFiles[0] && (\n        <small className={classNames(props.tipsClasses)}>{props.placeholder}</small>\n      )}\n\n      {fileListDisplay || renderFilePreviewAsText(displayFiles)}\n\n      {props.sizeOverLimitMessage && (\n        <small className={classNames(props.errorClasses)}>{props.sizeOverLimitMessage}</small>\n      )}\n\n      {/* 单文件上传失败要显示失败的原因 */}\n      {!props.multiple && displayFiles[0]?.status === 'fail' ? (\n        <small className={classNames(props.errorClasses)}>\n          {displayFiles[0].response?.error || locale.progress.failText}\n        </small>\n      ) : null}\n    </div>\n  );\n}\n\nNormalFile.displayName = 'NormalFile';\n"],"names":["NormalFile","props","theme","disabled","classPrefix","locale","useGlobalIcon","CloseIcon","TdCloseIcon","TimeFilledIcon","TdTimeFilledIcon","CheckCircleFilledIcon","TdCheckCircleFilledIcon","ErrorCircleFilledIcon","TdErrorCircleFilledIcon","CloseCircleFilledIcon","TdCloseCircleFilledIcon","uploadPrefix","renderProgress","percent","React","createElement","className","TLoading","renderFilePreviewAsText","files","multiple","status","map","file","index","key","name","url","Link","href","target","hover","size","onClick","e","onRemove","renderFilePreviewAsInput","displayFiles","inputTextClass","disabledClass","classNames","abridgeName","placeholder","fileListDisplay","classes","children","tips","tipsClasses","sizeOverLimitMessage","errorClasses","response","error","progress","failText","displayName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,SAAwBA,UAAxB,CAAmCC,KAAnC,EAA2D;AAAA,EAAA,IAAA,qBAAA,EAAA,cAAA,EAAA,qBAAA,CAAA;;AACzD,EAAA,IAAQC,KAAR,GAAiDD,KAAjD,CAAQC,KAAR;AAAA,MAAeC,QAAf,GAAiDF,KAAjD,CAAeE,QAAf;AAAA,MAAyBC,WAAzB,GAAiDH,KAAjD,CAAyBG,WAAzB;AAAA,MAAsCC,MAAtC,GAAiDJ,KAAjD,CAAsCI,MAAtC,CAAA;;AAEA,EAAA,IAAA,cAAA,GACEC,aAAc,CAAA;AACZC,IAAAA,SAAW,EAAAC,SADC;AAEZC,IAAAA,cAAgB,EAAAC,cAFJ;AAGZC,IAAAA,qBAAuB,EAAAC,qBAHX;AAIZC,IAAAA,qBAAuB,EAAAC,qBAJX;AAKZC,IAAAA,qBAAuB,EAAAC,qBAAAA;AALX,GAAA,CADhB;MAAQT,WAAR,kBAAQA,SAAR;MAAmBE,gBAAnB,kBAAmBA,cAAnB;MAAmCE,uBAAnC,kBAAmCA,qBAAnC;MAA0DE,uBAA1D,kBAA0DA,qBAA1D;MAAiFE,uBAAjF,kBAAiFA,qBAAjF,CAAA;;EASA,IAAME,eAAkBb,EAAAA,CAAAA,MAAAA,CAAAA,aAAxB,SAAA,CAAA,CAAA;;AAEM,EAAA,IAAAc,cAAA,GAAiB,SAAjBA,cAAiB,CAACC,OAAD,EAAA;AAAA,IAAA,sBACpBC,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIC,MAAAA,qBAAcL;AAAlB,KAAA,iBACCG,KAAA,CAAAC,aAAA,CAACE,OAAD,EAAU,IAAV,CADD,iBAEEH,KAAA,CAAAC,aAAA,CAAA,MAAA,EAAA;AAAKC,MAAAA,qBAAcL;AAAnB,KAAA,EAAoDE,OAApD,EAA4D,GAA5D,CAFF,CADoB,CAAA;GAAjB,CAAA;;AAQA,EAAA,IAAAK,uBAAA,GAA0B,SAA1BA,uBAA0B,CAACC,KAAD,EAAyB;AAAA,IAAA,IAAA,OAAA,CAAA;;AACvD,IAAA,IAAIvB,KAAU,KAAA,MAAd,EAA6B,OAAA,IAAA,CAAA;;AAC7B,IAAA,IAAI,CAACD,KAAM,CAAAyB,QAAP,IAAmB,CAAAD,CAAAA,OAAAA,GAAAA,KAAM,CAAA,CAAA,CAAN,MAAA,IAAA,IAAA,OAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,OAAA,CAAUE,MAAV,MAAqB,MAA5C,EAAoD;AAC3C,MAAA,OAAA,IAAA,CAAA;AACT,KAAA;;AACA,IAAA,OAAOF,KAAM,CAAAG,GAAN,CAAU,UAACC,IAAD,EAAOC,KAAP,EAAA;AAAA,MAAA,sBACdV,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AACCC,QAAAA,SAAA,EAAcL,EAAAA,CAAAA,MAAAA,CAAAA,YAAd,EAAmDA,wBAAAA,CAAAA,CAAAA,MAAAA,CAAAA,YAAnD,EADD,wBAAA,CAAA;AAECc,QAAAA,GAAA,EAAKF,KAAKG,IAAL,GAAYF,KAAAA;OAFlB,EAIED,IAAA,CAAKI,GAAL,kBACEb,KAAA,CAAAC,aAAA,CAAAa,IAAA,EAAA;QAAKC,MAAMN,IAAK,CAAAI,GAAhB;AAAqBG,QAAAA,MAAO,EAAA,QAA5B;AAAqCC,QAAAA,KAAM,EAAA,OAA3C;AAAmDC,QAAAA,IAAK,EAAA,OAAxD;AAAgEhB,QAAAA,qBAAcL;AAA9E,OAAA,EACEY,IAAA,CAAKG,IADP,CADF,kBAKEZ,KAAA,CAAAC,aAAA,CAAA,MAAA,EAAA;AAAKC,QAAAA,qBAAcL;AAAnB,OAAA,EAAiDY,KAAKG,IAAtD,CATJ,EAWEH,IAAK,CAAAF,MAAL,KAAgB,MAAhB,mBACEP,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIC,QAAAA,qBAAcL;OAAlB,qCACEJ,yBAAsB,KADxB,CAZJ,EAgBEgB,IAAK,CAAAF,MAAL,KAAgB,SAAhB,mBACEP,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIC,QAAAA,qBAAcL;AAAlB,OAAA,qCACER,kBAAe,KADjB,CAjBJ,EAqBEoB,IAAA,CAAKF,MAAL,KAAgB,UAAhB,IAA8BT,cAAA,CAAeW,IAAK,CAAAV,OAApB,CArBhC,EAsBE,CAAChB,QAAD,IAAa0B,IAAK,CAAAF,MAAL,KAAgB,UAA7B,mBACEP,KAAA,CAAAC,aAAA,CAAAd,WAAA,EAAA;QAAUe,qBAAcL,cAAxB,eAAA,CAAA;QAAqDsB,OAAA,EAAS,iBAACC,CAAD,EAAA;UAAA,OAAOvC,KAAA,CAAMwC,QAAN,CAAe;AAAED,YAAAA,CAAA,EAAAA,CAAF;AAAKX,YAAAA,IAAM,EAANA,IAAL;AAAWC,YAAAA,KAAA,EAAAA,KAAAA;AAAX,WAAf,CAAP,CAAA;AAAA,SAAA;AAA9D,OAAA,CAvBJ,CADc,CAAA;AAAA,KAAV,CAAP,CAAA;GALI,CAAA;;AAoCN,EAAA,IAAMY,2BAA2B,SAA3BA,wBAA2B,GAAM;IACrC,IAAIxC,KAAU,KAAA,YAAd,EAA4B,OAAA;AACtB,IAAA,IAAA2B,IAAA,GAAO5B,MAAM0C,YAAN,CAAmB,CAAnB,CAAP,CAAA;AACN,IAAA,IAAMC,cAAiB,GAAA,CAClBxC,EAAAA,CAAAA,MAAAA,CAAAA,WADkB,kDAEfa,YAFe,EAAA,eAAA,CAAA,EAEe,CAAChB,KAAA,CAAM0C,YAAN,CAAmB,CAAnB,CAFhB,CAAvB,CAAA,CAAA;AAIM,IAAA,IAAAE,aAAA,GAAgB1C,QAAW,GAAGC,EAAAA,CAAAA,MAAAA,CAAAA,WAAH,oBAA+B,EAA1D,CAAA;AACN,IAAA,sBACGgB,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIC,MAAAA,SAAA,EAAcL,EAAAA,CAAAA,MAAAA,CAAAA,YAAd,EAAoDb,yBAAAA,CAAAA,CAAAA,MAAAA,CAAAA,WAApD,oBAAyEyC,aAAzE,CAAA;AAAJ,KAAA,iBACEzB,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;MAAIC,SAAA,EAAWwB,WAAWF;AAA1B,KAAA,iBACExB,KAAA,CAAAC,aAAA,CAAA,MAAA,EAAA;AAAKC,MAAAA,qBAAcL;AAAnB,KAAA,EACEY,IAAA,KAAA,IAAA,IAAAA,IAAA,KAAA,KAAA,CAAA,IAAAA,IAAA,CAAMG,IAAN,GAAae,WAAY,CAAAlB,IAAA,CAAKG,IAAL,EAAW,CAAX,EAAc,CAAd,CAAzB,GAA4C/B,KAAM,CAAA+C,WADpD,CADF,EAIE,CAAAnB,IAAM,KAAA,IAAN,IAAAA,IAAM,KAAA,KAAA,CAAN,GAAAA,KAAAA,CAAAA,GAAAA,IAAM,CAAAF,MAAN,MAAiB,UAAjB,IAA+BT,cAAe,CAAAW,IAAA,CAAKV,OAAL,CAJhD,EAKE,CAAAU,IAAA,KAAA,IAAA,IAAAA,IAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,IAAA,CAAMF,MAAN,MAAiB,SAAjB,mBAA+BP,KAAA,CAAAC,aAAA,CAAAZ,gBAAA,EAAA;AAAea,MAAAA,qBAAcL;KAA7B,CALjC,EAME,CAAAY,IAAM,KAAA,IAAN,IAAAA,IAAM,KAAA,KAAA,CAAN,GAAAA,KAAAA,CAAAA,GAAAA,IAAM,CAAAI,GAAN,KAAaJ,IAAK,CAAAF,MAAL,KAAgB,SAA7B,mBACEP,KAAA,CAAAC,aAAA,CAAAV,uBAAA,EAAA;AAAsBW,MAAAA,qBAAcL;KAApC,CAPJ,EASE,CAAAY,IAAM,KAAA,IAAN,IAAAA,IAAM,KAAA,KAAA,CAAN,GAAAA,KAAAA,CAAAA,GAAAA,IAAM,CAAAG,IAAN,KAAcH,IAAK,CAAAF,MAAL,KAAgB,MAA9B,mBAAyCP,KAAA,CAAAC,aAAA,CAAAR,uBAAA,EAAA;AAAsBS,MAAAA,qBAAcL;KAApC,CAT3C,EAUE,CAACd,QAAD,mBACEiB,KAAA,CAAAC,aAAA,CAAAN,uBAAA,EAAA;MACCO,qBAAcL,cADf,sBAAA,CAAA;MAECsB,OAAA,EAAS,iBAACC,CAAD,EAAA;QAAA,OAAOvC,KAAM,CAAAwC,QAAN,CAAe;AAAED,UAAAA,CAAG,EAAHA,CAAF;AAAKX,UAAAA,IAAA,EAAAA,IAAL;AAAWC,UAAAA,KAAO,EAAA,CAAA;AAAlB,SAAf,CAAP,CAAA;AAAA,OAAA;KAFV,CAXJ,CADF,CADH,CAAA;GARF,CAAA;;AA+BM,EAAA,IAAEa,YAAF,GAAmB1C,KAAnB,CAAE0C,YAAF,CAAA;EACN,IAAMM,2CAAkBhD,KAAM,CAAAgD,qBAAN,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAAA,IAAA,CAAAhD,KAAM,EAAkB;AAAEwB,IAAAA,KAAA,EAAOkB,YAAAA;AAAT,GAAlB,CAA9B,CAAA;EAEA,IAAMO,UAAU,CAAIjC,EAAAA,CAAAA,MAAAA,CAAAA,YAAJ,yBAA+BA,YAA/B,EAAA,WAAA,CAAA,CAAA,MAAA,CAAuDf,KAAvD,CAAhB,CAAA,CAAA;AACA,EAAA,sBACGkB,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;IAAIC,SAAA,EAAWwB,WAAWI;GAA1B,EACEhD,KAAA,KAAU,YAAV,IAA0BwC,wBAAyB,EADrD,EAGEzC,MAAMkD,QAHR,EAKElD,KAAA,CAAMmD,IAAN,mBAAehC,KAAA,CAAAC,aAAA,CAAA,OAAA,EAAA;AAAMC,IAAAA,SAAA,EAAWwB,UAAW,CAAA7C,KAAA,CAAMoD,WAAN,CAAA;GAA5B,EAAiDpD,KAAA,CAAMmD,IAAvD,CALjB,EAMElD,KAAU,KAAA,MAAV,IAAoBD,MAAM+C,WAA1B,IAAyC,CAACL,YAAa,CAAA,CAAA,CAAvD,mBACEvB,KAAA,CAAAC,aAAA,CAAA,OAAA,EAAA;AAAMC,IAAAA,SAAA,EAAWwB,UAAW,CAAA7C,KAAA,CAAMoD,WAAN,CAAA;GAA5B,EAAiDpD,KAAA,CAAM+C,WAAvD,CAPJ,EAUEC,eAAA,IAAmBzB,wBAAwBmB,aAV7C,EAYE1C,KAAM,CAAAqD,oBAAN,mBACElC,KAAA,CAAAC,aAAA,CAAA,OAAA,EAAA;AAAMC,IAAAA,SAAA,EAAWwB,UAAW,CAAA7C,KAAA,CAAMsD,YAAN,CAAA;GAA5B,EAAkDtD,KAAA,CAAMqD,oBAAxD,CAbJ,EAiBE,CAACrD,KAAA,CAAMyB,QAAP,IAAmB,CAAAiB,CAAAA,cAAAA,GAAAA,YAAa,CAAA,CAAA,CAAb,MAAA,IAAA,IAAA,cAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,cAAA,CAAiBhB,MAAjB,MAA4B,MAA/C,kBACEP,KAAA,CAAAC,aAAA,CAAA,OAAA,EAAA;AAAMC,IAAAA,SAAA,EAAWwB,UAAW,CAAA7C,KAAA,CAAMsD,YAAN,CAAA;AAA5B,GAAA,EACE,CAAAZ,CAAAA,qBAAAA,GAAAA,YAAA,CAAa,CAAb,CAAA,CAAgBa,QAAhB,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAA0BC,KAA1B,KAAmCpD,OAAOqD,QAAP,CAAgBC,QADrD,CADF,GAIG,IArBL,CADH,CAAA;AAyBF,CAAA;AAEA3D,UAAA,CAAW4D,WAAX,GAAyB,YAAzB;;;;"}