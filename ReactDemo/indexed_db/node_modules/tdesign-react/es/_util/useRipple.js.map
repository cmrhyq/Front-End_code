{"version":3,"file":"useRipple.js","sources":["../../src/_util/useRipple.ts"],"sourcesContent":["import { useEffect, useCallback, RefObject, useMemo } from 'react';\nimport useConfig from '../hooks/useConfig';\nimport useAnimation from './useAnimation';\nimport setStyle from './setStyle';\nimport { canUseDocument } from './dom';\n\nconst period = 200;\nconst noneRippleBg = 'rgba(0, 0, 0, 0)';\nconst defaultRippleColor = 'rgba(0, 0, 0, 0.35)';\n\n// 设置动画颜色 get the ripple animation color\nconst getRippleColor = (el: HTMLElement, fixedRippleColor?: string) => {\n  // get fixed color from params\n  if (fixedRippleColor) {\n    return fixedRippleColor;\n  }\n  // get dynamic color from the dataset\n  if (el?.dataset?.ripple) {\n    const rippleColor = el.dataset.ripple;\n    return rippleColor;\n  }\n  // use css variable\n  const cssVariable = getComputedStyle(el).getPropertyValue('--ripple-color');\n  if (cssVariable) {\n    return cssVariable;\n  }\n  return defaultRippleColor;\n};\n\n/**\n * 斜八角动画 hooks 支持三种方式使用\n * 1. fixedRippleColor 固定色值 useRipple(ref,fixedRippleColor);\n * 2. dynamicColor 动态色值 data.ripple=\"rippleColor\" useRipple(ref)\n * 3. CSS variables（recommended） 配合节点对应 CSS 设置 --ripple-color useRipple(ref)\n * @param ref 需要使用斜八角动画的 DOM\n * @param fixedRippleColor 斜八角的动画颜色\n */\nexport default function useRipple(ref: RefObject<HTMLElement>, fixedRippleColor?: string): void {\n  const { classPrefix } = useConfig();\n\n  // 全局配置\n  const { keepRipple } = useAnimation();\n\n  const rippleContainer = useMemo(() => {\n    if (!canUseDocument) return null;\n    const container = document.createElement('div');\n    container.className = `${classPrefix}-ripple`;\n\n    return container;\n  }, [classPrefix]);\n\n  // 为节点添加斜八角动画 add ripple to the DOM and set up the animation\n  const handleAddRipple = useCallback(\n    (e) => {\n      const el = ref?.current;\n      const rippleColor = getRippleColor(el, fixedRippleColor);\n\n      if (e.button !== 0 || !el || !keepRipple) return;\n\n      if (\n        el.classList.contains(`${classPrefix}-is-active`) ||\n        el.classList.contains(`${classPrefix}-is-disabled`) ||\n        el.classList.contains(`${classPrefix}-is-checked`) ||\n        el.classList.contains(`${classPrefix}-is-loading`)\n      )\n        return;\n\n      const elStyle = getComputedStyle(el);\n\n      const elBorder = parseInt(elStyle.borderWidth, 10);\n      const border = elBorder > 0 ? elBorder : 0;\n      const width = el.offsetWidth;\n      const height = el.offsetHeight;\n\n      if (rippleContainer.parentNode === null) {\n        setStyle(rippleContainer, {\n          position: 'absolute',\n          left: `${0 - border}px`,\n          top: `${0 - border}px`,\n          width: `${width}px`,\n          height: `${height}px`,\n          borderRadius: elStyle.borderRadius,\n          pointerEvents: 'none',\n          overflow: 'hidden',\n        });\n        el.appendChild(rippleContainer);\n      }\n      // 新增一个 ripple\n      const ripple = document.createElement('div');\n\n      ripple.className = `${classPrefix}-ripple__inner`;\n\n      setStyle(ripple, {\n        marginTop: '0',\n        marginLeft: '0',\n        right: `${width}px`,\n        width: `${width + 20}px`,\n        height: '100%',\n        transition: `transform ${period}ms cubic-bezier(.38, 0, .24, 1), background ${period * 2}ms linear`,\n        transform: 'skewX(-8deg)',\n        pointerEvents: 'none',\n        position: 'absolute',\n        zIndex: 0,\n        backgroundColor: rippleColor,\n        opacity: '0.9',\n      });\n\n      // fix zIndex：避免遮盖内部元素\n      const elMap = new WeakMap();\n      for (let n = el.children.length, i = 0; i < n; ++i) {\n        const child = el.children[i];\n        if ((child as HTMLElement).style.zIndex === '' && child !== rippleContainer) {\n          (child as HTMLElement).style.zIndex = '1';\n          elMap.set(child, true);\n        }\n      }\n\n      // fix position\n      const initPosition = el.style.position ? el.style.position : getComputedStyle(el).position;\n      if (initPosition === '' || initPosition === 'static') {\n        // eslint-disable-next-line no-param-reassign\n        el.style.position = 'relative';\n      }\n      rippleContainer.insertBefore(ripple, rippleContainer.firstChild);\n\n      setTimeout(() => {\n        ripple.style.transform = `translateX(${width}px)`;\n      }, 0);\n      // 清除动画节点 clear ripple container\n      const handleClearRipple = () => {\n        const el = ref?.current;\n        ripple.style.backgroundColor = noneRippleBg;\n\n        if (!el) return;\n\n        el.removeEventListener('pointerup', handleClearRipple, false);\n        el.removeEventListener('pointerleave', handleClearRipple, false);\n\n        setTimeout(() => {\n          ripple.remove();\n          if (rippleContainer.children.length === 0) rippleContainer.remove();\n        }, period * 2 + 100);\n      };\n      el.addEventListener('pointerup', handleClearRipple, false);\n      el.addEventListener('pointerleave', handleClearRipple, false);\n    },\n    [classPrefix, ref, fixedRippleColor, rippleContainer, keepRipple],\n  );\n\n  useEffect(() => {\n    const el = ref?.current;\n    if (!el) return;\n\n    el.addEventListener('pointerdown', handleAddRipple, false);\n\n    return () => {\n      el.removeEventListener('pointerdown', handleAddRipple, false);\n    };\n  }, [handleAddRipple, fixedRippleColor, ref]);\n}\n"],"names":["period","noneRippleBg","defaultRippleColor","getRippleColor","el","fixedRippleColor","dataset","ripple","rippleColor","cssVariable","getComputedStyle","getPropertyValue","useRipple","ref","useConfig","classPrefix","useAnimation","keepRipple","rippleContainer","useMemo","canUseDocument","container","document","createElement","className","handleAddRipple","useCallback","e","current","button","classList","contains","elStyle","elBorder","parseInt","borderWidth","border","width","offsetWidth","height","offsetHeight","parentNode","setStyle","position","left","top","borderRadius","pointerEvents","overflow","appendChild","marginTop","marginLeft","right","transition","transform","zIndex","backgroundColor","opacity","elMap","WeakMap","n","children","length","i","child","style","set","initPosition","insertBefore","firstChild","setTimeout","handleClearRipple","removeEventListener","remove","addEventListener","useEffect"],"mappings":"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"}