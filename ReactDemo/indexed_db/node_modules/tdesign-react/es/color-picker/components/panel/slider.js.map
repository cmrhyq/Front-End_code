{"version":3,"file":"slider.js","sources":["../../../../src/color-picker/components/panel/slider.tsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport classnames from 'classnames';\nimport { SLIDER_DEFAULT_WIDTH } from '../../const';\nimport useDrag, { Coordinate } from '../../../_util/useDrag';\nimport { TdColorBaseProps } from '../../interface';\n\nexport interface TdColorSliderProps extends TdColorBaseProps {\n  className?: string;\n  value?: Number;\n  maxValue?: Number;\n  railStyle?: Object;\n  type?: 'hue' | 'alpha';\n}\n\nconst ColorSlider = (props: TdColorSliderProps) => {\n  const {\n    color,\n    className = '',\n    value = 0,\n    railStyle = {},\n    maxValue = 360,\n    baseClassName,\n    disabled,\n    onChange,\n    type,\n  } = props;\n  const panelRef = useRef<HTMLDivElement>(null);\n  const thumbRef = useRef<HTMLElement>(null);\n  const isMovedRef = useRef<boolean>(false);\n  const panelRectRef = useRef({\n    width: SLIDER_DEFAULT_WIDTH,\n  });\n\n  const styles = () => {\n    const { width } = panelRectRef.current;\n    if (!width) {\n      return;\n    }\n    const left = Math.round((Number(value) / Number(maxValue)) * width);\n    return {\n      left: `${left}px`,\n      color: color.rgb,\n    };\n  };\n\n  const handleDrag = (coordinate: Coordinate, isEnded?: boolean) => {\n    if (disabled) {\n      return;\n    }\n    const { width } = panelRectRef.current;\n    const { x } = coordinate;\n    const value = Math.round((x / width) * Number(maxValue) * 100) / 100;\n    isMovedRef.current = true;\n    onChange(value, isEnded);\n  };\n\n  const handleDragEnd = (coordinate: Coordinate) => {\n    if (disabled || !isMovedRef.current) {\n      return;\n    }\n\n    handleDrag(coordinate, true);\n    isMovedRef.current = false;\n  };\n\n  useDrag(panelRef, {\n    start: (coordinate: Coordinate) => {\n      // pop 模式下由于是隐藏显示，这个宽度让其每次点击的时候重新计算\n      panelRectRef.current.width = panelRef.current.offsetWidth;\n      isMovedRef.current = false;\n      handleDrag(coordinate);\n    },\n    end: (coordinate: Coordinate) => {\n      handleDragEnd(coordinate);\n    },\n    drag: (coordinate: Coordinate) => {\n      handleDrag(coordinate);\n    },\n  });\n\n  useEffect(() => {\n    panelRectRef.current.width = panelRef.current.offsetWidth || SLIDER_DEFAULT_WIDTH;\n  }, []);\n\n  const paddingStyle = {\n    background: `linear-gradient(90deg, rgba(0,0,0,.0) 0%, rgba(0,0,0,.0) 93%, ${props.color.rgb} 93%, ${props.color.rgb} 100%)`,\n  };\n\n  return (\n    <div className={classnames(`${baseClassName}__slider-wrapper`, `${baseClassName}__slider-wrapper--${type}-type`)}>\n      {type === 'alpha' && <div className={`${baseClassName}__slider-padding`} style={paddingStyle} />}\n      <div className={classnames(`${baseClassName}__slider`, className)} ref={panelRef}>\n        <div className={`${baseClassName}__rail`} style={railStyle}></div>\n        <span\n          className={`${baseClassName}__thumb`}\n          role=\"slider\"\n          tabIndex={0}\n          ref={thumbRef}\n          style={{ ...styles() }}\n        ></span>\n      </div>\n    </div>\n  );\n};\n\nexport default React.memo(ColorSlider);\n"],"names":["ColorSlider","props","color","className","value","railStyle","maxValue","baseClassName","disabled","onChange","type","panelRef","useRef","thumbRef","isMovedRef","panelRectRef","width","SLIDER_DEFAULT_WIDTH","styles","current","left","Math","round","Number","rgb","handleDrag","coordinate","isEnded","x","handleDragEnd","useDrag","start","offsetWidth","end","drag","useEffect","paddingStyle","background","React","createElement","classnames","style","ref","role","tabIndex","memo"],"mappings":"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"}