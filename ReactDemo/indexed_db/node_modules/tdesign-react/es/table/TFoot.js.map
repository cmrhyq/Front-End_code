{"version":3,"file":"TFoot.js","sources":["../../src/table/TFoot.tsx"],"sourcesContent":["import React, { CSSProperties, useRef } from 'react';\nimport isFunction from 'lodash/isFunction';\nimport classNames from 'classnames';\nimport get from 'lodash/get';\nimport { BaseTableCellParams, RowspanColspan, TableRowData, TdBaseTableProps } from './type';\nimport { formatRowAttributes, formatRowClassNames } from './utils';\nimport { RowAndColFixedPosition } from './interface';\nimport { getColumnFixedStyles } from './hooks/useFixed';\nimport useRowspanAndColspan, { getCellKey } from './hooks/useRowspanAndColspan';\nimport useClassName from './hooks/useClassName';\n\nexport interface TFootProps {\n  rowKey: string;\n  // 是否固定表头\n  isFixedHeader: boolean;\n  // 固定列 left/right 具体值\n  rowAndColFixedPosition: RowAndColFixedPosition;\n  footData: TdBaseTableProps['footData'];\n  columns: TdBaseTableProps['columns'];\n  rowAttributes: TdBaseTableProps['rowAttributes'];\n  rowClassName: TdBaseTableProps['rowClassName'];\n  // 表尾吸底内容宽度\n  thWidthList?: { [colKey: string]: number };\n  footerSummary?: TdBaseTableProps['footerSummary'];\n  rowspanAndColspanInFooter: TdBaseTableProps['rowspanAndColspanInFooter'];\n}\n\nexport default function TFoot(props: TFootProps) {\n  const { footData, columns, rowKey, footerSummary } = props;\n  const tfooterRef = useRef();\n  const classnames = useClassName();\n\n  const { skipSpansMap } = useRowspanAndColspan(footData, columns, rowKey, props.rowspanAndColspanInFooter);\n\n  const renderTFootCell = (p: BaseTableCellParams<TableRowData>) => {\n    const { col, row } = p;\n    if (isFunction(col.foot)) {\n      return col.foot(p);\n    }\n    return col.foot || get(row, col.colKey);\n  };\n\n  const theadClasses = [\n    classnames.tableFooterClasses.footer,\n    { [classnames.tableFooterClasses.fixed]: props.isFixedHeader },\n  ];\n\n  if (!columns) return null;\n\n  const footerDomList = footData?.map((row, rowIndex) => {\n    const trAttributes = formatRowAttributes(props.rowAttributes, { row, rowIndex, type: 'foot' });\n    // 自定义行类名\n    const customClasses = formatRowClassNames(\n      props.rowClassName,\n      { row, rowIndex, type: 'foot' },\n      props.rowKey || 'id',\n    );\n    return (\n      <tr key={rowIndex} {...trAttributes} className={classNames(customClasses)}>\n        {columns.map((col, colIndex) => {\n          // 合并单元格过滤\n          const cellSpans: RowspanColspan = {};\n          let spanState = null;\n          if (skipSpansMap.size) {\n            const cellKey = getCellKey(row, rowKey, col.colKey, colIndex);\n            spanState = skipSpansMap.get(cellKey) || {};\n            spanState?.rowspan > 1 && (cellSpans.rowspan = spanState.rowspan);\n            spanState?.colspan > 1 && (cellSpans.colspan = spanState.colspan);\n            if (spanState.skipped) return null;\n          }\n          const tdStyles = getColumnFixedStyles(\n            col,\n            colIndex,\n            props.rowAndColFixedPosition,\n            classnames.tableColFixedClasses,\n          );\n          const style: CSSProperties = { ...tdStyles.style };\n          if (props.thWidthList?.[col.colKey]) {\n            style.width = `${props.thWidthList[col.colKey] || 0}px`;\n          }\n          return (\n            <td\n              key={col.colKey}\n              rowSpan={cellSpans.rowspan}\n              colSpan={cellSpans.colspan}\n              className={classNames(tdStyles.classes)}\n              style={style}\n            >\n              {renderTFootCell({\n                row,\n                rowIndex,\n                col,\n                colIndex,\n              })}\n            </td>\n          );\n        })}\n      </tr>\n    );\n  });\n\n  // 都不存在，则不需要渲染 footer\n  if (!footerSummary && (!props.footData || !props.footData.length)) return null;\n  return (\n    <tfoot ref={tfooterRef} className={classNames(theadClasses)}>\n      {footerSummary && (\n        <tr className={classnames.tableFullRowClasses.base}>\n          <td colSpan={columns.length}>\n            <div className={classnames.tableFullRowClasses.innerFullElement}>{footerSummary}</div>\n          </td>\n        </tr>\n      )}\n      {footerDomList}\n    </tfoot>\n  );\n}\n"],"names":["TFoot","props","footData","columns","rowKey","footerSummary","tfooterRef","useRef","classnames","useClassName","useRowspanAndColspan","rowspanAndColspanInFooter","skipSpansMap","renderTFootCell","p","col","row","isFunction","foot","get","colKey","theadClasses","tableFooterClasses","footer","fixed","isFixedHeader","footerDomList","map","rowIndex","trAttributes","formatRowAttributes","rowAttributes","type","customClasses","formatRowClassNames","rowClassName","React","createElement","key","className","classNames","colIndex","cellSpans","spanState","size","cellKey","getCellKey","rowspan","colspan","skipped","tdStyles","getColumnFixedStyles","rowAndColFixedPosition","tableColFixedClasses","style","thWidthList","width","rowSpan","colSpan","classes","length","ref","tableFullRowClasses","base","innerFullElement"],"mappings":"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"}