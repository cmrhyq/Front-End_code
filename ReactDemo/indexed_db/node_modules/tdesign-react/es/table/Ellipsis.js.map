{"version":3,"file":"Ellipsis.js","sources":["../../src/table/Ellipsis.tsx"],"sourcesContent":["import React, { useRef, useState, MouseEvent } from 'react';\nimport classNames from 'classnames';\n\nimport { TNode } from '../common';\nimport { isNodeOverflow } from '../_util/dom';\nimport Tooltip, { TooltipProps } from '../tooltip';\nimport useConfig from '../hooks/useConfig';\nimport useDebounce from '../hooks/useDebounce';\n\nexport interface EllipsisProps {\n  content?: string | TNode;\n  children?: string | TNode;\n  popupContent?: string | number | TNode;\n  placement?: TooltipProps['placement'];\n  attach?: () => HTMLElement;\n  tooltipProps?: TooltipProps;\n  zIndex?: number;\n}\n\n/** 超出省略显示 */\nexport default function Ellipsis(props: EllipsisProps) {\n  const { classPrefix } = useConfig();\n  const root = useRef<HTMLDivElement>();\n  const [isOverflow, setIsOverflow] = useState(false);\n\n  const ellipsisClasses = classNames([`${classPrefix}-table__ellipsis`, `${classPrefix}-text-ellipsis`]);\n\n  // 当表格数据量大时，不希望默认渲染全量的 Popup，期望在用户 mouseenter 的时候再显示\n  const onTriggerMouseenter = () => {\n    if (!root.current) return;\n    setIsOverflow(isNodeOverflow(root.current));\n  };\n\n  const onTriggerMouseleave = () => {\n    setIsOverflow(isNodeOverflow(root.current));\n  };\n\n  // 使用 debounce 有两个原因：1. 避免 safari/firefox 等浏览器不显示省略浮层；2. 避免省略列快速滚动时，出现一堆的省略浮层\n  const onMouseAround = useDebounce((e: MouseEvent<HTMLDivElement>) => {\n    e.type === 'mouseleave' ? onTriggerMouseleave() : onTriggerMouseenter();\n  }, 80);\n\n  const cellNode = props.children || props.content;\n  const ellipsisContent = (\n    <div ref={root} className={ellipsisClasses} onMouseEnter={onMouseAround} onMouseLeave={onMouseAround}>\n      {cellNode}\n    </div>\n  );\n  let content = null;\n  if (isOverflow) {\n    const rProps = {\n      content: props.popupContent || cellNode,\n      destroyOnClose: true,\n      zIndex: props.zIndex,\n      attach: props.attach,\n      placement: props.placement,\n      ...(props.tooltipProps || {}),\n    };\n    content = <Tooltip {...rProps}>{ellipsisContent}</Tooltip>;\n  } else {\n    content = ellipsisContent;\n  }\n  return content;\n}\n\nEllipsis.displayName = 'Ellipsis';\n"],"names":["Ellipsis","props","useConfig","classPrefix","root","useRef","useState","isOverflow","setIsOverflow","ellipsisClasses","classNames","onTriggerMouseenter","current","isNodeOverflow","onTriggerMouseleave","onMouseAround","useDebounce","e","type","cellNode","children","content","ellipsisContent","React","createElement","ref","className","onMouseEnter","onMouseLeave","rProps","popupContent","destroyOnClose","zIndex","attach","placement","tooltipProps","Tooltip","displayName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,SAAwBA,QAAxB,CAAiCC,KAAjC,EAAuD;AAC/C,EAAA,IAAA,UAAA,GAAkBC,SAAU,EAA5B;MAAEC,WAAF,cAAEA,WAAF,CAAA;;EACN,IAAMC,OAAOC,MAAuB,EAApC,CAAA;;EACA,IAAoCC,SAAAA,GAAAA,SAAS,MAA7C;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,UAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAmBC,aAAnB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EAEA,IAAMC,kBAAkBC,UAAW,CAAA,WAAIP,WAAJ,EAAA,kBAAA,CAAA,EAAA,EAAA,CAAA,MAAA,CAAsCA,WAAtC,EAAA,gBAAA,CAAA,CAAA,CAAnC,CAAA;;AAGA,EAAA,IAAMQ,sBAAsB,SAAtBA,mBAAsB,GAAM;AAChC,IAAA,IAAI,CAACP,IAAK,CAAAQ,OAAV,EAAmB,OAAA;AACLJ,IAAAA,aAAA,CAAAK,cAAA,CAAeT,IAAK,CAAAQ,OAApB,CAAA,CAAA,CAAA;GAFhB,CAAA;;AAKA,EAAA,IAAME,sBAAsB,SAAtBA,mBAAsB,GAAM;AAClBN,IAAAA,aAAA,CAAAK,cAAA,CAAeT,IAAK,CAAAQ,OAApB,CAAA,CAAA,CAAA;GADhB,CAAA;;AAKM,EAAA,IAAAG,aAAA,GAAgBC,WAAY,CAAA,UAACC,CAAD,EAAmC;IACnEA,CAAA,CAAEC,IAAF,KAAW,YAAX,GAA0BJ,mBAAoB,EAA9C,GAAkDH,mBAAoB,EAAtE,CAAA;GADgC,EAE/B,EAF+B,CAA5B,CAAA;EAIA,IAAAQ,QAAA,GAAWlB,KAAM,CAAAmB,QAAN,IAAkBnB,KAAM,CAAAoB,OAAnC,CAAA;EACN,IAAMC,iCACHC,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIC,IAAAA,GAAK,EAAArB,IAAT;AAAesB,IAAAA,SAAW,EAAAjB,eAA1B;AAA2CkB,IAAAA,YAAc,EAAAZ,aAAzD;AAAwEa,IAAAA,YAAc,EAAAb,aAAAA;GAAtF,EACEI,QADF,CADH,CAAA;EAKA,IAAIE,OAAU,GAAA,IAAd,CAAA;;AACA,EAAA,IAAId,UAAJ,EAAgB;AACd,IAAA,IAAMsB,MAAS,GAAA,aAAA,CAAA;AACbR,MAAAA,OAAA,EAASpB,MAAM6B,YAAN,IAAsBX,QADlB;AAEbY,MAAAA,cAAgB,EAAA,IAFH;MAGbC,QAAQ/B,KAAM,CAAA+B,MAHD;MAIbC,QAAQhC,KAAM,CAAAgC,MAJD;MAKbC,WAAWjC,KAAM,CAAAiC,SAAAA;AALJ,KAAA,EAMTjC,KAAM,CAAAkC,YAAN,IAAsB,EANb,CAAf,CAAA;;IAQAd,OAAA,kBAAWE,KAAA,CAAAC,aAAA,CAAAY,OAAA,EAAYP,aAAAA,CAAAA,EAAAA,EAAAA,MAAZ,CAAqBP,EAAAA,eAArB,CAAX,CAAA;AACK,GAVP,MAUO;AACKD,IAAAA,OAAA,GAAAC,eAAA,CAAA;AACZ,GAAA;;AACO,EAAA,OAAAD,OAAA,CAAA;AACT,CAAA;AAEArB,QAAA,CAASqC,WAAT,GAAuB,UAAvB;;;;"}