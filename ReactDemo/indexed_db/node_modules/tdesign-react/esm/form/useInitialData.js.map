{"version":3,"file":"useInitialData.js","sources":["../../src/form/useInitialData.ts"],"sourcesContent":["import React from 'react';\n\n// 兼容特殊数据结构和受控 key\nimport Tree from '../tree/Tree';\nimport Cascader from '../cascader/Cascader';\nimport Upload from '../upload/upload';\nimport CheckTag from '../tag/CheckTag';\nimport Checkbox from '../checkbox/Checkbox';\nimport TagInput from '../tag-input/TagInput';\nimport RangeInput from '../range-input/RangeInput';\nimport Transfer from '../transfer/Transfer';\nimport CheckboxGroup from '../checkbox/CheckboxGroup';\nimport DateRangePicker from '../date-picker/DateRangePicker';\nimport TimeRangePicker from '../time-picker/TimeRangePicker';\n\n// FormItem 子组件受控 key\nexport const ctrlKeyMap = new Map();\nctrlKeyMap.set(Checkbox, 'checked');\nctrlKeyMap.set(CheckTag, 'checked');\nctrlKeyMap.set(Upload, 'files');\n\n// FormItem 默认数据类型\nexport const initialDataMap = new Map();\n[Tree, Upload, Transfer, Cascader, TagInput, RangeInput, CheckboxGroup, DateRangePicker, TimeRangePicker].forEach(\n  (component) => {\n    initialDataMap.set(component, []);\n  },\n);\n\n// 整理初始值 优先级：Form.initialData < FormItem.initialData\nexport function getDefaultInitialData({ name, formListName, children, initialData, initialDataFromContext }) {\n  let defaultInitialData;\n  if (initialDataFromContext) {\n    if (typeof name === 'string') defaultInitialData = initialDataFromContext[name];\n    if (Array.isArray(name)) {\n      const nameList = formListName ? [formListName, ...name] : name;\n\n      // 创建唯一临时变量 symbol\n      const symbol = Symbol('initialData');\n      let fieldValue = null;\n\n      for (let i = 0; i < nameList.length; i++) {\n        const item = nameList[i];\n        if (Reflect.has(fieldValue || initialDataFromContext, item)) {\n          fieldValue = Reflect.get(fieldValue || initialDataFromContext, item);\n        } else {\n          // 当反射无法获取到值则重置为 symbol\n          fieldValue = symbol;\n          break;\n        }\n      }\n\n      // 说明设置了值\n      if (fieldValue !== symbol) {\n        defaultInitialData = fieldValue;\n      }\n    }\n  }\n  if (typeof initialData !== 'undefined') defaultInitialData = initialData;\n  React.Children.forEach(children, (child) => {\n    if (child && React.isValidElement(child) && typeof defaultInitialData === 'undefined') {\n      defaultInitialData = initialDataMap.get(child.type);\n    }\n  });\n  return defaultInitialData;\n}\n"],"names":["ctrlKeyMap","Map","set","Checkbox","CheckTag","Upload","initialDataMap","Tree","Transfer","Cascader","TagInput","RangeInput","CheckboxGroup","DateRangePicker","TimeRangePicker","forEach","component","getDefaultInitialData","name","formListName","children","initialData","initialDataFromContext","defaultInitialData","Array","isArray","nameList","symbol","Symbol","fieldValue","i","length","item","Reflect","has","get","React","Children","child","isValidElement","type"],"mappings":"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"}