{"version":3,"file":"useTagScroll.js","sources":["../../src/tag-input/useTagScroll.ts"],"sourcesContent":["/**\n * 当标签数量过多时，输入框显示不下，则需要滚动查看，以下为滚动逻辑\n * 如果标签过多时的处理方式，是标签省略，则不需要此功能\n */\n\nimport { useRef, useEffect, RefObject, useState, WheelEvent } from 'react';\nimport { TdTagInputProps } from './type';\n\nlet mouseEnterTimer = null;\n\nexport default function useTagScroll(props: TdTagInputProps) {\n  const tagInputRef: RefObject<{ currentElement: HTMLDivElement }> = useRef();\n  const { excessTagsDisplayType = 'scroll', readonly, disabled } = props;\n  // 允许向右滚动的最大距离\n  const [scrollDistance, setScrollDistance] = useState(0);\n  const [scrollElement, setScrollElement] = useState<HTMLDivElement>();\n\n  const updateScrollElement = (element: HTMLDivElement) => {\n    const scrollElement = element.children[0] as HTMLDivElement;\n    setScrollElement(scrollElement);\n  };\n\n  const updateScrollDistance = () => {\n    setScrollDistance(scrollElement.scrollWidth - scrollElement.clientWidth);\n  };\n\n  const scrollTo = (distance: number) => {\n    scrollElement?.scroll({ left: distance, behavior: 'smooth' });\n  };\n\n  const scrollToRight = () => {\n    updateScrollDistance();\n    scrollTo(scrollDistance);\n  };\n\n  const scrollToLeft = () => {\n    scrollTo(0);\n  };\n\n  // TODO：MAC 电脑横向滚动，Windows 纵向滚动。当前只处理了横向滚动\n  const onWheel = ({ e }: { e: WheelEvent<HTMLDivElement> }) => {\n    if (readonly || disabled) return;\n    if (!scrollElement) return;\n    if (e.deltaX > 0) {\n      const distance = Math.min(scrollElement.scrollLeft + 120, scrollDistance);\n      scrollTo(distance);\n    } else {\n      const distance = Math.max(scrollElement.scrollLeft - 120, 0);\n      scrollTo(distance);\n    }\n  };\n\n  // 鼠标 hover，自动滑动到最右侧，以便输入新标签\n  const scrollToRightOnEnter = () => {\n    if (excessTagsDisplayType !== 'scroll') return;\n    // 一闪而过的 mousenter 不需要执行\n    mouseEnterTimer = setTimeout(() => {\n      scrollToRight();\n      clearTimeout(mouseEnterTimer);\n    }, 100);\n  };\n\n  const scrollToLeftOnLeave = () => {\n    if (excessTagsDisplayType !== 'scroll') return;\n    scrollTo(0);\n    clearTimeout(mouseEnterTimer);\n  };\n\n  const clearScroll = () => {\n    clearTimeout(mouseEnterTimer);\n  };\n\n  const initScroll = (element: HTMLDivElement) => {\n    if (!element) return;\n    updateScrollElement(element);\n  };\n\n  useEffect(() => {\n    initScroll(tagInputRef?.current.currentElement);\n    return clearScroll;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return {\n    initScroll,\n    clearScroll,\n    tagInputRef,\n    scrollElement,\n    scrollDistance,\n    scrollTo,\n    scrollToRight,\n    scrollToLeft,\n    updateScrollElement,\n    updateScrollDistance,\n    onWheel,\n    scrollToRightOnEnter,\n    scrollToLeftOnLeave,\n  };\n}\n"],"names":["mouseEnterTimer","useTagScroll","props","tagInputRef","useRef","excessTagsDisplayType","readonly","disabled","useState","scrollDistance","setScrollDistance","scrollElement","setScrollElement","updateScrollElement","element","children","updateScrollDistance","scrollWidth","clientWidth","scrollTo","distance","scroll","left","behavior","scrollToRight","scrollToLeft","onWheel","e","deltaX","Math","min","scrollLeft","max","scrollToRightOnEnter","setTimeout","clearTimeout","scrollToLeftOnLeave","clearScroll","initScroll","useEffect","current","currentElement"],"mappings":";;;;;;;;;;AAQA,IAAIA,eAAkB,GAAA,IAAtB,CAAA;AAEA,SAAwBC,YAAxB,CAAqCC,KAArC,EAA6D;EAC3D,IAAMC,cAA6DC,MAAO,EAA1E,CAAA;EACA,IAAiEF,qBAAAA,GAAAA,KAAjE,CAAQG,qBAAR;MAAQA,qBAAR,sCAAgC,QAAhC,GAAA,qBAAA;AAAA,MAA0CC,QAA1C,GAAiEJ,KAAjE,CAA0CI,QAA1C;AAAA,MAAoDC,QAApD,GAAiEL,KAAjE,CAAoDK,QAApD,CAAA;;EAEA,IAA4CC,SAAAA,GAAAA,SAAS,EAArD;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,cAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAuBC,iBAAvB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;AACA,EAAA,IAAA,UAAA,GAA0CF,QAAyB,EAAnE;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAA,MAAOG,aAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAsBC,gBAAtB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;AAEM,EAAA,IAAAC,mBAAA,GAAsB,SAAtBA,mBAAsB,CAACC,OAAD,EAA6B;AACjDH,IAAAA,IAAAA,cAAAA,GAAgBG,QAAQC,QAAR,CAAiB,CAAjB,CAAhBJ,CAAAA;IACNC,gBAAA,CAAiBD,cAAjB,CAAA,CAAA;GAFI,CAAA;;AAKN,EAAA,IAAMK,uBAAuB,SAAvBA,oBAAuB,GAAM;IACfN,iBAAA,CAAAC,aAAA,CAAcM,WAAd,GAA4BN,aAAA,CAAcO,WAA1C,CAAA,CAAA;GADpB,CAAA;;AAIM,EAAA,IAAAC,QAAA,GAAW,SAAXA,QAAW,CAACC,QAAD,EAAsB;IACrCT,aAAA,KAAA,IAAA,IAAAA,aAAA,KAAA,KAAA,CAAA,YAAAA,aAAA,CAAeU,MAAf,CAAsB;AAAEC,MAAAA,IAAA,EAAMF,QAAR;AAAkBG,MAAAA,QAAA,EAAU,QAAA;KAAlD,CAAA,CAAA;GADI,CAAA;;AAIN,EAAA,IAAMC,gBAAgB,SAAhBA,aAAgB,GAAM;IACLR,oBAAA,EAAA,CAAA;IACrBG,QAAA,CAASV,cAAT,CAAA,CAAA;GAFF,CAAA;;AAKA,EAAA,IAAMgB,eAAe,SAAfA,YAAe,GAAM;IACzBN,QAAA,CAAS,CAAT,CAAA,CAAA;GADF,CAAA;;AAKA,EAAA,IAAMO,OAAU,GAAA,SAAVA,OAAU,CAA8C,IAAA,EAAA;IAAA,IAA3CC,CAA2C,QAA3CA,CAA2C,CAAA;IAC5D,IAAIrB,QAAY,IAAAC,QAAhB,EAA0B,OAAA;IAC1B,IAAI,CAACI,aAAL,EAAoB,OAAA;;AAChB,IAAA,IAAAgB,CAAA,CAAEC,MAAF,GAAW,CAAX,EAAc;AAChB,MAAA,IAAMR,WAAWS,IAAK,CAAAC,GAAL,CAASnB,aAAc,CAAAoB,UAAd,GAA2B,GAApC,EAAyCtB,cAAzC,CAAjB,CAAA;MACAU,QAAA,CAASC,QAAT,CAAA,CAAA;AACK,KAHH,MAGG;AACL,MAAA,IAAMA,YAAWS,IAAK,CAAAG,GAAL,CAASrB,aAAc,CAAAoB,UAAd,GAA2B,GAApC,EAAyC,CAAzC,CAAjB,CAAA;;MACAZ,QAAA,CAASC,SAAT,CAAA,CAAA;AACF,KAAA;GATF,CAAA;;AAaA,EAAA,IAAMa,uBAAuB,SAAvBA,oBAAuB,GAAM;IACjC,IAAI5B,qBAA0B,KAAA,QAA9B,EAAwC,OAAA;IAExCL,eAAA,GAAkBkC,WAAW,YAAM;MACnBV,aAAA,EAAA,CAAA;MACdW,YAAA,CAAanC,eAAb,CAAA,CAAA;OACC,IAHH,CAAA;GAHF,CAAA;;AASA,EAAA,IAAMoC,sBAAsB,SAAtBA,mBAAsB,GAAM;IAChC,IAAI/B,qBAA0B,KAAA,QAA9B,EAAwC,OAAA;IACxCc,QAAA,CAAS,CAAT,CAAA,CAAA;IACAgB,YAAA,CAAanC,eAAb,CAAA,CAAA;GAHF,CAAA;;AAMA,EAAA,IAAMqC,cAAc,SAAdA,WAAc,GAAM;IACxBF,YAAA,CAAanC,eAAb,CAAA,CAAA;GADF,CAAA;;AAIM,EAAA,IAAAsC,UAAA,GAAa,SAAbA,UAAa,CAACxB,OAAD,EAA6B;IAC9C,IAAI,CAACA,OAAL,EAAc,OAAA;IACdD,mBAAA,CAAoBC,OAApB,CAAA,CAAA;GAFI,CAAA;;AAKNyB,EAAAA,SAAA,CAAU,YAAM;IACHD,UAAA,CAAAnC,WAAA,KAAA,IAAA,IAAAA,WAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,WAAA,CAAaqC,OAAb,CAAqBC,cAArB,CAAA,CAAA;AACJ,IAAA,OAAAJ,WAAA,CAAA;GAFT,EAIG,EAJH,CAAA,CAAA;EAMO,OAAA;AACLC,IAAAA,UAAA,EAAAA,UADK;AAELD,IAAAA,WAAA,EAAAA,WAFK;AAGLlC,IAAAA,WAAA,EAAAA,WAHK;AAILQ,IAAAA,aAAA,EAAAA,aAJK;AAKLF,IAAAA,cAAA,EAAAA,cALK;AAMLU,IAAAA,QAAA,EAAAA,QANK;AAOLK,IAAAA,aAAA,EAAAA,aAPK;AAQLC,IAAAA,YAAA,EAAAA,YARK;AASLZ,IAAAA,mBAAA,EAAAA,mBATK;AAULG,IAAAA,oBAAA,EAAAA,oBAVK;AAWLU,IAAAA,OAAA,EAAAA,OAXK;AAYLO,IAAAA,oBAAA,EAAAA,oBAZK;AAaLG,IAAAA,mBAAA,EAAAA,mBAAAA;GAbK,CAAA;AAeT;;;;"}