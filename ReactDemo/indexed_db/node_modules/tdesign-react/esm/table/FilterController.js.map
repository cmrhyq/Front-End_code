{"version":3,"file":"FilterController.js","sources":["../../src/table/FilterController.tsx"],"sourcesContent":["import React, { useState, useRef, ReactNode } from 'react';\nimport { FilterIcon as TdFilterIcon } from 'tdesign-icons-react';\n\nimport isEmpty from 'lodash/isEmpty';\nimport classNames from 'classnames';\n\nimport Popup from '../popup';\nimport Checkbox from '../checkbox';\nimport Radio from '../radio';\nimport Input from '../input';\nimport TButton from '../button';\nimport { PrimaryTableCol, FilterValue, TableRowData } from './type';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport log from '../_common/js/log';\n\nconst CheckboxGroup = Checkbox.Group;\nconst RadioGroup = Radio.Group;\nexport interface TableFilterControllerProps {\n  filterIcon: ReactNode;\n  tFilterValue: FilterValue;\n  innerFilterValue: FilterValue;\n  tableFilterClasses: {\n    filterable: string;\n    popup: string;\n    icon: string;\n    popupContent: string;\n    result: string;\n    inner: string;\n    bottomButtons: string;\n    contentInner: string;\n    iconWrap: string;\n  };\n  isFocusClass: string;\n  column: PrimaryTableCol;\n  primaryTableElement: HTMLElement;\n  onVisibleChange: (val: boolean) => void;\n  onReset: (column: PrimaryTableCol<TableRowData>) => void;\n  onConfirm: (column: PrimaryTableCol<TableRowData>) => void;\n  onInnerFilterChange: (val: any, column: PrimaryTableCol<TableRowData>) => void;\n}\n\nexport default function TableFilterController(props: TableFilterControllerProps) {\n  const { tFilterValue, innerFilterValue, tableFilterClasses, isFocusClass, column } = props;\n\n  const { FilterIcon } = useGlobalIcon({\n    FilterIcon: TdFilterIcon,\n  });\n  const triggerElementRef = useRef<HTMLDivElement>(null);\n  const [locale, t] = useLocaleReceiver('table');\n  const [filterPopupVisible, setFilterPopupVisible] = useState(false);\n\n  const onFilterPopupVisibleChange = (visible: boolean) => {\n    setFilterPopupVisible(visible);\n    props.onVisibleChange?.(visible);\n  };\n\n  const getFilterContent = (column: PrimaryTableCol) => {\n    const types = ['single', 'multiple', 'input'];\n    if (column.type && !types.includes(column.filter.type)) {\n      log.error('Table', `TDesign Table Error: column.filter.type must be the following: ${JSON.stringify(types)}`);\n      return;\n    }\n    const Component = {\n      single: RadioGroup,\n      multiple: CheckboxGroup,\n      input: Input,\n    }[column.filter.type];\n    if (!Component && !column?.filter?.component) return;\n    const filterComponentProps: { [key: string]: any } = {\n      options: ['single', 'multiple'].includes(column.filter.type) ? column.filter?.list : undefined,\n      ...(column.filter?.props || {}),\n      value: innerFilterValue?.[column.colKey],\n      onChange: (val: any) => {\n        props.onInnerFilterChange?.(val, column);\n      },\n    };\n    // 允许自定义触发确认搜索的事件\n    if (column.filter?.confirmEvents) {\n      column.filter.confirmEvents.forEach((event) => {\n        filterComponentProps[event] = () => {\n          setFilterPopupVisible(false);\n          props.onConfirm?.(column);\n        };\n      });\n    }\n    const FilterComponent = column?.filter?.component || Component;\n    return (\n      <div className={tableFilterClasses.contentInner}>\n        <FilterComponent value={innerFilterValue?.[column.colKey]} {...filterComponentProps} />\n      </div>\n    );\n  };\n\n  const getBottomButtons = (column: PrimaryTableCol) => {\n    if (!column.filter.showConfirmAndReset) return;\n    return (\n      <div className={tableFilterClasses.bottomButtons}>\n        <TButton\n          theme=\"default\"\n          size=\"small\"\n          onClick={() => {\n            setFilterPopupVisible(false);\n            props.onReset?.(column);\n          }}\n        >\n          {locale.resetText}\n        </TButton>\n        <TButton\n          theme=\"primary\"\n          size=\"small\"\n          onClick={() => {\n            setFilterPopupVisible(false);\n            props.onConfirm?.(column);\n          }}\n        >\n          {locale.confirmText}\n        </TButton>\n      </div>\n    );\n  };\n\n  if (!column.filter || (column.filter && !Object.keys(column.filter).length)) return null;\n  const defaultFilterIcon = t(locale.filterIcon) || <FilterIcon />;\n  return (\n    <div className={classNames([tableFilterClasses.icon, { [isFocusClass]: !isEmpty(tFilterValue?.[column.colKey]) }])}>\n      <Popup\n        // attach={primaryTableElement ? () => primaryTableElement : undefined}\n        visible={filterPopupVisible}\n        destroyOnClose\n        trigger=\"click\"\n        placement=\"bottom-right\"\n        showArrow\n        overlayClassName={tableFilterClasses.popup}\n        onVisibleChange={(val: boolean) => onFilterPopupVisibleChange(val)}\n        content={\n          <div className={tableFilterClasses.popupContent}>\n            {getFilterContent(column)}\n            {getBottomButtons(column)}\n          </div>\n        }\n      >\n        <div ref={triggerElementRef}>{props.filterIcon || defaultFilterIcon}</div>\n      </Popup>\n    </div>\n  );\n}\n"],"names":["CheckboxGroup","Checkbox","Group","RadioGroup","Radio","TableFilterController","props","tFilterValue","innerFilterValue","tableFilterClasses","isFocusClass","column","useGlobalIcon","FilterIcon","TdFilterIcon","triggerElementRef","useRef","useLocaleReceiver","locale","t","useState","filterPopupVisible","setFilterPopupVisible","onFilterPopupVisibleChange","visible","onVisibleChange","getFilterContent","types","type","includes","filter","log","error","JSON","stringify","Component","single","multiple","input","Input","component","filterComponentProps","options","list","value","colKey","onChange","val","onInnerFilterChange","confirmEvents","forEach","event","onConfirm","FilterComponent","React","createElement","className","contentInner","getBottomButtons","showConfirmAndReset","bottomButtons","TButton","theme","size","onClick","onReset","resetText","confirmText","Object","keys","length","defaultFilterIcon","filterIcon","classNames","icon","isEmpty","Popup","destroyOnClose","trigger","placement","showArrow","overlayClassName","popup","content","popupContent","ref"],"mappings":"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"}