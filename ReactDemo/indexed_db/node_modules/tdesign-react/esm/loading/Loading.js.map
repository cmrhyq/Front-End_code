{"version":3,"file":"Loading.js","sources":["../../src/loading/Loading.tsx"],"sourcesContent":["import React, { useState, useEffect, FC, useMemo, CSSProperties } from 'react';\nimport classnames from 'classnames';\n\nimport { addClass, canUseDocument, removeClass } from '../_util/dom';\nimport useConfig from '../hooks/useConfig';\nimport { StyledProps } from '../common';\nimport { TdLoadingProps } from './type';\nimport Portal from '../common/Portal';\nimport Gradient from './gradient';\nimport { loadingDefaultProps } from './defaultProps';\n\nexport interface LoadingProps extends TdLoadingProps, StyledProps {}\n\nconst Loading: FC<LoadingProps> = (props) => {\n  const {\n    attach,\n    indicator,\n    text,\n    loading,\n    size,\n    delay,\n    fullscreen,\n    preventScrollThrough,\n    showOverlay,\n    content,\n    children,\n    inheritColor,\n    zIndex,\n    className,\n    style,\n  } = props;\n\n  const [showLoading, setShowLoading] = useState(delay ? false : loading);\n\n  const { classPrefix } = useConfig();\n\n  const name = `${classPrefix}-loading`;\n  const centerClass = `${classPrefix}-loading--center`;\n  const inheritColorClass = `${classPrefix}-loading--inherit-color`;\n  const fullClass = `${classPrefix}-loading--full`;\n  const fullscreenClass = `${classPrefix}-loading__fullscreen`;\n  const lockClass = `${classPrefix}-loading--lock`;\n  const overlayClass = `${classPrefix}-loading__overlay`;\n  const relativeClass = `${classPrefix}-loading__parent`;\n  const textClass = `${classPrefix}-loading__text`;\n\n  useEffect(() => {\n    let timer: NodeJS.Timeout;\n\n    if (delay && loading) {\n      timer = setTimeout(() => {\n        setShowLoading(loading);\n      }, delay);\n    } else {\n      setShowLoading(loading);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [delay, loading]);\n\n  const calcStyles = useMemo(() => {\n    const styles: CSSProperties = {};\n\n    if (zIndex !== undefined) {\n      styles.zIndex = zIndex;\n    }\n\n    if (!['small', 'medium', 'large'].includes(size)) {\n      styles.fontSize = size;\n    }\n\n    return style ? { ...styles, ...style } : styles;\n  }, [size, zIndex, style]);\n\n  const sizeMap = {\n    large: `${classPrefix}-size-l`,\n    small: `${classPrefix}-size-s`,\n    medium: `${classPrefix}-size-m`,\n  };\n\n  const baseClasses = classnames(\n    centerClass,\n    sizeMap[size],\n    {\n      [inheritColorClass]: inheritColor,\n    },\n    className,\n  );\n\n  useEffect(() => {\n    if (preventScrollThrough && fullscreen && canUseDocument && loading) {\n      addClass(document.body, lockClass);\n    }\n    return () => {\n      removeClass(document.body, lockClass);\n    };\n  }, [loading, preventScrollThrough, fullscreen, lockClass]);\n\n  const commonContent = () => {\n    let renderIndicator = <Gradient />;\n\n    if (indicator && typeof indicator !== 'boolean') {\n      renderIndicator = indicator as JSX.Element;\n    }\n    return (\n      <>\n        {indicator ? renderIndicator : null}\n        {text ? <div className={textClass}>{text}</div> : null}\n      </>\n    );\n  };\n\n  if (fullscreen) {\n    return loading ? (\n      <div className={classnames(name, fullscreenClass, centerClass, overlayClass)} style={calcStyles}>\n        <div className={baseClasses}>{commonContent()}</div>\n      </div>\n    ) : null;\n  }\n\n  if (content || children) {\n    return (\n      <div className={relativeClass}>\n        {content || children}\n        {showLoading ? (\n          <div\n            className={classnames(name, baseClasses, fullClass, {\n              [overlayClass]: showOverlay,\n            })}\n            style={calcStyles}\n          >\n            {commonContent()}\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n  if (attach) {\n    return (\n      <Portal attach={attach}>\n        {loading ? (\n          <div className={classnames(name, baseClasses, fullClass, { [overlayClass]: showOverlay })} style={calcStyles}>\n            {commonContent()}\n          </div>\n        ) : null}\n      </Portal>\n    );\n  }\n\n  return loading ? (\n    <div className={classnames(name, baseClasses)} style={calcStyles}>\n      {commonContent()}\n    </div>\n  ) : null;\n};\n\nLoading.displayName = 'Loading';\nLoading.defaultProps = loadingDefaultProps;\n\nexport default Loading;\n"],"names":["Loading","props","attach","indicator","text","loading","size","delay","fullscreen","preventScrollThrough","showOverlay","content","children","inheritColor","zIndex","className","style","useState","showLoading","setShowLoading","useConfig","classPrefix","name","centerClass","inheritColorClass","fullClass","fullscreenClass","lockClass","overlayClass","relativeClass","textClass","useEffect","timer","setTimeout","clearTimeout","calcStyles","useMemo","styles","includes","fontSize","sizeMap","large","small","medium","baseClasses","classnames","canUseDocument","addClass","document","body","removeClass","commonContent","renderIndicator","Gradient","React","createElement","Fragment","Portal","displayName","defaultProps","loadingDefaultProps"],"mappings":"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"}