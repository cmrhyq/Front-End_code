{"version":3,"file":"useRangeValue.js","sources":["../../../src/date-picker/hooks/useRangeValue.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport dayjs from 'dayjs';\nimport useControlled from '../../hooks/useControlled';\nimport { TdDateRangePickerProps, DateRangeValue } from '../type';\nimport {\n  isValidDate,\n  formatDate,\n  formatTime,\n  getDefaultFormat,\n  parseToDayjs,\n} from '../../_common/js/date-picker/format';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\nimport log from '../../_common/js/log';\n\nexport const PARTIAL_MAP = { first: 'start', second: 'end' };\n\n// 初始化面板年份月份\nexport function initYearMonthTime({\n  value,\n  mode = 'date',\n  format,\n  timeFormat = 'HH:mm:ss',\n  enableTimePicker,\n}: {\n  value: DateRangeValue;\n  mode: string;\n  format: string;\n  timeFormat?: string;\n  enableTimePicker?: boolean;\n}) {\n  const defaultYearMonthTime = {\n    year: [dayjs().year(), dayjs().year()],\n    month: [dayjs().month(), dayjs().month()],\n    time: [dayjs().format(timeFormat), dayjs().format(timeFormat)],\n  };\n  if (mode === 'year') {\n    defaultYearMonthTime.year[1] += 10;\n  } else if (mode === 'month' || mode === 'quarter') {\n    defaultYearMonthTime.year[1] += 1;\n  } else if ((mode === 'date' || mode === 'week') && !enableTimePicker) {\n    defaultYearMonthTime.month[1] += 1;\n  }\n\n  if (!value || !Array.isArray(value) || !value.length) {\n    return defaultYearMonthTime;\n  }\n\n  return {\n    year: value.map((v) => parseToDayjs(v, format).year()),\n    month: value.map((v) => parseToDayjs(v, format).month()),\n    time: value.map((v) => parseToDayjs(v, format).format(timeFormat)),\n  };\n}\n\nexport default function useRange(props: TdDateRangePickerProps) {\n  const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n  const { format, valueType, timeFormat } = getDefaultFormat({\n    mode: props.mode,\n    format: props.format,\n    valueType: props.valueType,\n    enableTimePicker: props.enableTimePicker,\n  });\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(format))\n      log.error('DatePicker', `format: ${format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n    if (!extractTimeFormat(valueType) && valueType !== 'time-stamp')\n      log.error('DatePicker', `valueType: ${valueType} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  // warning invalid value\n  if (!Array.isArray(value)) {\n    log.error('DatePicker', `typeof value: ${value} must be Array!`);\n  } else if (!isValidDate(value, valueType)) {\n    log.error(\n      'DatePicker',\n      `value: ${value} is invalid dateTime! Check whether the value is consistent with format: ${format}`,\n    );\n  }\n\n  const [isFirstValueSelected, setIsFirstValueSelected] = useState(false); // 记录面板点击次数，两次后才自动关闭\n  const [time, setTime] = useState(initYearMonthTime({ value, mode: props.mode, format, timeFormat }).time);\n  const [month, setMonth] = useState<Array<number>>(\n    initYearMonthTime({ value, mode: props.mode, format, enableTimePicker: props.enableTimePicker }).month,\n  );\n  const [year, setYear] = useState<Array<number>>(initYearMonthTime({ value, mode: props.mode, format }).year);\n  const [cacheValue, setCacheValue] = useState(formatDate(value, { format, targetFormat: format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  useEffect(() => {\n    if (!value) {\n      setCacheValue([]);\n      return;\n    }\n    if (!isValidDate(value, valueType)) return;\n\n    setCacheValue(formatDate(value, { format, targetFormat: format }));\n    setTime(formatTime(value, timeFormat));\n    // eslint-disable-next-line\n  }, [value]);\n\n  return {\n    value,\n    onChange,\n    year,\n    setYear,\n    month,\n    setMonth,\n    time,\n    setTime,\n    isFirstValueSelected,\n    setIsFirstValueSelected,\n    cacheValue,\n    setCacheValue,\n  };\n}\n"],"names":["PARTIAL_MAP","first","second","initYearMonthTime","value","mode","format","timeFormat","enableTimePicker","defaultYearMonthTime","year","dayjs","month","time","Array","isArray","length","map","v","parseToDayjs","useRange","props","useControlled","onChange","getDefaultFormat","valueType","extractTimeFormat","log","error","isValidDate","useState","isFirstValueSelected","setIsFirstValueSelected","setTime","setMonth","setYear","formatDate","targetFormat","cacheValue","setCacheValue","useEffect","formatTime"],"mappings":"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"}