/**
 * tdesign v0.41.1
 * (c) 2022 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var defineProperty = require('../_chunks/dep-4eb93341.js');
var slicedToArray = require('../_chunks/dep-9c5d4f93.js');
var objectWithoutProperties = require('../_chunks/dep-1a0462cc.js');
var React = require('react');
var classNames = require('classnames');
var tdesignIconsReact = require('tdesign-icons-react');
var _common_js_utils_observe = require('../_common/js/utils/observe.js');
var hooks_useConfig = require('../hooks/useConfig.js');
var image_defaultProps = require('./defaultProps.js');
var space_index = require('../space/index.js');
var hooks_useGlobalIcon = require('../hooks/useGlobalIcon.js');
require('../_chunks/dep-2205decf.js');
require('../_chunks/dep-4344eec8.js');
require('../_chunks/dep-fe984d70.js');
require('../_chunks/dep-46cf36fd.js');
require('../_chunks/dep-f5e18a2f.js');
require('../_chunks/dep-53ba6729.js');
require('../_chunks/dep-61a8a7b0.js');
require('../_chunks/dep-2a90f794.js');
require('../_chunks/dep-aab723b3.js');
require('../_chunks/dep-384b291c.js');
require('../_chunks/dep-a0b5d8f6.js');
require('../_chunks/dep-12656997.js');
require('../_chunks/dep-1fff9729.js');
require('../_chunks/dep-bb60493d.js');
require('../_chunks/dep-72020528.js');
require('../_chunks/dep-ad854ba5.js');
require('../_chunks/dep-eebdbd74.js');
require('../_chunks/dep-8f18a7c4.js');
require('../_chunks/dep-9cd0fde8.js');
require('../_chunks/dep-d3ad6e52.js');
require('../_chunks/dep-aafeb50a.js');
require('../_chunks/dep-6fa7a9e9.js');
require('../_chunks/dep-994ec160.js');
require('../_chunks/dep-9429a38a.js');
require('../_common/js/global-config/locale/zh_CN.js');
require('../_common/js/global-config/default-config.js');
require('../space/Space.js');
require('react-is');
require('../space/defaultProps.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefaultLegacy(React);
var classNames__default = /*#__PURE__*/_interopDefaultLegacy(classNames);

var _excluded = ["className", "src", "style", "alt", "fit", "position", "shape", "placeholder", "loading", "error", "overlayTrigger", "overlayContent", "lazy", "gallery", "onLoad", "onError"];

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { defineProperty._defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

var Image = function Image(props) {
  var className = props.className,
      src = props.src,
      style = props.style,
      alt = props.alt,
      fit = props.fit,
      position = props.position,
      shape = props.shape,
      placeholder = props.placeholder,
      loading = props.loading,
      error = props.error,
      overlayTrigger = props.overlayTrigger,
      overlayContent = props.overlayContent,
      lazy = props.lazy,
      gallery = props.gallery,
      onLoad = props.onLoad,
      onError = props.onError,
      rest = objectWithoutProperties._objectWithoutProperties(props, _excluded);

  var _useConfig = hooks_useConfig["default"](),
      classPrefix = _useConfig.classPrefix;

  var imageRef = React.useRef(null);

  var _useGlobalIcon = hooks_useGlobalIcon["default"]({
    ImageErrorIcon: tdesignIconsReact.ImageErrorIcon,
    ImageIcon: tdesignIconsReact.ImageIcon
  }),
      ImageErrorIcon = _useGlobalIcon.ImageErrorIcon,
      ImageIcon = _useGlobalIcon.ImageIcon;

  var _useState = React.useState(!lazy),
      _useState2 = slicedToArray._slicedToArray(_useState, 2),
      shouldLoad = _useState2[0],
      setShouldLoad = _useState2[1];

  var handleLoadImage = function handleLoadImage() {
    setShouldLoad(true);
  };

  var _useState3 = React.useState(false),
      _useState4 = slicedToArray._slicedToArray(_useState3, 2),
      isLoaded = _useState4[0],
      setIsLoaded = _useState4[1];

  var handleLoad = function handleLoad() {
    setIsLoaded(true);
    onLoad === null || onLoad === void 0 ? void 0 : onLoad();
  };

  React.useEffect(function () {
    if (!lazy || !(imageRef !== null && imageRef !== void 0 && imageRef.current)) return;
    var observerRefValue = null;
    var io = _common_js_utils_observe["default"](imageRef.current, null, handleLoadImage, 0);
    observerRefValue = imageRef.current;
    return function () {
      observerRefValue && io && io.unobserve(observerRefValue);
    };
  }, [lazy, imageRef]);

  var _useState5 = React.useState(false),
      _useState6 = slicedToArray._slicedToArray(_useState5, 2),
      hasError = _useState6[0],
      setHasError = _useState6[1];

  var handleError = function handleError() {
    setHasError(true);
    onError === null || onError === void 0 ? void 0 : onError();
  };

  var hasMouseEvent = overlayTrigger === "hover";

  var _useState7 = React.useState(!hasMouseEvent),
      _useState8 = slicedToArray._slicedToArray(_useState7, 2),
      shouldShowOverlay = _useState8[0],
      setShouldShowOverlay = _useState8[1];

  var handleToggleOverlay = function handleToggleOverlay(overlay) {
    setShouldShowOverlay(overlay);
  };

  var renderOverlay = function renderOverlay() {
    if (!overlayContent) return null;
    return /* @__PURE__ */React__default["default"].createElement("div", {
      className: classNames__default["default"]("".concat(classPrefix, "-image__overlay-content"), !shouldShowOverlay && "".concat(classPrefix, "-image__overlay-content--hidden"))
    }, overlayContent);
  };

  var renderPlaceholder = function renderPlaceholder() {
    if (!placeholder) {
      return null;
    }

    return /* @__PURE__ */React__default["default"].createElement("div", {
      className: "".concat(classPrefix, "-image__placeholder")
    }, placeholder);
  };

  var renderGalleryShadow = function renderGalleryShadow() {
    if (!gallery) return null;
    return /* @__PURE__ */React__default["default"].createElement("div", {
      className: "".concat(classPrefix, "-image__gallery-shadow")
    });
  };

  return /* @__PURE__ */React__default["default"].createElement("div", _objectSpread(_objectSpread({
    ref: imageRef,
    className: classNames__default["default"]("".concat(classPrefix, "-image__wrapper"), "".concat(classPrefix, "-image__wrapper--shape-").concat(shape), gallery && "".concat(classPrefix, "-image__wrapper--gallery"), hasMouseEvent && "".concat(classPrefix, "-image__wrapper--need-hover"), className),
    style: style
  }, hasMouseEvent ? {
    onMouseEnter: function onMouseEnter() {
      return handleToggleOverlay(true);
    },
    onMouseLeave: function onMouseLeave() {
      return handleToggleOverlay(false);
    }
  } : null), rest), renderPlaceholder(), renderGalleryShadow(), hasError || !shouldLoad ? /* @__PURE__ */React__default["default"].createElement("div", {
    className: "".concat(classPrefix, "-image")
  }) : /* @__PURE__ */React__default["default"].createElement(React.Fragment, null, /* @__PURE__ */React__default["default"].createElement("img", {
    src: src,
    onError: handleError,
    onLoad: handleLoad,
    className: classNames__default["default"]("".concat(classPrefix, "-image"), "".concat(classPrefix, "-image--fit-").concat(fit), "".concat(classPrefix, "-image--position-").concat(position)),
    alt: alt
  }), !isLoaded && /* @__PURE__ */React__default["default"].createElement("div", {
    className: "".concat(classPrefix, "-image__loading")
  }, loading || /* @__PURE__ */React__default["default"].createElement(space_index.Space, {
    direction: "vertical",
    size: 8,
    align: "center"
  }, /* @__PURE__ */React__default["default"].createElement(ImageIcon, {
    size: 24
  }), "\u56FE\u7247\u52A0\u8F7D\u4E2D"))), hasError && /* @__PURE__ */React__default["default"].createElement("div", {
    className: "".concat(classPrefix, "-image__error")
  }, error || /* @__PURE__ */React__default["default"].createElement(space_index.Space, {
    direction: "vertical",
    size: 8,
    align: "center"
  }, /* @__PURE__ */React__default["default"].createElement(ImageErrorIcon, {
    size: 24
  }), "\u56FE\u7247\u65E0\u6CD5\u663E\u793A")), renderOverlay());
};

Image.displayName = "Image";
Image.defaultProps = image_defaultProps.imageDefaultProps;

exports["default"] = Image;
//# sourceMappingURL=Image.js.map
