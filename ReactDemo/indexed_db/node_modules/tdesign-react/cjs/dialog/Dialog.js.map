{"version":3,"file":"Dialog.js","sources":["../../src/dialog/Dialog.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useMemo, useRef, isValidElement } from 'react';\nimport isString from 'lodash/isString';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport {\n  CloseIcon as TdCloseIcon,\n  InfoCircleFilledIcon as TdInfoCircleFilledIcon,\n  CheckCircleFilledIcon as TdCheckCircleFilledIcon,\n} from 'tdesign-icons-react';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport Button, { ButtonProps } from '../button';\nimport { TdDialogProps, DialogInstance } from './type';\nimport { StyledProps } from '../common';\nimport noop from '../_util/noop';\nimport RenderDialog from './RenderDialog';\nimport useSetState from '../_util/useSetState';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport { dialogDefaultProps } from './defaultProps';\n\nexport interface DialogProps extends TdDialogProps, StyledProps {\n  /**\n   * 是否以插件形式调用\n   */\n  isPlugin?: boolean;\n}\n\nconst renderDialogButton = (btn: TdDialogProps['cancelBtn'], defaultProps: ButtonProps) => {\n  let result = null;\n\n  if (isString(btn)) {\n    result = <Button {...defaultProps}>{btn}</Button>;\n  } else if (isValidElement(btn)) {\n    result = btn;\n  } else if (isObject(btn)) {\n    result = <Button {...defaultProps} {...(btn as {})} />;\n  } else if (isFunction(btn)) {\n    result = btn();\n  }\n\n  return result;\n};\n\nconst Dialog = forwardRef((props: DialogProps, ref: React.Ref<DialogInstance>) => {\n  const { classPrefix } = useConfig();\n  const { CloseIcon, InfoCircleFilledIcon, CheckCircleFilledIcon } = useGlobalIcon({\n    CloseIcon: TdCloseIcon,\n    InfoCircleFilledIcon: TdInfoCircleFilledIcon,\n    CheckCircleFilledIcon: TdCheckCircleFilledIcon,\n  });\n  const dialogDom = useRef<HTMLDivElement>();\n  const [state, setState] = useSetState<DialogProps>({\n    width: 520,\n    visible: false,\n    zIndex: 2500,\n    placement: 'center',\n    mode: 'modal',\n    showOverlay: true,\n    destroyOnClose: false,\n    draggable: false,\n    preventScrollThrough: true,\n    isPlugin: false,\n    ...props,\n  });\n\n  const [local, t] = useLocaleReceiver('dialog');\n  const confirmText = t(local.confirm);\n  const cancelText = t(local.cancel);\n\n  const {\n    visible,\n    attach,\n    closeBtn,\n    footer = true,\n    onCancel = noop,\n    onConfirm = noop,\n    cancelBtn = cancelText,\n    confirmBtn = confirmText,\n    onClose = noop,\n    isPlugin = false,\n    ...restState\n  } = state;\n\n  useEffect(() => {\n    // 插件式调用不会更新props, 只有组件式调用才会更新props\n    if (!isPlugin) {\n      setState((prevState) => ({\n        ...prevState,\n        ...props,\n      }));\n    }\n  }, [props, setState, isPlugin]);\n\n  const prefixCls = `${classPrefix}-dialog`;\n  const renderCloseIcon = () => {\n    if (closeBtn === false) return null;\n    if (closeBtn === true) return <CloseIcon style={{ verticalAlign: 'unset' }} />;\n    return closeBtn || <CloseIcon style={{ verticalAlign: 'unset' }} />;\n  };\n\n  React.useImperativeHandle(ref, () => ({\n    show() {\n      setState({ visible: true });\n    },\n    hide() {\n      setState({ visible: false });\n    },\n    destroy() {\n      setState({ visible: false, destroyOnClose: true });\n    },\n    update(newOptions) {\n      setState((prevState) => ({\n        ...prevState,\n        ...(newOptions as DialogProps),\n      }));\n    },\n  }));\n\n  const renderHeader = useMemo(() => {\n    if (!state.header) return null;\n\n    const iconMap = {\n      info: <InfoCircleFilledIcon className={`${classPrefix}-is-info`} />,\n      warning: <InfoCircleFilledIcon className={`${classPrefix}-is-warning`} />,\n      error: <InfoCircleFilledIcon className={`${classPrefix}-is-error`} />,\n      success: <CheckCircleFilledIcon className={`${classPrefix}-is-success`} />,\n    };\n    return (\n      <div className={`${prefixCls}__header`}>\n        {iconMap[state.theme]}\n        {state.header}\n      </div>\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.header, state.theme, prefixCls, classPrefix]);\n\n  const handleCancel = (e: React.MouseEvent<HTMLButtonElement>) => {\n    onCancel({ e });\n    onClose({ e, trigger: 'cancel' });\n  };\n\n  const handleConfirm = (e: React.MouseEvent<HTMLButtonElement>) => {\n    onConfirm({ e });\n  };\n\n  const defaultFooter = () => {\n    const renderCancelBtn = renderDialogButton(cancelBtn, { variant: 'outline' });\n    const renderConfirmBtn = renderDialogButton(confirmBtn, { theme: 'primary' });\n\n    return (\n      <>\n        {renderCancelBtn &&\n          React.cloneElement(renderCancelBtn, {\n            onClick: handleCancel,\n            ...renderCancelBtn.props,\n          })}\n        {renderConfirmBtn &&\n          React.cloneElement(renderConfirmBtn, {\n            onClick: handleConfirm,\n            ...renderConfirmBtn.props,\n          })}\n      </>\n    );\n  };\n\n  return (\n    <RenderDialog\n      {...restState}\n      visible={visible}\n      prefixCls={prefixCls}\n      header={renderHeader}\n      attach={attach}\n      closeBtn={renderCloseIcon()}\n      classPrefix={classPrefix}\n      onClose={onClose}\n      onConfirm={onConfirm}\n      footer={footer === true ? defaultFooter() : footer}\n      ref={dialogDom}\n    />\n  );\n});\n\nDialog.displayName = 'Dialog';\nDialog.defaultProps = dialogDefaultProps;\n\nexport default Dialog;\n"],"names":["renderDialogButton","btn","defaultProps","result","isString","React","createElement","Button","isValidElement","isObject","isFunction","Dialog","forwardRef","props","ref","useConfig","classPrefix","useGlobalIcon","CloseIcon","TdCloseIcon","InfoCircleFilledIcon","TdInfoCircleFilledIcon","CheckCircleFilledIcon","TdCheckCircleFilledIcon","dialogDom","useRef","useSetState","width","visible","zIndex","placement","mode","showOverlay","destroyOnClose","draggable","preventScrollThrough","isPlugin","_slicedToArray","state","setState","useLocaleReceiver","local","t","confirmText","confirm","cancelText","cancel","attach","closeBtn","footer","onCancel","noop","onConfirm","cancelBtn","confirmBtn","onClose","restState","useEffect","prevState","prefixCls","renderCloseIcon","style","verticalAlign","useImperativeHandle","show","hide","destroy","update","newOptions","renderHeader","useMemo","header","iconMap","info","className","warning","error","success","theme","handleCancel","e","trigger","handleConfirm","defaultFooter","renderCancelBtn","variant","renderConfirmBtn","Fragment","cloneElement","onClick","RenderDialog","displayName","dialogDefaultProps"],"mappings":"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"}