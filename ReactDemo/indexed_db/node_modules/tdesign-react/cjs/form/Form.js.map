{"version":3,"file":"Form.js","sources":["../../src/form/Form.tsx"],"sourcesContent":["import React, { useRef, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../hooks/useConfig';\nimport noop from '../_util/noop';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport type { TdFormProps } from './type';\nimport useInstance from './hooks/useInstance';\nimport useForm from './hooks/useForm';\nimport { StyledProps } from '../common';\nimport FormContext from './FormContext';\nimport FormItem from './FormItem';\nimport FormList from './FormList';\nimport { formDefaultProps } from './defaultProps';\n\nexport interface FormProps extends TdFormProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nconst Form = forwardRefWithStatics(\n  (props: FormProps, ref) => {\n    const { classPrefix, form: globalFormConfig } = useConfig();\n\n    const {\n      style,\n      className,\n      form,\n      labelWidth,\n      statusIcon,\n      labelAlign,\n      layout,\n      colon,\n      initialData,\n      requiredMark = globalFormConfig.requiredMark,\n      scrollToFirstError,\n      showErrorMessage,\n      resetType,\n      rules,\n      errorMessage = globalFormConfig.errorMessage,\n      preventSubmitDefault,\n      disabled,\n      children,\n      onReset,\n      onValuesChange = noop,\n    } = props;\n\n    const formClass = classNames(`${classPrefix}-form`, className, {\n      [`${classPrefix}-form-inline`]: layout === 'inline',\n    });\n\n    const formRef: React.RefObject<HTMLFormElement> = useRef();\n    const formMapRef = useRef(new Map()); // 收集所有 formItem 实例\n    const formInstance = useInstance(props, formRef, formMapRef);\n\n    useImperativeHandle(ref, () => formInstance);\n    form && Object.assign(form, { ...formInstance });\n\n    function onResetHandler(e: React.FormEvent<HTMLFormElement>) {\n      [...formMapRef.current.values()].forEach((formItemRef) => {\n        formItemRef?.current.resetField();\n      });\n      onReset?.({ e });\n    }\n\n    function onFormItemValueChange(changedValue: Record<string, unknown>) {\n      const allFields = formInstance.getFieldsValue(true);\n      onValuesChange(changedValue, allFields);\n    }\n\n    function onKeyDownHandler(e: React.KeyboardEvent<HTMLFormElement>) {\n      // 禁用 input 输入框回车自动提交 form\n      if ((e.target as Element).tagName.toLowerCase() !== 'input') return;\n      if (preventSubmitDefault && e.key === 'Enter') {\n        e.preventDefault?.();\n        e.stopPropagation?.();\n      }\n    }\n\n    return (\n      <FormContext.Provider\n        value={{\n          labelWidth,\n          statusIcon,\n          labelAlign,\n          layout,\n          colon,\n          initialData,\n          requiredMark,\n          errorMessage,\n          showErrorMessage,\n          scrollToFirstError,\n          resetType,\n          rules,\n          disabled,\n          formMapRef,\n          onFormItemValueChange,\n        }}\n      >\n        <form\n          ref={formRef}\n          style={style}\n          className={formClass}\n          onSubmit={formInstance.submit}\n          onReset={onResetHandler}\n          onKeyDown={onKeyDownHandler}\n        >\n          {children}\n        </form>\n      </FormContext.Provider>\n    );\n  },\n  { useForm, FormItem, FormList },\n);\n\nForm.displayName = 'Form';\nForm.defaultProps = formDefaultProps;\n\nexport default Form;\n"],"names":["Form","forwardRefWithStatics","props","ref","useConfig","classPrefix","globalFormConfig","form","style","className","labelWidth","statusIcon","labelAlign","layout","colon","initialData","requiredMark","scrollToFirstError","showErrorMessage","resetType","rules","errorMessage","preventSubmitDefault","disabled","children","onReset","onValuesChange","noop","formClass","classNames","_defineProperty","formRef","useRef","formMapRef","Map","formInstance","useInstance","useImperativeHandle","Object","assign","onResetHandler","e","_toConsumableArray","current","values","forEach","formItemRef","resetField","onFormItemValueChange","changedValue","allFields","getFieldsValue","onKeyDownHandler","target","tagName","toLowerCase","key","preventDefault","stopPropagation","React","createElement","FormContext","Provider","value","onSubmit","submit","onKeyDown","useForm","FormItem","FormList","displayName","defaultProps","formDefaultProps"],"mappings":"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"}