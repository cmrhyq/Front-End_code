{"version":3,"file":"FormList.js","sources":["../../src/form/FormList.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useImperativeHandle } from 'react';\nimport { FormListContext, useFormContext } from './FormContext';\nimport { FormItemInstance } from './FormItem';\nimport { TdFormListProps, FormListFieldOperation, FormListField } from './type';\nimport log from '../_common/js/log';\n\nlet key = 0;\n\nconst FormList = (props: TdFormListProps) => {\n  const { formMapRef } = useFormContext();\n  const { name, initialData = [], rules, children } = props;\n\n  const [initialValue, setInitialValue] = useState(initialData);\n  const [fields, setFields] = useState<Array<FormListField>>(\n    initialData.map((data, index) => ({\n      key: (key += 1),\n      name: index,\n      isListField: true,\n      ...data,\n    })),\n  );\n  const formListMapRef = useRef(new Map()); // 收集 formItem 实例\n  const formListRef = useRef<FormItemInstance>(); // 当前 formList 实例\n\n  const operation: FormListFieldOperation = {\n    add(defaultValue?: any, insertIndex?: number) {\n      const cloneFields = [...fields];\n      const index = insertIndex ?? cloneFields.length;\n      cloneFields.splice(index, 0, {\n        key: (key += 1),\n        name: index,\n        isListField: true,\n      });\n      cloneFields.forEach((field, index) => Object.assign(field, { name: index }));\n      setFields(cloneFields);\n\n      if (typeof defaultValue !== 'undefined') {\n        const nextInitialValue = [...initialValue];\n        nextInitialValue[index] = defaultValue;\n        setInitialValue(nextInitialValue);\n      }\n    },\n    remove(index: number | number[]) {\n      const nextFields = fields\n        .filter((_, i) => {\n          if (Array.isArray(index)) return !index.includes(i);\n          return i !== index;\n        })\n        .map((field, index) => Object.assign(field, { name: index }));\n\n      setInitialValue(initialValue.filter((_, idx) => idx !== index));\n      setFields(nextFields);\n    },\n    move(from: number, to: number) {\n      const cloneFields = [...fields];\n      const fromItem = { ...cloneFields[from] };\n      const toItem = { ...cloneFields[to] };\n      cloneFields[to] = fromItem;\n      cloneFields[from] = toItem;\n      setFields(cloneFields);\n    },\n  };\n\n  // 外部设置 fields 优先级最高，可以更改渲染的节点\n  function setListFields(fieldData: any[], callback: Function) {\n    setFields(\n      fieldData.map((_, index) => ({\n        key: (key += 1),\n        name: index,\n        isListField: true,\n      })),\n    );\n    // 延迟至 microtask 队列末尾再赋值\n    Promise.resolve().then(() => {\n      [...formListMapRef.current.values()].forEach((formItemRef) => {\n        const { name } = formItemRef.current;\n        let data;\n        if (Array.isArray(name)) {\n          const [index, itemKey] = name;\n          data = fieldData?.[index]?.[itemKey];\n        } else {\n          data = fieldData?.[name];\n        }\n        callback(formItemRef, data);\n      });\n    });\n  }\n\n  useEffect(() => {\n    [...formListMapRef.current.values()].forEach((formItemRef) => {\n      const { name, value } = formItemRef.current;\n      if (value) return;\n\n      let data;\n      if (Array.isArray(name)) {\n        const [index, itemKey] = name;\n        data = initialValue?.[index]?.[itemKey];\n      } else {\n        data = initialValue?.[name];\n      }\n      formItemRef.current.setField({ value: data, status: 'not' });\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fields, initialValue]);\n\n  useEffect(() => {\n    if (!name || !formMapRef) return;\n    formMapRef.current.set(name, formListRef);\n\n    return () => {\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      formMapRef.current.delete(name);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [name]);\n\n  useImperativeHandle(\n    formListRef,\n    (): FormItemInstance => ({\n      name,\n      getValue() {\n        const formListValue = [];\n        [...formListMapRef.current.values()].forEach((formItemRef) => {\n          const { name, getValue } = formItemRef.current;\n          if (Array.isArray(name)) {\n            const [index, itemKey] = name;\n            if (!formListValue[index]) {\n              formListValue[index] = { [itemKey]: getValue() };\n            } else {\n              formListValue[index][itemKey] = getValue();\n            }\n          } else {\n            formListValue[name] = getValue();\n          }\n        });\n        return formListValue;\n      },\n      validate: (trigger = 'all') => {\n        const resultList = [];\n        const validates = [...formListMapRef.current.values()].map((formItemRef) =>\n          formItemRef.current.validate(trigger),\n        );\n        return new Promise((resolve) => {\n          Promise.all(validates).then((validateResult) => {\n            validateResult.forEach((result) => {\n              const errorKey = Object.keys(result)[0];\n              const errorValue = Object.values(result)[0];\n              const [index, itemKey] = errorKey.split(',');\n              if (itemKey) {\n                resultList[index] = { [itemKey]: errorValue };\n              } else {\n                resultList[index] = errorValue;\n              }\n            });\n            const errorItems = validateResult.filter((item) => Object.values(item)[0] !== true);\n            if (errorItems.length) {\n              resolve({ [name]: resultList });\n            } else {\n              resolve({ [name]: true });\n            }\n          });\n        });\n      },\n      setValue: (fieldData: any[]) => {\n        setListFields(fieldData, (formItemRef, data) => {\n          formItemRef?.current?.setValue(data);\n        });\n      },\n      setField: (fieldData: { value?: any[]; status?: string }) => {\n        const { value, status } = fieldData;\n        setListFields(value, (formItemRef, data) => {\n          formItemRef?.current?.setField({ value: data, status });\n        });\n      },\n      resetField: () => {\n        [...formListMapRef.current.values()].forEach((formItemRef) => {\n          formItemRef.current.resetField();\n        });\n        setInitialValue([]);\n      },\n      setValidateMessage: (fieldData) => {\n        [...formListMapRef.current.values()].forEach((formItemRef) => {\n          const { name } = formItemRef.current;\n          let data;\n          if (Array.isArray(name)) {\n            const [index, itemKey] = name;\n            data = fieldData?.[index]?.[itemKey];\n          } else {\n            data = fieldData?.[name];\n          }\n\n          formItemRef.current.setValidateMessage(data);\n        });\n      },\n      resetValidate: () => {\n        [...formListMapRef.current.values()].forEach((formItemRef) => {\n          formItemRef.current.resetValidate();\n        });\n      },\n    }),\n  );\n\n  if (typeof children !== 'function') {\n    log.error('Form', `FormList's children must be a function!`);\n    return null;\n  }\n\n  return (\n    <FormListContext.Provider value={{ name, rules, formListMapRef }}>\n      {children(fields, operation)}\n    </FormListContext.Provider>\n  );\n};\n\nFormList.displayName = 'FormList';\n\nexport default FormList;\n"],"names":["key","FormList","props","useFormContext","formMapRef","name","initialData","rules","children","useState","_slicedToArray","initialValue","setInitialValue","map","data","index","isListField","fields","setFields","formListMapRef","useRef","Map","formListRef","operation","add","defaultValue","insertIndex","cloneFields","length","splice","forEach","field","Object","assign","nextInitialValue","remove","nextFields","filter","_","i","Array","isArray","includes","idx","move","from","to","fromItem","toItem","setListFields","fieldData","callback","Promise","resolve","then","_toConsumableArray","current","values","formItemRef","itemKey","useEffect","value","setField","status","set","useImperativeHandle","getValue","formListValue","validate","trigger","resultList","validates","all","validateResult","result","errorKey","keys","errorValue","split","errorItems","item","setValue","resetField","setValidateMessage","resetValidate","log","error","React","createElement","FormListContext","Provider","displayName"],"mappings":"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"}