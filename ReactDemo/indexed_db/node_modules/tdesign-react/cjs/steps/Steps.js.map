{"version":3,"file":"Steps.js","sources":["../../src/steps/Steps.tsx"],"sourcesContent":["import React, { useCallback, useMemo } from 'react';\nimport classnames from 'classnames';\nimport useConfig from '../hooks/useConfig';\nimport useControlled from '../hooks/useControlled';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport { TdStepsProps, TdStepItemProps } from './type';\nimport { StyledProps } from '../common';\nimport StepItem from './StepItem';\nimport StepsContext from './StepsContext';\nimport { stepsDefaultProps } from './defaultProps';\n\nexport interface StepsProps extends TdStepsProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nconst Steps = forwardRefWithStatics(\n  (props: StepsProps, ref) => {\n    const { style, readonly, layout, theme, sequence, separator, children, options } = props;\n    const { classPrefix } = useConfig();\n\n    const [current, onChange] = useControlled(props, 'current', props.onChange);\n\n    // 整理 StepItem value 映射\n    const indexMap = useMemo(() => {\n      const map = {};\n\n      if (options) {\n        options.forEach((item, index) => {\n          if (item.value !== undefined) map[item.value] = index;\n        });\n      } else {\n        React.Children.forEach(children, (child, index) => {\n          if (!React.isValidElement(child)) return;\n          if (child.props.value !== undefined) map[child.props.value] = index;\n        });\n      }\n      return map;\n    }, [options, children]);\n\n    const handleStatus = useCallback(\n      (item: TdStepItemProps, index: number) => {\n        if (current === 'FINISH') return 'finish';\n        if (item.status && item.status !== 'default') return item.status;\n\n        // value 不存在时，使用 index 进行区分每一个步骤\n        if (item.value === undefined) {\n          if (sequence === 'positive' && index < current) return 'finish';\n          if (sequence === 'reverse' && index > current) return 'finish';\n        }\n\n        // value 存在，找匹配位置\n        if (item.value !== undefined) {\n          const matchIndex = indexMap[current];\n          if (matchIndex === undefined) {\n            console.warn('TDesign Steps Warn: The current `value` is not exist.');\n            return 'default';\n          }\n          if (sequence === 'positive' && index < matchIndex) return 'finish';\n          if (sequence === 'reverse' && index > matchIndex) return 'finish';\n        }\n        const key = item.value ?? index;\n        if (key === current) return 'process';\n        return 'default';\n      },\n      [current, sequence, indexMap],\n    );\n\n    const stepItemList = useMemo(() => {\n      if (options) {\n        const optionsDisplayList = sequence === 'reverse' ? options.reverse() : options;\n\n        return options.map((item, index: number) => {\n          const stepIndex = sequence === 'reverse' ? optionsDisplayList.length - index - 1 : index;\n          return <StepItem key={index} {...item} index={stepIndex} status={handleStatus(item, index)} />;\n        });\n      }\n\n      const childrenList = React.Children.toArray(children);\n      const childrenDisplayList = sequence === 'reverse' ? childrenList.reverse() : childrenList;\n\n      return childrenList.map((child: JSX.Element, index: number) => {\n        const stepIndex = sequence === 'reverse' ? childrenDisplayList.length - index - 1 : index;\n        return React.cloneElement(child, {\n          ...child.props,\n          index: stepIndex,\n          status: handleStatus(child.props, index),\n        });\n      });\n    }, [options, children, sequence, handleStatus]);\n\n    return (\n      <StepsContext.Provider value={{ current, theme, readonly, onChange }}>\n        <div\n          ref={ref}\n          style={style}\n          className={classnames({\n            [`${classPrefix}-steps`]: true,\n            [`${classPrefix}-steps--${theme}-anchor`]: theme,\n            [`${classPrefix}-steps--${layout}`]: layout,\n            [`${classPrefix}-steps--${sequence}`]: sequence,\n            [`${classPrefix}-steps--${separator}-separator`]: separator,\n            [props.className]: !!props.className,\n          })}\n        >\n          {stepItemList}\n        </div>\n      </StepsContext.Provider>\n    );\n  },\n  { StepItem },\n);\n\nSteps.displayName = 'Steps';\nSteps.defaultProps = stepsDefaultProps;\n\nexport default Steps;\n"],"names":["Steps","forwardRefWithStatics","props","ref","style","readonly","layout","theme","sequence","separator","children","options","useConfig","classPrefix","useControlled","onChange","_slicedToArray","current","indexMap","useMemo","map","forEach","item","index","value","React","Children","child","isValidElement","handleStatus","useCallback","status","matchIndex","console","warn","key","stepItemList","optionsDisplayList","reverse","stepIndex","length","createElement","StepItem","childrenList","toArray","childrenDisplayList","cloneElement","StepsContext","Provider","className","classnames","_defineProperty","displayName","defaultProps","stepsDefaultProps"],"mappings":"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"}