{"version":3,"file":"useSingleValue.js","sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport dayjs from 'dayjs';\nimport { formatDate, formatTime, isValidDate, getDefaultFormat } from '../../_common/js/date-picker/format';\nimport useControlled from '../../hooks/useControlled';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\nimport log from '../../_common/js/log';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n  const { format, valueType, timeFormat } = getDefaultFormat({\n    mode: props.mode,\n    format: props.format,\n    valueType: props.valueType,\n    enableTimePicker: props.enableTimePicker,\n  });\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(format))\n      log.error('DatePicker', `format: ${format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n    if (!extractTimeFormat(valueType) && valueType !== 'time-stamp')\n      log.error('DatePicker', `valueType: ${valueType} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  const [time, setTime] = useState(formatTime(value, timeFormat));\n  const [month, setMonth] = useState<number>(dayjs(value).month() || new Date().getMonth());\n  const [year, setYear] = useState<number>(dayjs(value).year() || new Date().getFullYear());\n  const [cacheValue, setCacheValue] = useState(formatDate(value, { format, targetFormat: format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  useEffect(() => {\n    if (!value) {\n      setCacheValue('');\n      return;\n    }\n    if (!isValidDate(value, valueType)) return;\n\n    setCacheValue(formatDate(value, { format, targetFormat: format }));\n    setTime(formatTime(value, timeFormat));\n    // eslint-disable-next-line\n  }, [value]);\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n    setYear,\n    setMonth,\n    setTime,\n    setCacheValue,\n  };\n}\n"],"names":["useSingleValue","props","useControlled","onChange","_slicedToArray","value","getDefaultFormat","mode","format","valueType","enableTimePicker","timeFormat","extractTimeFormat","log","error","useState","formatTime","time","setTime","dayjs","month","Date","getMonth","setMonth","year","getFullYear","setYear","formatDate","targetFormat","cacheValue","setCacheValue","useEffect","isValidDate"],"mappings":"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"}