{"version":3,"file":"CollapsePanel.js","sources":["../../src/collapse/CollapsePanel.tsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport classnames from 'classnames';\nimport { CSSTransition } from 'react-transition-group';\nimport { useCollapseContext } from './CollapseContext';\nimport FakeArrow from '../common/FakeArrow';\nimport useConfig from '../hooks/useConfig';\nimport { TdCollapsePanelProps } from './type';\nimport { StyledProps } from '../common';\nimport { collapsePanelDefaultProps } from './defaultProps';\n\nexport interface CollapsePanelProps extends TdCollapsePanelProps, StyledProps {\n  children?: React.ReactNode;\n  index?: number;\n}\n\nconst CollapsePanel = (props: CollapsePanelProps) => {\n  const {\n    value,\n    disabled,\n    destroyOnCollapse,\n    expandIcon,\n    className,\n    style,\n    header,\n    headerRightContent,\n    children,\n    index,\n  } = props;\n  const {\n    disabled: disableAll,\n    defaultExpandAll,\n    expandIconPlacement,\n    expandOnRowClick,\n    expandIcon: expandIconAll,\n    updateCollapseValue,\n    collapseValue,\n  } = useCollapseContext();\n\n  const { classPrefix } = useConfig();\n  const componentName = `${classPrefix}-collapse-panel`;\n  const innerValue = value || index;\n  const showExpandIcon = expandIcon === undefined ? expandIconAll : expandIcon;\n  const headRef = useRef();\n  const contentRef = useRef<HTMLDivElement>();\n  const bodyRef = useRef<HTMLDivElement>();\n  const isDisabled = disabled || disableAll;\n\n  useEffect(() => {\n    if (defaultExpandAll) {\n      updateCollapseValue(innerValue);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const isActive = Array.isArray(collapseValue) ? collapseValue.includes(innerValue) : collapseValue === innerValue;\n\n  const classes = classnames(\n    componentName,\n    {\n      [`${classPrefix}-is-disabled`]: isDisabled,\n    },\n    className,\n  );\n\n  const handleClick = (e) => {\n    const canExpand =\n      (expandOnRowClick && e.target === headRef.current) || ['svg', 'path'].includes((e.target as Element).tagName);\n\n    if (canExpand && !isDisabled) {\n      updateCollapseValue(innerValue);\n    }\n  };\n\n  const renderIcon = (direction: string) => (\n    <FakeArrow\n      style={{\n        transform: isActive ? 'rotate(180deg)' : 'rotate(-90deg)',\n      }}\n      isActive={isActive}\n      overlayClassName={classnames(`${componentName}__icon`, `${componentName}__icon--${direction}`)}\n    />\n  );\n\n  const renderHeader = () => {\n    const cls = [\n      `${componentName}__header`,\n      {\n        [`${classPrefix}-is-clickable`]: expandOnRowClick && !isDisabled,\n      },\n    ];\n    return (\n      <div ref={headRef} className={classnames(cls)} onClick={handleClick}>\n        {showExpandIcon && expandIconPlacement === 'left' ? renderIcon(expandIconPlacement) : null}\n        {header && header}\n        <div className={`${componentName}__header--blank`}></div>\n        {headerRightContent && headerRightContent}\n        {showExpandIcon && expandIconPlacement === 'right' ? renderIcon(expandIconPlacement) : null}\n      </div>\n    );\n  };\n\n  const renderBody = () => {\n    const transitionCallbacks = {\n      onEnter: () => {\n        bodyRef.current.style.height = `${contentRef?.current.clientHeight}px`;\n      },\n      onEntered: () => {\n        bodyRef.current.style.height = 'auto';\n      },\n      onExit: () => {\n        bodyRef.current.style.height = `${contentRef?.current.clientHeight}px`;\n      },\n      onExiting: () => {\n        bodyRef.current.style.height = '0px';\n      },\n    };\n    return (\n      <CSSTransition\n        in={isActive}\n        appear\n        timeout={300}\n        nodeRef={bodyRef}\n        unmountOnExit={destroyOnCollapse}\n        {...transitionCallbacks}\n      >\n        <div\n          style={{ height: 0 }}\n          className={classnames(`${componentName}__body`, `${classPrefix}-slide-down-enter-active`, {\n            [`${componentName}__body--collapsed`]: !isActive,\n          })}\n          ref={bodyRef}\n        >\n          <div className={`${componentName}__content`} ref={contentRef}>\n            {children}\n          </div>\n        </div>\n      </CSSTransition>\n    );\n  };\n\n  return (\n    <div className={classes} style={{ ...style }}>\n      <div className={`${componentName}__wrapper`}>\n        {renderHeader()}\n        {renderBody()}\n      </div>\n    </div>\n  );\n};\n\nCollapsePanel.displayName = 'CollapsePanel';\nCollapsePanel.defaultProps = collapsePanelDefaultProps;\n\nexport default CollapsePanel;\n"],"names":["CollapsePanel","props","value","disabled","destroyOnCollapse","expandIcon","className","style","header","headerRightContent","children","index","useCollapseContext","disableAll","defaultExpandAll","expandIconPlacement","expandOnRowClick","expandIconAll","updateCollapseValue","collapseValue","useConfig","classPrefix","componentName","innerValue","showExpandIcon","headRef","useRef","contentRef","bodyRef","isDisabled","useEffect","isActive","Array","isArray","includes","classes","classnames","handleClick","e","canExpand","target","current","tagName","renderIcon","direction","React","createElement","FakeArrow","transform","overlayClassName","renderHeader","cls","_defineProperty","ref","onClick","renderBody","transitionCallbacks","onEnter","height","clientHeight","onEntered","onExit","onExiting","CSSTransition","appear","timeout","nodeRef","unmountOnExit","displayName","defaultProps","collapsePanelDefaultProps"],"mappings":"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"}