{"version":3,"file":"useControlled.js","sources":["../../src/hooks/useControlled.ts"],"sourcesContent":["import { useState } from 'react';\nimport upperFirst from 'lodash/upperFirst';\nimport noop from '../_util/noop';\n\nexport interface ChangeHandler<T, P extends any[]> {\n  (value: T, ...args: P);\n}\n\ntype Defaultoptions<T extends string> = `default${Capitalize<T>}`;\n\ntype ToString<T extends string | number | symbol> = T extends string ? T : `${Extract<T, number>}`;\n\nconst useControlled: <P extends any[], R extends object, K extends keyof R>(\n  props: R,\n  valueKey: K,\n  onChange: ChangeHandler<R[K], P>,\n  defaultOptions?:\n    | {\n        [key in Defaultoptions<ToString<K>>]: R[K];\n      }\n    | object,\n) => [R[K], ChangeHandler<R[K], P>] = (props = {} as any, valueKey, onChange, defaultOptions = {}) => {\n  // 外部设置 props，说明希望受控\n  const controlled = Reflect.has(props, valueKey);\n  // 受控属性\n  const value = props[valueKey];\n  // 约定受控属性的非受控 key 为 defaultXxx，某些条件下要在运行时确定 defaultXxx 则通过 defaultOptions 来覆盖\n  const defaultValue =\n    defaultOptions[`default${upperFirst(valueKey as string)}`] || props[`default${upperFirst(valueKey as string)}`];\n\n  // 无论是否受控，都要维护一个内部变量，默认值由 defaultValue 控制\n  const [internalValue, setInternalValue] = useState(defaultValue);\n\n  // 受控模式\n  if (controlled) return [value, onChange || noop];\n\n  // 非受控模式\n  return [\n    internalValue,\n    (newValue, ...args) => {\n      setInternalValue(newValue);\n      onChange?.(newValue, ...args);\n    },\n  ];\n};\n\nexport default useControlled;\n"],"names":["useControlled","props","valueKey","onChange","defaultOptions","controlled","Reflect","has","value","defaultValue","upperFirst","useState","_slicedToArray","internalValue","setInternalValue","noop","newValue","args"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAYA,IAAMA,aAAA,GASgC,SAThCA,aASgC,GAAgE;EAAA,IAA/DC,KAA+D,uEAAvD,EAAuD,CAAA;AAAA,EAAA,IAA5CC,QAA4C,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAA,SAAA,CAAA;AAAA,EAAA,IAAlCC,QAAkC,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAA,SAAA,CAAA;EAAA,IAAxBC,cAAwB,uEAAP,EAAO,CAAA;EAEpG,IAAMC,UAAa,GAAAC,OAAA,CAAQC,GAAR,CAAYN,KAAZ,EAAmBC,QAAnB,CAAnB,CAAA;AAEA,EAAA,IAAMM,QAAQP,KAAM,CAAAC,QAAA,CAApB,CAAA;AAEM,EAAA,IAAAO,YAAA,GACJL,eAAyBM,SAAAA,CAAAA,MAAAA,CAAAA,uBAAA,CAAWR,QAAX,EAAzB,CAAA,IAA8DD,KAAA,CAAgBS,SAAAA,CAAAA,MAAAA,CAAAA,uBAAA,CAAWR,QAAX,CAAhB,CAD1D,CAAA,CAAA;;EAIN,IAA0CS,SAAAA,GAAAA,eAASF,aAAnD;AAAA,MAAA,UAAA,GAAAG,4BAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,aAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAsBC,gBAAtB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EAGI,IAAAT,UAAA,EAAmB,OAAA,CAACG,KAAD,EAAQL,QAAA,IAAYY,qBAApB,CAAA,CAAA;AAGhB,EAAA,OAAA,CACLF,aADK,EAEL,UAACG,QAAD,EAAuB;IACrBF,gBAAA,CAAiBE,QAAjB,CAAA,CAAA;;AADqB,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAATC,IAAS,GAAA,IAAA,KAAA,CAAA,IAAA,GAAA,CAAA,GAAA,IAAA,GAAA,CAAA,GAAA,CAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;MAATA,IAAS,CAAA,IAAA,GAAA,CAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAAA,KAAA;;IAEVd,QAAA,KAAA,IAAA,IAAAA,QAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,QAAA,CAAA,KAAA,CAAA,KAAA,CAAA,EAAA,CAAAa,QAAA,CAAA,CAAA,MAAA,CAAaC,IAAb,CAAA,CAAA,CAAA;AACb,GALK,CAAA,CAAA;AAOT;;;;"}