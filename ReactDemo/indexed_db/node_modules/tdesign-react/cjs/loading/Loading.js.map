{"version":3,"file":"Loading.js","sources":["../../src/loading/Loading.tsx"],"sourcesContent":["import React, { useState, useEffect, FC, useMemo, CSSProperties } from 'react';\nimport classnames from 'classnames';\n\nimport { addClass, canUseDocument, removeClass } from '../_util/dom';\nimport useConfig from '../hooks/useConfig';\nimport { StyledProps } from '../common';\nimport { TdLoadingProps } from './type';\nimport Portal from '../common/Portal';\nimport Gradient from './gradient';\nimport { loadingDefaultProps } from './defaultProps';\n\nexport interface LoadingProps extends TdLoadingProps, StyledProps {}\n\nconst Loading: FC<LoadingProps> = (props) => {\n  const {\n    attach,\n    indicator,\n    text,\n    loading,\n    size,\n    delay,\n    fullscreen,\n    preventScrollThrough,\n    showOverlay,\n    content,\n    children,\n    inheritColor,\n    zIndex,\n    className,\n    style,\n  } = props;\n\n  const [showLoading, setShowLoading] = useState(delay ? false : loading);\n\n  const { classPrefix } = useConfig();\n\n  const name = `${classPrefix}-loading`;\n  const centerClass = `${classPrefix}-loading--center`;\n  const inheritColorClass = `${classPrefix}-loading--inherit-color`;\n  const fullClass = `${classPrefix}-loading--full`;\n  const fullscreenClass = `${classPrefix}-loading__fullscreen`;\n  const lockClass = `${classPrefix}-loading--lock`;\n  const overlayClass = `${classPrefix}-loading__overlay`;\n  const relativeClass = `${classPrefix}-loading__parent`;\n  const textClass = `${classPrefix}-loading__text`;\n\n  useEffect(() => {\n    let timer: NodeJS.Timeout;\n\n    if (delay && loading) {\n      timer = setTimeout(() => {\n        setShowLoading(loading);\n      }, delay);\n    } else {\n      setShowLoading(loading);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [delay, loading]);\n\n  const calcStyles = useMemo(() => {\n    const styles: CSSProperties = {};\n\n    if (zIndex !== undefined) {\n      styles.zIndex = zIndex;\n    }\n\n    if (!['small', 'medium', 'large'].includes(size)) {\n      styles.fontSize = size;\n    }\n\n    return style ? { ...styles, ...style } : styles;\n  }, [size, zIndex, style]);\n\n  const sizeMap = {\n    large: `${classPrefix}-size-l`,\n    small: `${classPrefix}-size-s`,\n    medium: `${classPrefix}-size-m`,\n  };\n\n  const baseClasses = classnames(\n    centerClass,\n    sizeMap[size],\n    {\n      [inheritColorClass]: inheritColor,\n    },\n    className,\n  );\n\n  useEffect(() => {\n    if (preventScrollThrough && fullscreen && canUseDocument && loading) {\n      addClass(document.body, lockClass);\n    }\n    return () => {\n      removeClass(document.body, lockClass);\n    };\n  }, [loading, preventScrollThrough, fullscreen, lockClass]);\n\n  const commonContent = () => {\n    let renderIndicator = <Gradient />;\n\n    if (indicator && typeof indicator !== 'boolean') {\n      renderIndicator = indicator as JSX.Element;\n    }\n    return (\n      <>\n        {indicator ? renderIndicator : null}\n        {text ? <div className={textClass}>{text}</div> : null}\n      </>\n    );\n  };\n\n  if (fullscreen) {\n    return loading ? (\n      <div className={classnames(name, fullscreenClass, centerClass, overlayClass)} style={calcStyles}>\n        <div className={baseClasses}>{commonContent()}</div>\n      </div>\n    ) : null;\n  }\n\n  if (content || children) {\n    return (\n      <div className={relativeClass}>\n        {content || children}\n        {showLoading ? (\n          <div\n            className={classnames(name, baseClasses, fullClass, {\n              [overlayClass]: showOverlay,\n            })}\n            style={calcStyles}\n          >\n            {commonContent()}\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n  if (attach) {\n    return (\n      <Portal attach={attach}>\n        {loading ? (\n          <div className={classnames(name, baseClasses, fullClass, { [overlayClass]: showOverlay })} style={calcStyles}>\n            {commonContent()}\n          </div>\n        ) : null}\n      </Portal>\n    );\n  }\n\n  return loading ? (\n    <div className={classnames(name, baseClasses)} style={calcStyles}>\n      {commonContent()}\n    </div>\n  ) : null;\n};\n\nLoading.displayName = 'Loading';\nLoading.defaultProps = loadingDefaultProps;\n\nexport default Loading;\n"],"names":["Loading","props","attach","indicator","text","loading","size","delay","fullscreen","preventScrollThrough","showOverlay","content","children","inheritColor","zIndex","className","style","useState","_slicedToArray","showLoading","setShowLoading","useConfig","classPrefix","name","centerClass","inheritColorClass","fullClass","fullscreenClass","lockClass","overlayClass","relativeClass","textClass","useEffect","timer","setTimeout","clearTimeout","calcStyles","useMemo","styles","includes","fontSize","sizeMap","large","small","medium","baseClasses","classnames","canUseDocument","addClass","document","body","removeClass","commonContent","renderIndicator","Gradient","React","createElement","Fragment","Portal","displayName","defaultProps","loadingDefaultProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,IAAMA,OAAA,GAA4B,SAA5BA,OAA4B,CAACC,KAAD,EAAW;AACrC,EAAA,IACJC,MADI,GAgBFD,KAhBE,CACJC,MADI;AAAA,MAEJC,SAFI,GAgBFF,KAhBE,CAEJE,SAFI;AAAA,MAGJC,IAHI,GAgBFH,KAhBE,CAGJG,IAHI;AAAA,MAIJC,OAJI,GAgBFJ,KAhBE,CAIJI,OAJI;AAAA,MAKJC,IALI,GAgBFL,KAhBE,CAKJK,IALI;AAAA,MAMJC,KANI,GAgBFN,KAhBE,CAMJM,KANI;AAAA,MAOJC,UAPI,GAgBFP,KAhBE,CAOJO,UAPI;AAAA,MAQJC,oBARI,GAgBFR,KAhBE,CAQJQ,oBARI;AAAA,MASJC,WATI,GAgBFT,KAhBE,CASJS,WATI;AAAA,MAUJC,OAVI,GAgBFV,KAhBE,CAUJU,OAVI;AAAA,MAWJC,QAXI,GAgBFX,KAhBE,CAWJW,QAXI;AAAA,MAYJC,YAZI,GAgBFZ,KAhBE,CAYJY,YAZI;AAAA,MAaJC,MAbI,GAgBFb,KAhBE,CAaJa,MAbI;AAAA,MAcJC,SAdI,GAgBFd,KAhBE,CAcJc,SAdI;AAAA,MAeJC,KAfI,GAgBFf,KAhBE,CAeJe,KAfI,CAAA;;AAkBN,EAAA,IAAA,SAAA,GAAsCC,cAAS,CAAAV,KAAA,GAAQ,KAAR,GAAgBF,OAAhB,CAA/C;AAAA,MAAA,UAAA,GAAAa,4BAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,WAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAoBC,cAApB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;AAEM,EAAA,IAAA,UAAA,GAAkBC,0BAAU,EAA5B;MAAEC,WAAF,cAAEA,WAAF,CAAA;;EAEN,IAAMC,OAAUD,EAAAA,CAAAA,MAAAA,CAAAA,aAAhB,UAAA,CAAA,CAAA;EACA,IAAME,cAAiBF,EAAAA,CAAAA,MAAAA,CAAAA,aAAvB,kBAAA,CAAA,CAAA;EACA,IAAMG,oBAAuBH,EAAAA,CAAAA,MAAAA,CAAAA,aAA7B,yBAAA,CAAA,CAAA;EACA,IAAMI,YAAeJ,EAAAA,CAAAA,MAAAA,CAAAA,aAArB,gBAAA,CAAA,CAAA;EACA,IAAMK,kBAAqBL,EAAAA,CAAAA,MAAAA,CAAAA,aAA3B,sBAAA,CAAA,CAAA;EACA,IAAMM,YAAeN,EAAAA,CAAAA,MAAAA,CAAAA,aAArB,gBAAA,CAAA,CAAA;EACA,IAAMO,eAAkBP,EAAAA,CAAAA,MAAAA,CAAAA,aAAxB,mBAAA,CAAA,CAAA;EACA,IAAMQ,gBAAmBR,EAAAA,CAAAA,MAAAA,CAAAA,aAAzB,kBAAA,CAAA,CAAA;EACA,IAAMS,YAAeT,EAAAA,CAAAA,MAAAA,CAAAA,aAArB,gBAAA,CAAA,CAAA;AAEAU,EAAAA,eAAA,CAAU,YAAM;AACV,IAAA,IAAAC,KAAA,CAAA;;IAEJ,IAAI1B,SAASF,OAAb,EAAsB;MACpB4B,KAAA,GAAQC,WAAW,YAAM;QACvBd,cAAA,CAAef,OAAf,CAAA,CAAA;SACCE,MAFH,CAAA;AAGK,KAJP,MAIO;MACLa,cAAA,CAAef,OAAf,CAAA,CAAA;AACF,KAAA;;AACA,IAAA,OAAO,YAAM;MACX8B,YAAA,CAAaF,KAAb,CAAA,CAAA;KADF,CAAA;AAGC,GAbH,EAaG,CAAC1B,KAAD,EAAQF,OAAR,CAbH,CAAA,CAAA;AAeM,EAAA,IAAA+B,UAAA,GAAaC,cAAQ,YAAM;IAC/B,IAAMC,SAAwB,EAA9B,CAAA;;AAEA,IAAA,IAAIxB,WAAW,KAAW,CAA1B,EAA0B;MACxBwB,MAAA,CAAOxB,MAAP,GAAgBA,MAAhB,CAAA;AACF,KAAA;;AAEI,IAAA,IAAA,CAAC,CAAC,OAAD,EAAU,QAAV,EAAoB,OAApB,CAAA,CAA6ByB,QAA7B,CAAsCjC,IAAtC,CAAD,EAA8C;MAChDgC,MAAA,CAAOE,QAAP,GAAkBlC,IAAlB,CAAA;AACF,KAAA;;AAEA,IAAA,OAAOU,QAAasB,aAAAA,CAAAA,aAAAA,CAAAA,EAAAA,EAAAA,OAAWtB,EAAAA,SAAUsB,MAAzC,CAAA;KACC,CAAChC,IAAD,EAAOQ,MAAP,EAAeE,KAAf,EAZG,CAAA;AAcN,EAAA,IAAMyB,OAAU,GAAA;IACdC,iBAAUpB,aADI,SAAA,CAAA;IAEdqB,iBAAUrB,aAFI,SAAA,CAAA;AAGdsB,IAAAA,kBAAWtB;GAHb,CAAA;AAMA,EAAA,IAAMuB,WAAc,GAAAC,8BAAA,CAClBtB,WADkB,EAElBiB,OAAQ,CAAAnC,IAAA,CAFU,qCAIfmB,iBAJe,EAIKZ,YAJL,CAAA,EAMlBE,SANkB,CAApB,CAAA;AASAiB,EAAAA,eAAA,CAAU,YAAM;AACV,IAAA,IAAAvB,oBAAA,IAAwBD,UAAxB,IAAsCuC,wBAAtC,IAAwD1C,OAAxD,EAAiE;AAC1D2C,MAAAA,kBAAA,CAAAC,QAAA,CAASC,IAAT,EAAetB,SAAf,CAAA,CAAA;AACX,KAAA;;AACA,IAAA,OAAO,YAAM;AACCuB,MAAAA,qBAAA,CAAAF,QAAA,CAASC,IAAT,EAAetB,SAAf,CAAA,CAAA;KADd,CAAA;GAJF,EAOG,CAACvB,OAAD,EAAUI,oBAAV,EAAgCD,UAAhC,EAA4CoB,SAA5C,CAPH,CAAA,CAAA;;AASA,EAAA,IAAMwB,gBAAgB,SAAhBA,aAAgB,GAAM;IACtB,IAAAC,eAAA,0DAAmBC,6BAAS,KAA5B,CAAA;;AAEA,IAAA,IAAAnD,SAAA,IAAa,OAAOA,SAAP,KAAqB,SAAlC,EAA6C;AAC7BkD,MAAAA,eAAA,GAAAlD,SAAA,CAAA;AACpB,KAAA;;IACA,sBAEKoD,yBAAA,CAAAC,aAAA,CAAAD,yBAAA,CAAAE,QAAA,EAAA,IAAA,EAAAtD,SAAA,GAAYkD,eAAZ,GAA8B,IAA9B,EACAjD,sBAAQmD,yBAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIzC,MAAAA,SAAW,EAAAgB,SAAAA;AAAf,KAAA,EAA2B3B,IAA3B,IAAyC,IADjD,CAFL,CAAA;GANF,CAAA;;AAcA,EAAA,IAAII,UAAJ,EAAgB;IACd,OAAOH,yBACJkD,yBAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;MAAIzC,SAAW,EAAA+B,8BAAA,CAAWvB,IAAX,EAAiBI,eAAjB,EAAkCH,WAAlC,EAA+CK,YAA/C,CAAf;AAA6Eb,MAAAA,KAAO,EAAAoB,UAAAA;AAApF,KAAA,iBACEmB,yBAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIzC,MAAAA,SAAW,EAAA8B,WAAAA;AAAf,KAAA,EAA6BO,aAAA,EAA7B,CADF,IAGC,IAJJ,CAAA;AAKF,GAAA;;EAEA,IAAIzC,WAAWC,QAAf,EAAyB;AACvB,IAAA,sBACG2C,yBAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIzC,MAAAA,SAAW,EAAAe,aAAAA;AAAf,KAAA,EACEnB,OAAA,IAAWC,QADb,EAEEO,WAAA,kBACEoC,yBAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AACCzC,MAAAA,SAAW,EAAA+B,8BAAA,CAAWvB,IAAX,EAAiBsB,WAAjB,EAA8BnB,SAA9B,EACRG,8BAAAA,CAAAA,EAAAA,EAAAA,YADQ,EACOnB,WADP,CADZ,CAAA;AAICM,MAAAA,KAAO,EAAAoB,UAAAA;AAJR,KAAA,EAMEgB,aAAA,EANF,CADF,GASG,IAXL,CADH,CAAA;AAeF,GAAA;;AACA,EAAA,IAAIlD,MAAJ,EAAY;AACV,IAAA,sBACGqD,yBAAA,CAAAC,aAAA,CAAAE,wBAAA,EAAA;AAAOxD,MAAAA,MAAA,EAAAA,MAAAA;KAAP,EACEG,yBACEkD,yBAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIzC,MAAAA,SAAA,EAAW+B,+BAAWvB,MAAMsB,aAAanB,WAAcG,8BAAAA,CAAAA,EAAAA,EAAAA,cAAenB,YAA1E,CAAA;AAA0FM,MAAAA,KAAO,EAAAoB,UAAAA;AAAjG,KAAA,EACEgB,aAAA,EADF,IAGC,IALL,CADH,CAAA;AASF,GAAA;;EAEA,OAAO/C,yBACJkD,yBAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AAAIzC,IAAAA,SAAA,EAAW+B,8BAAW,CAAAvB,IAAA,EAAMsB,WAAN,CAA1B;AAA8C7B,IAAAA,KAAO,EAAAoB,UAAAA;AAArD,GAAA,EACEgB,aAAA,EADF,IAGC,IAJJ,CAAA;AAKF,EA9IA;;AAgJApD,OAAA,CAAQ2D,WAAR,GAAsB,SAAtB,CAAA;AACA3D,OAAA,CAAQ4D,YAAR,GAAuBC,wCAAvB;;;;"}