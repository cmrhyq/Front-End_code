{"version":3,"file":"dom.js","sources":["../../../src/anchor/_util/dom.ts"],"sourcesContent":["import raf from 'raf';\nimport { easeInOutCubic, EasingFunction } from '../../_util/easing';\n\nexport type AnchorContainer = HTMLElement | Window;\n\nexport function getOffsetTop(target: HTMLElement, container: AnchorContainer) {\n  const { top } = target.getBoundingClientRect();\n  if (container === window) {\n    // 减去 document 的边框\n    return top - document.documentElement.clientTop;\n  }\n  return top - (container as HTMLElement).getBoundingClientRect().top;\n}\n\n/**\n * 返回是否 window 对象\n *\n * @export\n * @param {any} obj\n * @returns\n */\nfunction isWindow(obj: any) {\n  return obj && obj === obj.window;\n}\n\ntype ScrollTarget = HTMLElement | Window | Document;\n\n/**\n * 获取滚动距离\n *\n * @export\n * @param {ScrollTarget} target\n * @param {boolean} isLeft true为获取scrollLeft, false为获取scrollTop\n * @returns {number}\n */\nexport function getScroll(target: ScrollTarget, isLeft?: boolean): number {\n  // node 环境或者 target 为空\n  if (typeof window === 'undefined' || !target) {\n    return 0;\n  }\n  const method = isLeft ? 'scrollLeft' : 'scrollTop';\n  let result = 0;\n  if (isWindow(target)) {\n    result = (target as Window)[isLeft ? 'pageXOffset' : 'pageYOffset'];\n  } else if (target instanceof Document) {\n    result = target.documentElement[method];\n  } else if (target) {\n    result = (target as HTMLElement)[method];\n  }\n  return result;\n}\n\ninterface ScrollTopOptions {\n  container?: ScrollTarget;\n  duration?: number;\n  easing?: EasingFunction;\n}\nexport function scrollTo(target: number, opt: ScrollTopOptions) {\n  const { container = window, duration = 450, easing = easeInOutCubic } = opt;\n  const scrollTop = getScroll(container);\n  const startTime = Date.now();\n  return new Promise((res) => {\n    const fnc = () => {\n      const timestamp = Date.now();\n      const time = timestamp - startTime;\n      const nextScrollTop = easing(Math.min(time, duration), scrollTop, target, duration);\n      if (isWindow(container)) {\n        (container as Window).scrollTo(window.pageXOffset, nextScrollTop);\n      } else if (container instanceof HTMLDocument || container.constructor.name === 'HTMLDocument') {\n        (container as HTMLDocument).documentElement.scrollTop = nextScrollTop;\n      } else {\n        (container as HTMLElement).scrollTop = nextScrollTop;\n      }\n      if (time < duration) {\n        raf(fnc);\n      } else {\n        // 由于上面步骤设置了 scrollTop, 滚动事件可能未触发完毕\n        // 此时应该在下一帧再执行 res\n        raf(res);\n      }\n    };\n    raf(fnc);\n  });\n}\n"],"names":["getOffsetTop","target","container","getBoundingClientRect","top","window","document","documentElement","clientTop","isWindow","obj","getScroll","isLeft","method","result","Document","scrollTo","opt","duration","easing","easeInOutCubic","scrollTop","startTime","Date","now","Promise","res","fnc","timestamp","time","nextScrollTop","Math","min","pageXOffset","HTMLDocument","constructor","name","raf"],"mappings":"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"}