{"version":3,"file":"Swiper.js","sources":["../../src/swiper/Swiper.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo, useRef, isValidElement } from 'react';\nimport classnames from 'classnames';\nimport { ChevronLeftIcon as TdChevronLeftIcon, ChevronRightIcon as TdChevronRightIcon } from 'tdesign-icons-react';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport noop from '../_util/noop';\nimport { TdSwiperProps, SwiperChangeSource, SwiperNavigation } from './type';\nimport { StyledProps } from '../common';\nimport { swiperDefaultProps } from './defaultProps';\n\nimport SwiperItem from './SwiperItem';\n\nexport interface SwiperProps extends TdSwiperProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nenum CreateArrow {\n  Default = 'default',\n  Fraction = 'fraction',\n}\n\nenum ArrowClickDirection {\n  Left = 'left',\n  Right = 'right',\n}\n\nenum MouseAction {\n  Enter = 'enter',\n  Leave = 'leave',\n  Click = 'click',\n}\n\nconst defaultNavigation: SwiperNavigation = {\n  placement: 'inside',\n  showSlideBtn: 'always',\n  size: 'medium',\n  type: 'bars',\n};\n\nconst Swiper = (props: SwiperProps) => {\n  const {\n    animation, // 轮播切换动画效果类型\n    autoplay, // 是否自动播放\n    current, // 当前轮播在哪一项（下标）\n    defaultCurrent, // 当前轮播在哪一项（下标），非受控属性\n    direction, // 轮播滑动方向，包括横向滑动和纵向滑动两个方向\n    duration, // 滑动动画时长\n    interval, // 轮播间隔时间\n    trigger,\n    height,\n    loop,\n    stopOnHover,\n    onChange = noop, // 轮播切换时触发\n    className,\n    children,\n    navigation,\n    type,\n  } = props;\n  const { classPrefix } = useConfig();\n  const { ChevronLeftIcon, ChevronRightIcon } = useGlobalIcon({\n    ChevronLeftIcon: TdChevronLeftIcon,\n    ChevronRightIcon: TdChevronRightIcon,\n  });\n\n  let navigationConfig = defaultNavigation;\n  let navigationNode = null;\n  if (isValidElement(navigation)) {\n    navigationNode = navigation;\n  } else {\n    navigationConfig = { ...defaultNavigation, ...(navigation as SwiperNavigation) };\n  }\n\n  const [currentIndex, setCurrentIndex] = useState(defaultCurrent);\n  const [needAnimation, setNeedAnimation] = useState(false);\n  const [arrowShow, setArrowShow] = useState(navigationConfig.showSlideBtn === 'always');\n  const swiperTimer = useRef(null); // 计时器指针\n  const swiperAnimationTimer = useRef(null); // 计时器指针\n  const isHovering = useRef(false);\n  const swiperWrap = useRef(null);\n\n  const getWrapAttribute = (attr) => swiperWrap.current?.parentNode?.[attr];\n\n  // 进行子组件筛选，创建子节点列表\n  const childrenList = useMemo(\n    () =>\n      React.Children.toArray(children).filter(\n        (child: JSX.Element) => child.type.displayName === SwiperItem.displayName,\n      ),\n    [children],\n  );\n  const childrenLength = childrenList.length;\n\n  // 创建渲染用的节点列表\n  const swiperItemList = childrenList.map((child: JSX.Element, index: number) =>\n    React.cloneElement(child, {\n      key: index,\n      index,\n      currentIndex,\n      needAnimation,\n      childrenLength,\n      getWrapAttribute,\n      ...props,\n      ...child.props,\n    }),\n  );\n  // 子节点不为空时，复制第一个子节点到列表最后\n  if (childrenLength > 0 && type === 'default') {\n    const firstEle = swiperItemList[0];\n    swiperItemList.push(\n      React.cloneElement(firstEle, { ...firstEle.props, key: childrenLength, index: childrenLength }),\n    );\n  }\n  const swiperItemLength = swiperItemList.length;\n\n  // 统一跳转处理函数\n  const swiperTo = useCallback(\n    (index: number, context: { source: SwiperChangeSource }) => {\n      // 事件通知\n      onChange(index % childrenLength, context);\n      // 设置内部 index\n      setNeedAnimation(true);\n      setCurrentIndex(index);\n    },\n    [childrenLength, onChange],\n  );\n\n  // 定时器\n  const setTimer = useCallback(() => {\n    if (autoplay && interval > 0) {\n      swiperTimer.current = setTimeout(\n        () => {\n          swiperTo(currentIndex + 1, { source: 'autoplay' });\n        },\n        currentIndex === 0 ? interval - (duration + 50) : interval, // 当 index 为 0 的时候，表明刚从克隆的最后一项跳转过来，已经经历了duration + 50 的间隔时间，减去即可\n      );\n    }\n  }, [autoplay, currentIndex, duration, interval, swiperTo]);\n\n  const clearTimer = useCallback(() => {\n    if (swiperTimer.current) {\n      clearTimeout(swiperTimer.current);\n      swiperTimer.current = null;\n    }\n  }, []);\n\n  const isEnd = useCallback(() => {\n    if (type === 'card') {\n      return !loop && currentIndex + 1 >= swiperItemLength;\n    }\n    return !loop && currentIndex + 2 >= swiperItemLength;\n  }, [loop, currentIndex, swiperItemLength, type]);\n\n  // 监听 current 参数变化\n  useEffect(() => {\n    if (current !== undefined) {\n      swiperTo(current % childrenLength, { source: 'autoplay' });\n    }\n  }, [current, childrenLength, swiperTo]);\n\n  // 监听每次轮播结束\n  useEffect(() => {\n    if (currentIndex + 1 > swiperItemLength && type === 'card') {\n      return setCurrentIndex(0);\n    }\n    if (swiperAnimationTimer.current) {\n      clearTimeout(swiperAnimationTimer.current);\n      swiperAnimationTimer.current = null;\n    }\n    swiperAnimationTimer.current = setTimeout(() => {\n      setNeedAnimation(false);\n      if (isEnd()) {\n        clearTimer();\n      }\n      if (currentIndex + 1 >= swiperItemLength && type !== 'card') {\n        setCurrentIndex(0);\n      }\n    }, duration + 50); // 多 50ms 的间隔时间参考了 react-slick 的动画间隔取值\n  }, [currentIndex, swiperItemLength, duration, type, clearTimer, isEnd]);\n\n  useEffect(() => {\n    if (!isHovering.current || !stopOnHover) {\n      clearTimer();\n      setTimer();\n    }\n  }, [setTimer, clearTimer, stopOnHover]);\n\n  // 鼠标移入移出事件\n  const onMouseEnter = () => {\n    isHovering.current = true;\n    if (stopOnHover) {\n      clearTimer();\n    }\n    if (navigationConfig.showSlideBtn === 'hover') {\n      setArrowShow(true);\n    }\n  };\n  const onMouseLeave = () => {\n    isHovering.current = false;\n    if (!isEnd()) {\n      setTimer();\n    }\n    if (navigationConfig.showSlideBtn === 'hover') {\n      setArrowShow(false);\n    }\n  };\n\n  const navMouseAction = (action: MouseAction, index: number) => {\n    if (action === MouseAction.Enter && trigger === 'hover') {\n      swiperTo(index, { source: 'hover' });\n    }\n    if (action === MouseAction.Click && trigger === 'click') {\n      swiperTo(index, { source: 'click' });\n    }\n  };\n\n  const arrowClick = (direction: ArrowClickDirection) => {\n    if (needAnimation) {\n      return false;\n    }\n    if (direction === ArrowClickDirection.Right) {\n      if (type === 'card') {\n        return swiperTo(currentIndex + 1 >= swiperItemLength ? 0 : currentIndex + 1, { source: 'click' });\n      }\n      return swiperTo(currentIndex + 1, { source: 'click' });\n    }\n    if (direction === ArrowClickDirection.Left) {\n      if (currentIndex - 1 < 0) {\n        return swiperTo(childrenLength - 1, { source: 'click' });\n      }\n      return swiperTo(currentIndex - 1, { source: 'click' });\n    }\n  };\n\n  const createArrow = (type: CreateArrow) => {\n    if (!arrowShow) {\n      return '';\n    }\n    if (navigationConfig.type === 'fraction' && type === CreateArrow.Default) {\n      return '';\n    }\n    const fractionIndex = currentIndex + 1 > childrenLength ? 1 : currentIndex + 1;\n    return (\n      <div\n        className={classnames(`${classPrefix}-swiper__arrow`, {\n          [`${classPrefix}-swiper__arrow--default`]: type === 'default',\n        })}\n      >\n        <div className={`${classPrefix}-swiper__arrow-left`} onClick={() => arrowClick(ArrowClickDirection.Left)}>\n          <ChevronLeftIcon />\n        </div>\n        {type === CreateArrow.Fraction ? (\n          <div className={`${classPrefix}-swiper__navigation-text-fraction`}>\n            {fractionIndex}/{childrenLength}\n          </div>\n        ) : (\n          ''\n        )}\n        <div className={`${classPrefix}-swiper__arrow-right`} onClick={() => arrowClick(ArrowClickDirection.Right)}>\n          <ChevronRightIcon />\n        </div>\n      </div>\n    );\n  };\n\n  const createNavigation = () => {\n    if (navigationConfig.type === 'fraction') {\n      return (\n        <div className={classnames(`${classPrefix}-swiper__navigation`, `${classPrefix}-swiper__navigation--fraction`)}>\n          {createArrow(CreateArrow.Fraction)}\n        </div>\n      );\n    }\n    return navigationNode ? (\n      <>{navigationNode}</>\n    ) : (\n      <ul\n        className={classnames(`${classPrefix}-swiper__navigation`, {\n          [`${classPrefix}-swiper__navigation-bars`]: navigationConfig.type === 'bars',\n        })}\n      >\n        {childrenList.map((_: JSX.Element, i: number) => (\n          <li\n            key={i}\n            className={classnames(`${classPrefix}-swiper__navigation-item`, {\n              [`${classPrefix}-is-active`]: i === currentIndex % childrenLength,\n            })}\n            onClick={() => navMouseAction(MouseAction.Click, i)}\n            onMouseEnter={() => navMouseAction(MouseAction.Enter, i)}\n            onMouseLeave={() => navMouseAction(MouseAction.Leave, i)}\n          >\n            <span></span>\n          </li>\n        ))}\n      </ul>\n    );\n  };\n\n  // 构造 css 对象\n  const getWrapperStyle = () => {\n    const offsetHeight = height ? `${height}px` : `${getWrapAttribute('offsetHeight')}px`;\n    if (type === 'card' || animation === 'fade') {\n      return {\n        height: offsetHeight,\n      };\n    }\n    if (animation === 'slide') {\n      if (direction === 'vertical') {\n        return {\n          height: offsetHeight,\n          msTransform: `translate3d(0, -${currentIndex * 100}%, 0px)`,\n          WebkitTransform: `translate3d(0, -${currentIndex * 100}%, 0px)`,\n          transform: `translate3d(0, -${currentIndex * 100}%, 0px)`,\n          transition: needAnimation ? `transform ${duration / 1000}s ease` : '',\n        };\n      }\n      return {\n        msTransform: `translate3d(-${currentIndex * 100}%, 0px, 0px)`,\n        WebkitTransform: `translate3d(-${currentIndex * 100}%, 0px, 0px)`,\n        transform: `translate3d(-${currentIndex * 100}%, 0px, 0px)`,\n        transition: needAnimation ? `transform ${duration / 1000}s ease` : '',\n      };\n    }\n  };\n\n  return (\n    <div\n      className={classnames(`${classPrefix}-swiper`, className)}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      ref={swiperWrap}\n    >\n      <div\n        className={classnames(`${classPrefix}-swiper__wrap`, {\n          [`${classPrefix}-swiper--inside`]: navigationConfig.placement === 'inside',\n          [`${classPrefix}-swiper--outside`]: navigationConfig.placement === 'outside',\n          [`${classPrefix}-swiper--vertical`]: direction === 'vertical',\n          [`${classPrefix}-swiper--large`]: navigationConfig.size === 'large',\n          [`${classPrefix}-swiper--small`]: navigationConfig.size === 'small',\n        })}\n      >\n        <div\n          className={classnames(`${classPrefix}-swiper__content`, {\n            [`${classPrefix}-swiper-fade`]: animation === 'fade',\n            [`${classPrefix}-swiper-card`]: type === 'card',\n          })}\n          style={{ height: '' }}\n        >\n          <div className={`${classPrefix}-swiper__container`} style={getWrapperStyle()}>\n            {swiperItemList}\n          </div>\n        </div>\n        {createNavigation()}\n        {createArrow(CreateArrow.Default)}\n      </div>\n    </div>\n  );\n};\n\nSwiper.SwiperItem = SwiperItem;\n\nSwiper.displayName = 'Swiper';\nSwiper.defaultProps = swiperDefaultProps;\n\nexport default Swiper;\n"],"names":["defaultNavigation","placement","showSlideBtn","size","type","Swiper","props","animation","autoplay","current","defaultCurrent","direction","duration","interval","trigger","height","loop","stopOnHover","onChange","noop","className","children","navigation","useConfig","classPrefix","useGlobalIcon","ChevronLeftIcon","TdChevronLeftIcon","ChevronRightIcon","TdChevronRightIcon","navigationConfig","navigationNode","isValidElement","useState","_slicedToArray","currentIndex","setCurrentIndex","needAnimation","setNeedAnimation","arrowShow","setArrowShow","swiperTimer","useRef","swiperAnimationTimer","isHovering","swiperWrap","getWrapAttribute","attr","parentNode","childrenList","useMemo","React","Children","toArray","filter","child","displayName","SwiperItem","childrenLength","length","swiperItemList","map","index","cloneElement","key","firstEle","push","swiperItemLength","swiperTo","useCallback","context","setTimer","setTimeout","source","clearTimer","clearTimeout","isEnd","useEffect","onMouseEnter","onMouseLeave","navMouseAction","action","arrowClick","createArrow","fractionIndex","createElement","classnames","onClick","createNavigation","Fragment","_defineProperty","_","i","getWrapperStyle","offsetHeight","msTransform","WebkitTransform","transform","transition","ref","style","defaultProps","swiperDefaultProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA,IAAMA,iBAAsC,GAAA;AAC1CC,EAAAA,SAAW,EAAA,QAD+B;AAE1CC,EAAAA,YAAc,EAAA,QAF4B;AAG1CC,EAAAA,IAAM,EAAA,QAHoC;AAI1CC,EAAAA,IAAM,EAAA,MAAA;AAJoC,CAA5C,CAAA;;AAOA,IAAMC,MAAA,GAAS,SAATA,MAAS,CAACC,KAAD,EAAwB;AAAA,EAAA,IAAA,YAAA,EAAA,YAAA,CAAA;;AAC/B,EAAA,IACJC,SADI,GAiBFD,KAjBE,CACJC,SADI;AAAA,MAEJC,QAFI,GAiBFF,KAjBE,CAEJE,QAFI;AAAA,MAGJC,OAHI,GAiBFH,KAjBE,CAGJG,OAHI;AAAA,MAIJC,cAJI,GAiBFJ,KAjBE,CAIJI,cAJI;AAAA,MAKJC,SALI,GAiBFL,KAjBE,CAKJK,SALI;AAAA,MAMJC,QANI,GAiBFN,KAjBE,CAMJM,QANI;AAAA,MAOJC,QAPI,GAiBFP,KAjBE,CAOJO,QAPI;AAAA,MAQJC,OARI,GAiBFR,KAjBE,CAQJQ,OARI;AAAA,MASJC,MATI,GAiBFT,KAjBE,CASJS,MATI;AAAA,MAUJC,IAVI,GAiBFV,KAjBE,CAUJU,IAVI;AAAA,MAWJC,WAXI,GAiBFX,KAjBE,CAWJW,WAXI;MAiBFX,eAAAA,GAAAA,KAjBE,CAYJY,QAZI;MAYJA,QAZI,gCAYOC,qBAZP,GAAA,eAAA;AAAA,MAaJC,SAbI,GAiBFd,KAjBE,CAaJc,SAbI;AAAA,MAcJC,QAdI,GAiBFf,KAjBE,CAcJe,QAdI;AAAA,MAeJC,UAfI,GAiBFhB,KAjBE,CAeJgB,UAfI;AAAA,MAgBJlB,IAhBI,GAiBFE,KAjBE,CAgBJF,IAhBI,CAAA;;AAkBA,EAAA,IAAA,UAAA,GAAkBmB,0BAAU,EAA5B;MAAEC,WAAF,cAAEA,WAAF,CAAA;;AACN,EAAA,IAAA,cAAA,GAA8CC,8BAAc,CAAA;AAC1DC,IAAAA,eAAiB,EAAAC,iCADyC;AAE1DC,IAAAA,gBAAkB,EAAAC,kCAAAA;AAFwC,GAAA,CAA5D;MAAQH,eAAR,kBAAQA,eAAR;MAAyBE,gBAAzB,kBAAyBA,gBAAzB,CAAA;;EAKA,IAAIE,gBAAmB,GAAA9B,iBAAvB,CAAA;EACA,IAAI+B,cAAiB,GAAA,IAArB,CAAA;;AACI,EAAA,kBAAAC,oBAAA,CAAeV,UAAf,CAAA,EAA4B;AACbS,IAAAA,cAAA,GAAAT,UAAA,CAAA;AACZ,GAFH,MAEG;AACLQ,IAAAA,gBAAA,GAAwB9B,aAAAA,CAAAA,aAAAA,CAAAA,EAAAA,EAAAA,iBAAxB,CAA+CsB,EAAAA,UAA/C,CAAA,CAAA;AACF,GAAA;;EAEA,IAAwCW,SAAAA,GAAAA,eAASvB,eAAjD;AAAA,MAAA,UAAA,GAAAwB,4BAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,YAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAqBC,eAArB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAA0CH,UAAAA,GAAAA,eAAS,MAAnD;AAAA,MAAA,UAAA,GAAAC,4BAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAA,MAAOG,aAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAsBC,gBAAtB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;AACA,EAAA,IAAA,UAAA,GAAkCL,cAAS,CAAAH,gBAAA,CAAiB5B,YAAjB,KAAkC,QAAlC,CAA3C;AAAA,MAAA,UAAA,GAAAgC,4BAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAA,MAAOK,SAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAkBC,YAAlB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;AACM,EAAA,IAAAC,WAAA,GAAcC,aAAO,KAArB,CAAA;AACA,EAAA,IAAAC,oBAAA,GAAuBD,aAAO,KAA9B,CAAA;AACA,EAAA,IAAAE,UAAA,GAAaF,aAAO,MAApB,CAAA;AACA,EAAA,IAAAG,UAAA,GAAaH,aAAO,KAApB,CAAA;;AAEN,EAAA,IAAMI,gBAAmB,GAAA,SAAnBA,gBAAmB,CAACC,IAAD,EAAA;AAAA,IAAA,IAAA,mBAAA,EAAA,qBAAA,CAAA;;IAAA,OAAUF,CAAAA,mBAAAA,GAAAA,UAAA,CAAWpC,OAArB,MAAA,IAAA,IAAA,mBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,CAAA,qBAAA,GAAU,oBAAoBuC,UAA9B,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAU,qBAAiCD,CAAAA,IAAjC,CAAV,CAAA;GAAzB,CAAA;;EAGA,IAAME,YAAe,GAAAC,aAAA,CACnB,YAAA;IAAA,OACEC,yBAAA,CAAMC,QAAN,CAAeC,OAAf,CAAuBhC,QAAvB,CAAiCiC,CAAAA,MAAjC,CACE,UAACC,KAAD,EAAA;MAAA,OAAwBA,KAAM,CAAAnD,IAAN,CAAWoD,WAAX,KAA2BC,4BAAW,CAAAD,WAA9D,CAAA;AAAA,KADF,CADF,CAAA;AAAA,GADmB,EAKnB,CAACnC,QAAD,CALmB,CAArB,CAAA;AAOA,EAAA,IAAMqC,iBAAiBT,YAAa,CAAAU,MAApC,CAAA;EAGA,IAAMC,iBAAiBX,YAAa,CAAAY,GAAb,CAAiB,UAACN,KAAD,EAAqBO,KAArB,EAAA;AAAA,IAAA,oBACtCX,yBAAA,CAAMY,YAAN,CAAmBR,KAAnB,EAAA,aAAA,CAAA,aAAA,CAAA;AACES,MAAAA,GAAK,EAAAF,KADP;AAEEA,MAAAA,KAAA,EAAAA,KAFF;AAGE3B,MAAAA,YAAA,EAAAA,YAHF;AAIEE,MAAAA,aAAA,EAAAA,aAJF;AAKEqB,MAAAA,cAAA,EAAAA,cALF;AAMEZ,MAAAA,gBAAA,EAAAA,gBAAAA;AANF,KAAA,EAOKxC,KAPL,CAAA,EAQKiD,KAAM,CAAAjD,KARX,CADsC,CAAA,CAAA;AAAA,GAAjB,CAAvB,CAAA;;AAaI,EAAA,IAAAoD,cAAA,GAAiB,CAAjB,IAAsBtD,IAAA,KAAS,SAA/B,EAA0C;AAC5C,IAAA,IAAM6D,WAAWL,cAAe,CAAA,CAAA,CAAhC,CAAA;IACeA,cAAA,CAAAM,IAAA,eACbf,yBAAA,CAAMY,YAAN,CAAmBE,QAAnB,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAAkCA,QAAS,CAAA3D,KAA3C,CAAA,EAAA,EAAA,EAAA;AAAkD0D,MAAAA,GAAK,EAAAN,cAAvD;AAAuEI,MAAAA,KAAO,EAAAJ,cAAAA;KADjE,CAAA,CAAA,CAAA,CAAA;AAGjB,GAAA;;AACA,EAAA,IAAMS,mBAAmBP,cAAe,CAAAD,MAAxC,CAAA;EAGA,IAAMS,QAAW,GAAAC,iBAAA,CACf,UAACP,KAAD,EAAgBQ,OAAhB,EAA4D;AAEjDpD,IAAAA,QAAA,CAAA4C,KAAA,GAAQJ,cAAR,EAAwBY,OAAxB,CAAA,CAAA;IAEThC,gBAAA,CAAiB,IAAjB,CAAA,CAAA;IACAF,eAAA,CAAgB0B,KAAhB,CAAA,CAAA;AACF,GAPe,EAQf,CAACJ,cAAD,EAAiBxC,QAAjB,CARe,CAAjB,CAAA;AAYM,EAAA,IAAAqD,QAAA,GAAWF,kBAAY,YAAM;AAC7B,IAAA,IAAA7D,QAAA,IAAYK,WAAW,CAAvB,EAA0B;AAC5B4B,MAAAA,WAAA,CAAYhC,OAAZ,GAAsB+D,UAAA,CACpB,YAAM;AACJJ,QAAAA,QAAA,CAASjC,YAAe,GAAA,CAAxB,EAA2B;AAAEsC,UAAAA,MAAA,EAAQ,UAAA;AAAV,SAA3B,CAAA,CAAA;AACF,OAHoB,EAIpBtC,YAAiB,KAAA,CAAjB,GAAqBtB,QAAY,IAAAD,QAAA,GAAW,EAAX,CAAjC,GAAkDC,QAJ9B,CAAtB,CAAA;AAMF,KAAA;KACC,CAACL,QAAD,EAAW2B,YAAX,EAAyBvB,QAAzB,EAAmCC,QAAnC,EAA6CuD,QAA7C,EATG,CAAA;AAWA,EAAA,IAAAM,UAAA,GAAaL,kBAAY,YAAM;IACnC,IAAI5B,YAAYhC,OAAhB,EAAyB;AACvBkE,MAAAA,YAAA,CAAalC,YAAYhC,OAAzB,CAAA,CAAA;MACAgC,WAAA,CAAYhC,OAAZ,GAAsB,IAAtB,CAAA;AACF,KAAA;KACC,GALG,CAAA;AAOA,EAAA,IAAAmE,KAAA,GAAQP,kBAAY,YAAM;IAC9B,IAAIjE,SAAS,MAAb,EAAqB;AACZ,MAAA,OAAA,CAACY,IAAD,IAASmB,YAAA,GAAe,CAAf,IAAoBgC,gBAA7B,CAAA;AACT,KAAA;;AACO,IAAA,OAAA,CAACnD,IAAD,IAASmB,YAAA,GAAe,CAAf,IAAoBgC,gBAA7B,CAAA;KACN,CAACnD,IAAD,EAAOmB,YAAP,EAAqBgC,gBAArB,EAAuC/D,IAAvC,EALG,CAAA;AAQNyE,EAAAA,eAAA,CAAU,YAAM;AACd,IAAA,IAAIpE,YAAY,KAAW,CAA3B,EAA2B;AACzB2D,MAAAA,QAAA,CAAS3D,OAAU,GAAAiD,cAAnB,EAAmC;AAAEe,QAAAA,MAAA,EAAQ,UAAA;AAAV,OAAnC,CAAA,CAAA;AACF,KAAA;GAHF,EAIG,CAAChE,OAAD,EAAUiD,cAAV,EAA0BU,QAA1B,CAJH,CAAA,CAAA;AAOAS,EAAAA,eAAA,CAAU,YAAM;IACd,IAAI1C,YAAe,GAAA,CAAf,GAAmBgC,gBAAnB,IAAuC/D,IAAA,KAAS,MAApD,EAA4D;MAC1D,OAAOgC,gBAAgB,EAAvB,CAAA;AACF,KAAA;;IACA,IAAIO,qBAAqBlC,OAAzB,EAAkC;AAChCkE,MAAAA,YAAA,CAAahC,qBAAqBlC,OAAlC,CAAA,CAAA;MACAkC,oBAAA,CAAqBlC,OAArB,GAA+B,IAA/B,CAAA;AACF,KAAA;;AACqBkC,IAAAA,oBAAA,CAAAlC,OAAA,GAAU+D,WAAW,YAAM;MAC9ClC,gBAAA,CAAiB,KAAjB,CAAA,CAAA;;MACA,IAAIsC,OAAJ,EAAa;QACAF,UAAA,EAAA,CAAA;AACb,OAAA;;MACA,IAAIvC,YAAe,GAAA,CAAf,IAAoBgC,gBAApB,IAAwC/D,IAAA,KAAS,MAArD,EAA6D;QAC3DgC,eAAA,CAAgB,CAAhB,CAAA,CAAA;AACF,OAAA;AACF,OAAGxB,WAAW,GARO,CAAA;AASvB,GAjBA,EAiBG,CAACuB,YAAD,EAAegC,gBAAf,EAAiCvD,QAAjC,EAA2CR,IAA3C,EAAiDsE,UAAjD,EAA6DE,KAA7D,CAjBH,CAAA,CAAA;AAmBAC,EAAAA,eAAA,CAAU,YAAM;AACd,IAAA,IAAI,CAACjC,UAAA,CAAWnC,OAAZ,IAAuB,CAACQ,WAA5B,EAAyC;MAC5ByD,UAAA,EAAA,CAAA;MACFH,QAAA,EAAA,CAAA;AACX,KAAA;GAJF,EAKG,CAACA,QAAD,EAAWG,UAAX,EAAuBzD,WAAvB,CALH,CAAA,CAAA;;AAQA,EAAA,IAAM6D,eAAe,SAAfA,YAAe,GAAM;IACzBlC,UAAA,CAAWnC,OAAX,GAAqB,IAArB,CAAA;;AACA,IAAA,IAAIQ,WAAJ,EAAiB;MACJyD,UAAA,EAAA,CAAA;AACb,KAAA;;AACI,IAAA,IAAA5C,gBAAA,CAAiB5B,YAAjB,KAAkC,OAAlC,EAA2C;MAC7CsC,YAAA,CAAa,IAAb,CAAA,CAAA;AACF,KAAA;GAPF,CAAA;;AASA,EAAA,IAAMuC,eAAe,SAAfA,YAAe,GAAM;IACzBnC,UAAA,CAAWnC,OAAX,GAAqB,KAArB,CAAA;;IACI,IAAA,CAACmE,OAAD,EAAU;MACHL,QAAA,EAAA,CAAA;AACX,KAAA;;AACI,IAAA,IAAAzC,gBAAA,CAAiB5B,YAAjB,KAAkC,OAAlC,EAA2C;MAC7CsC,YAAA,CAAa,KAAb,CAAA,CAAA;AACF,KAAA;GAPF,CAAA;;EAUM,IAAAwC,cAAA,GAAiB,SAAjBA,cAAiB,CAACC,MAAD,EAAsBnB,KAAtB,EAAwC;AACzD,IAAA,IAAAmB,MAAA,KAAW,OAAA;AAAqB;OAAAnE,OAAA,KAAY,OAA5C,EAAqD;MACvDsD,QAAA,CAASN,KAAT,EAAgB;AAAEW,QAAAA,MAAQ,EAAA,OAAA;AAAV,OAAhB,CAAA,CAAA;AACF,KAAA;;AACI,IAAA,IAAAQ,MAAA,KAAW,OAAA;AAAqB;OAAAnE,OAAA,KAAY,OAA5C,EAAqD;MACvDsD,QAAA,CAASN,KAAT,EAAgB;AAAEW,QAAAA,MAAQ,EAAA,OAAA;AAAV,OAAhB,CAAA,CAAA;AACF,KAAA;GANI,CAAA;;AASA,EAAA,IAAAS,UAAA,GAAa,SAAbA,UAAa,CAACvE,UAAD,EAAoC;AACrD,IAAA,IAAI0B,aAAJ,EAAmB;AACV,MAAA,OAAA,KAAA,CAAA;AACT,KAAA;;AACA,IAAA,IAAI1B,eAAc,OAAA;AAA2B;MAAA;MAC3C,IAAIP,SAAS,MAAb,EAAqB;AACZ,QAAA,OAAAgE,QAAA,CAASjC,YAAe,GAAA,CAAf,IAAoBgC,gBAApB,GAAuC,CAAvC,GAA2ChC,eAAe,CAAnE,EAAsE;AAAEsC,UAAAA,MAAQ,EAAA,OAAA;AAAV,SAAtE,CAAA,CAAA;AACT,OAAA;;AACA,MAAA,OAAOL,SAASjC,YAAe,GAAA,GAAG;AAAEsC,QAAAA,MAAA,EAAQ,OAAA;AAAV,QAAlC,CAAA;AACF,KAAA;;AACA,IAAA,IAAI9D,eAAc,MAAA;AAA0B;MAAA;AACtC,MAAA,IAAAwB,YAAA,GAAe,CAAf,GAAmB,CAAnB,EAAsB;AACxB,QAAA,OAAOiC,SAASV,cAAiB,GAAA,GAAG;AAAEe,UAAAA,MAAA,EAAQ,OAAA;AAAV,UAApC,CAAA;AACF,OAAA;;AACA,MAAA,OAAOL,SAASjC,YAAe,GAAA,GAAG;AAAEsC,QAAAA,MAAA,EAAQ,OAAA;AAAV,QAAlC,CAAA;AACF,KAAA;GAfI,CAAA;;AAkBA,EAAA,IAAAU,WAAA,GAAc,SAAdA,WAAc,CAAC/E,KAAD,EAAuB;IACzC,IAAI,CAACmC,SAAL,EAAgB;AACP,MAAA,OAAA,EAAA,CAAA;AACT,KAAA;;AACA,IAAA,IAAIT,gBAAiB,CAAA1B,IAAjB,KAA0B,UAA1B,IAAwCA,KAAAA,KAAS,SAAA;AAAqB;MAAA;AACjE,MAAA,OAAA,EAAA,CAAA;AACT,KAAA;;AACA,IAAA,IAAMgF,aAAgB,GAAAjD,YAAA,GAAe,CAAf,GAAmBuB,cAAnB,GAAoC,CAApC,GAAwCvB,YAAe,GAAA,CAA7E,CAAA;AACA,IAAA,sBACGgB,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;MACCjE,SAAA,EAAWkE,8BAAW,CAAG9D,EAAAA,CAAAA,MAAAA,CAAAA,WAAH,kEAChBA,WADgB,EAAA,yBAAA,CAAA,EACuBpB,KAAS,KAAA,SADhC,CAAA,CAAA;AADvB,KAAA,iBAKE+C,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;MAAIjE,qBAAcI,aAAlB,qBAAA,CAAA;AAAoD+D,MAAAA,OAAA,EAAS,SAAA,OAAA,GAAA;AAAA,QAAA,OAAML,UAAA,CAAW,MAAA;AAAwB;SAAzC,CAAA;AAAA,OAAA;AAA7D,KAAA,yDACExD,iBAAgB,KADlB,CALF,EAQEtB,KAAAA,KAAS,UAAA;;AAATA,qBACE+C,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;AAAIjE,MAAAA,qBAAcI;AAAlB,KAAA,EACE4D,aADF,EACgB,GADhB,EACkB1B,cADlB,CADFtD,GAKC,EAbH,iBAeE+C,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;MAAIjE,qBAAcI,aAAlB,sBAAA,CAAA;AAAqD+D,MAAAA,OAAA,EAAS,SAAA,OAAA,GAAA;AAAA,QAAA,OAAML,UAAA,CAAW,OAAA;AAAyB;SAA1C,CAAA;AAAA,OAAA;KAA9D,iBACC/B,yBAAA,CAAAkC,aAAA,CAACzD,gBAAD,EAAkB,IAAlB,CADD,CAfF,CADH,CAAA;GARI,CAAA;;AA+BN,EAAA,IAAM4D,mBAAmB,SAAnBA,gBAAmB,GAAM;AACzB,IAAA,IAAA1D,gBAAA,CAAiB1B,IAAjB,KAA0B,UAA1B,EAAsC;AACxC,MAAA,sBACG+C,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;AAAIjE,QAAAA,SAAW,EAAAkE,8BAAA,CAAc9D,EAAAA,CAAAA,MAAAA,CAAAA,WAAd,oCAAmDA,WAAnD,EAAA,+BAAA,CAAA,CAAA;OAAf,EACE2D,WAAA,CAAY,UAAA;;AAAZ,OADF,CADH,CAAA;AAKF,KAAA;;IACA,OAAOpD,cACL,kBAAAoB,yBAAA,CAAAkC,aAAA,CAAAlC,yBAAA,CAAAsC,QAAA,EAAA,IAAA,EAAG1D,cAAH,CAAA,kBAECoB,yBAAA,CAAAkC,aAAA,CAAA,IAAA,EAAA;MACCjE,SAAA,EAAWkE,8BAAW,CAAA,EAAA,CAAA,MAAA,CAAG9D,WAAH,EAAA,qBAAA,CAAA,EAAAkE,8BAAA,CAAA,EAAA,EAAA,EAAA,CAAA,MAAA,CAChBlE,WADgB,EAAA,0BAAA,CAAA,EACwBM,gBAAA,CAAiB1B,IAAjB,KAA0B,MADlD,CAAA,CAAA;KADvB,EAKE6C,YAAa,CAAAY,GAAb,CAAiB,UAAC8B,CAAD,EAAiBC,CAAjB,EAAA;AAAA,MAAA,sBACfzC,yBAAA,CAAAkC,aAAA,CAAA,IAAA,EAAA;AACCrB,QAAAA,GAAK,EAAA4B,CADN;AAECxE,QAAAA,SAAA,EAAWkE,8BAAW,CAAG9D,EAAAA,CAAAA,MAAAA,CAAAA,WAAH,EAChBA,0BAAAA,CAAAA,EAAAA,8BAAAA,CAAAA,EAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WADgB,EACUoE,YAAAA,CAAAA,EAAAA,CAAA,KAAMzD,YAAe,GAAAuB,cAD/B,CAFvB,CAAA;AAKC6B,QAAAA,OAAS,EAAA,SAAA,OAAA,GAAA;AAAA,UAAA,OAAMP,cAAe,CAAA,OAAA;AAAA;AAAA,YAAmBY,CAAnB,CAArB,CAAA;SALV;AAMCd,QAAAA,YAAc,EAAA,SAAA,YAAA,GAAA;AAAA,UAAA,OAAME,cAAe,CAAA,OAAA;AAAA;AAAA,YAAmBY,CAAnB,CAArB,CAAA;SANf;AAOCb,QAAAA,YAAc,EAAA,SAAA,YAAA,GAAA;AAAA,UAAA,OAAMC,cAAe,CAAA,OAAA;AAAA;AAAA,YAAmBY,CAAnB,CAArB,CAAA;AAAA,SAAA;OAPf,iBASEzC,yBAAA,CAAAkC,aAAA,CAAA,MAAA,EAAA,IAAA,CATF,CADe,CAAA;AAAA,KAAjB,CALF,CAHH,CAAA;GARF,CAAA;;AAkCA,EAAA,IAAMQ,kBAAkB,SAAlBA,eAAkB,GAAM;IAC5B,IAAMC,eAAe/E,MAAS,GAAGA,EAAAA,CAAAA,MAAAA,CAAAA,MAAH,oBAAmB+B,iBAAiB,eAApC,EAA9B,IAAA,CAAA,CAAA;;AACI,IAAA,IAAA1C,IAAA,KAAS,MAAT,IAAmBG,SAAA,KAAc,MAAjC,EAAyC;MACpC,OAAA;AACLQ,QAAAA,MAAQ,EAAA+E,YAAAA;OADH,CAAA;AAGT,KAAA;;IACA,IAAIvF,cAAc,OAAlB,EAA2B;MACzB,IAAII,cAAc,UAAlB,EAA8B;QACrB,OAAA;AACLI,UAAAA,MAAQ,EAAA+E,YADH;AAELC,UAAAA,WAAA,EAAgC5D,kBAAAA,CAAAA,MAAAA,CAAAA,YAAe,GAAA,GAA/C,EAFK,SAAA,CAAA;AAGL6D,UAAAA,eAAA,EAAoC7D,kBAAAA,CAAAA,MAAAA,CAAAA,YAAe,GAAA,GAAnD,EAHK,SAAA,CAAA;AAIL8D,UAAAA,SAAA,EAA8B9D,kBAAAA,CAAAA,MAAAA,CAAAA,YAAe,GAAA,GAA7C,EAJK,SAAA,CAAA;AAKL+D,UAAAA,UAAY,EAAA7D,aAAA,GAAA,YAAA,CAAA,MAAA,CAA6BzB,QAAA,GAAW,GAAxC,EAAuD,QAAA,CAAA,GAAA,EAAA;SAL9D,CAAA;AAOT,OAAA;;MACO,OAAA;AACLmF,QAAAA,WAAA,EAA6B5D,eAAAA,CAAAA,MAAAA,CAAAA,YAAe,GAAA,GAA5C,EADK,cAAA,CAAA;AAEL6D,QAAAA,eAAA,EAAiC7D,eAAAA,CAAAA,MAAAA,CAAAA,YAAe,GAAA,GAAhD,EAFK,cAAA,CAAA;AAGL8D,QAAAA,SAAA,EAA2B9D,eAAAA,CAAAA,MAAAA,CAAAA,YAAe,GAAA,GAA1C,EAHK,cAAA,CAAA;AAIL+D,QAAAA,UAAY,EAAA7D,aAAA,GAAA,YAAA,CAAA,MAAA,CAA6BzB,QAAA,GAAW,GAAxC,EAAuD,QAAA,CAAA,GAAA,EAAA;OAJ9D,CAAA;AAMT,KAAA;GAvBF,CAAA;;AA0BA,EAAA,sBACGuC,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;AACCjE,IAAAA,SAAW,EAAAkE,8BAAA,CAAA,EAAA,CAAA,MAAA,CAAc9D,WAAd,EAAA,SAAA,CAAA,EAAoCJ,SAApC,CADZ;AAEC0D,IAAAA,YAAA,EAAAA,YAFD;AAGCC,IAAAA,YAAA,EAAAA,YAHD;AAICoB,IAAAA,GAAK,EAAAtD,UAAAA;AAJN,GAAA,iBAMEM,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;AACCjE,IAAAA,SAAA,EAAWkE,8BAAW,CAAA,EAAA,CAAA,MAAA,CAAG9D,WAAH,EAChBA,eAAAA,CAAAA,GAAAA,YAAAA,GAAAA,EAAAA,EAAAA,8BAAAA,CAAAA,YAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WADgB,sBACeM,gBAAA,CAAiB7B,SAAjB,KAA+B,QAD9C,CAEhBuB,EAAAA,8BAAAA,CAAAA,YAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WAFgB,uBAEgBM,gBAAA,CAAiB7B,SAAjB,KAA+B,SAF/C,CAGhBuB,EAAAA,8BAAAA,CAAAA,YAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WAHgB,wBAGiBb,SAAc,KAAA,UAH/B,CAIhBa,EAAAA,8BAAAA,CAAAA,YAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WAJgB,qBAIcM,gBAAA,CAAiB3B,IAAjB,KAA0B,OAJxC,0DAKhBqB,WALgB,EAAA,gBAAA,CAAA,EAKcM,gBAAA,CAAiB3B,IAAjB,KAA0B,OALxC,CAAA,EAAA,YAAA,EAAA;AADvB,GAAA,iBASEgD,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;AACCjE,IAAAA,SAAA,EAAWkE,8BAAW,CAAA,EAAA,CAAA,MAAA,CAAG9D,WAAH,EAAA,kBAAA,CAAA,GAAA,YAAA,GAAA,EAAA,EAAAkE,8BAAA,CAAA,YAAA,EAAA,EAAA,CAAA,MAAA,CAChBlE,WADgB,EACYjB,cAAAA,CAAAA,EAAAA,SAAc,KAAA,MAD1B,0DAEhBiB,WAFgB,EAAA,cAAA,CAAA,EAEYpB,IAAS,KAAA,MAFrB,CADvB,EAAA,YAAA,EAAA;AAKCgG,IAAAA,KAAA,EAAO;AAAErF,MAAAA,MAAA,EAAQ,EAAA;AAAV,KAAA;AALR,GAAA,iBAOEoC,yBAAA,CAAAkC,aAAA,CAAA,KAAA,EAAA;IAAIjE,qBAAcI,aAAlB,oBAAA,CAAA;AAAmD4E,IAAAA,OAAOP,eAAgB,EAAA;GAA1E,EACEjC,cADF,CAPF,CATF,EAoBE4B,gBAAA,EApBF,EAqBEL,WAAY,CAAA,SAAA;AAAA;AAAA,GArBd,CANF,CADH,CAAA;AAgCF,EA7TA;;AA+TA9E,MAAA,CAAOoD,UAAP,GAAoBA,4BAApB,CAAA;AAEApD,MAAA,CAAOmD,WAAP,GAAqB,QAArB,CAAA;AACAnD,MAAA,CAAOgG,YAAP,GAAsBC,sCAAtB;;;;"}