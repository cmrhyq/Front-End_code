{"version":3,"file":"THead.js","sources":["../../src/table/THead.tsx"],"sourcesContent":["import React, { useRef, MutableRefObject, CSSProperties } from 'react';\nimport isFunction from 'lodash/isFunction';\nimport classNames from 'classnames';\nimport { getColumnFixedStyles } from './hooks/useFixed';\nimport { RowAndColFixedPosition } from './interface';\nimport { TableColumns, ThRowspanAndColspan } from './hooks/useMultiHeader';\nimport useClassName from './hooks/useClassName';\nimport useConfig from '../hooks/useConfig';\nimport { BaseTableCol, TableRowData } from './type';\nimport { renderTitle } from './hooks/useTableHeader';\nimport TEllipsis from './Ellipsis';\n\nexport interface TheadProps {\n  // 是否固定表头\n  isFixedHeader: boolean;\n  // 固定列 left/right 具体值\n  rowAndColFixedPosition: RowAndColFixedPosition;\n  // 虚拟滚动单独渲染表头；表头吸顶单独渲染表头\n  thWidthList?: { [colKey: string]: number };\n  bordered: boolean;\n  isMultipleHeader: boolean;\n  spansAndLeafNodes: {\n    rowspanAndColspanMap: ThRowspanAndColspan;\n    leafColumns: BaseTableCol<TableRowData>[];\n  };\n  thList: BaseTableCol<TableRowData>[][];\n  resizable?: boolean;\n  columnResizeParams?: {\n    resizeLineRef: MutableRefObject<HTMLDivElement>;\n    resizeLineStyle: CSSProperties;\n    onColumnMouseover: (e: MouseEvent) => void;\n    onColumnMousedown: (e: MouseEvent, col: BaseTableCol<TableRowData>) => void;\n  };\n}\n\nexport default function THead(props: TheadProps) {\n  const { columnResizeParams } = props;\n  const theadRef = useRef<HTMLTableSectionElement>(null);\n  const classnames = useClassName();\n  const { tableHeaderClasses, tableBaseClass } = classnames;\n  const { classPrefix } = useConfig();\n  const theadClasses = [\n    tableHeaderClasses.header,\n    {\n      [tableHeaderClasses.fixed]: props.isFixedHeader,\n      [tableBaseClass.bordered]: props.bordered && props.isMultipleHeader,\n      [tableHeaderClasses.multipleHeader]: props.isMultipleHeader,\n    },\n  ];\n\n  const renderThNodeList = (rowAndColFixedPosition: RowAndColFixedPosition, thWidthList: TheadProps['thWidthList']) => {\n    // thBorderMap: rowspan 会影响 tr > th 是否为第一列表头，从而影响边框\n    const thBorderMap = new Map<any, boolean>();\n    const thRowspanAndColspan = props.spansAndLeafNodes.rowspanAndColspanMap;\n    return props.thList.map((row, rowIndex) => {\n      const thRow = row.map((col: TableColumns[0], index: number) => {\n        const rowspanAndColspan = thRowspanAndColspan.get(col);\n        if (index === 0 && rowspanAndColspan.rowspan > 1) {\n          for (let j = rowIndex + 1; j < rowIndex + rowspanAndColspan.rowspan; j++) {\n            thBorderMap.set(props.thList[j][0], true);\n          }\n        }\n        const thStyles = getColumnFixedStyles(col, index, rowAndColFixedPosition, classnames.tableColFixedClasses);\n        const colParams = {\n          col,\n          colIndex: index,\n          row: {},\n          rowIndex: -1,\n        };\n        const customClasses = isFunction(col.className) ? col.className({ ...colParams, type: 'th' }) : col.className;\n        const thClasses = [\n          thStyles.classes,\n          customClasses,\n          {\n            // 受 rowspan 影响，部分 tr > th:first-child 需要补足左边框\n            [tableHeaderClasses.thBordered]: thBorderMap.get(col),\n            [`${classPrefix}-table__th-${col.colKey}`]: col.colKey,\n            [classnames.tdAlignClasses[col.align]]: col.align && col.align !== 'left',\n          },\n        ];\n        const withoutChildren = !col.children?.length;\n        const width = withoutChildren && thWidthList?.[col.colKey] ? `${thWidthList?.[col.colKey]}px` : undefined;\n        const styles = { ...(thStyles.style || {}), width };\n        const innerTh = renderTitle(col, index);\n        if (!col.colKey) return null;\n        const resizeColumnListener = props.resizable\n          ? {\n              onMouseDown: (e) => columnResizeParams?.onColumnMousedown?.(e, col),\n              onMouseMove: (e) => columnResizeParams?.onColumnMouseover?.(e),\n            }\n          : {};\n        const content = isFunction(col.ellipsisTitle) ? col.ellipsisTitle({ col, colIndex: index }) : undefined;\n        return (\n          <th\n            key={col.colKey}\n            data-colkey={col.colKey}\n            className={classNames(thClasses)}\n            style={styles}\n            {...{ rowSpan: rowspanAndColspan.rowspan, colSpan: rowspanAndColspan.colspan }}\n            {...resizeColumnListener}\n          >\n            <div className={tableBaseClass.thCellInner}>\n              {col.ellipsis && col.ellipsisTitle !== false && col.ellipsisTitle !== null ? (\n                <TEllipsis\n                  placement=\"bottom\"\n                  attach={theadRef.current ? () => theadRef.current.parentNode.parentNode as HTMLElement : undefined}\n                  popupContent={content}\n                  tooltipProps={typeof col.ellipsisTitle === 'object' ? col.ellipsisTitle : undefined}\n                >\n                  {innerTh}\n                </TEllipsis>\n              ) : (\n                innerTh\n              )}\n            </div>\n          </th>\n        );\n      });\n      return <tr key={rowIndex}>{thRow}</tr>;\n    });\n  };\n\n  return (\n    <thead ref={theadRef} className={classNames(theadClasses)}>\n      {renderThNodeList(props.rowAndColFixedPosition, props.thWidthList)}\n    </thead>\n  );\n}\n"],"names":["THead","props","columnResizeParams","theadRef","useRef","classnames","useClassName","tableHeaderClasses","tableBaseClass","useConfig","classPrefix","theadClasses","header","_defineProperty","fixed","isFixedHeader","bordered","isMultipleHeader","multipleHeader","renderThNodeList","rowAndColFixedPosition","thWidthList","thBorderMap","Map","thRowspanAndColspan","spansAndLeafNodes","rowspanAndColspanMap","thList","map","row","rowIndex","thRow","col","index","rowspanAndColspan","get","rowspan","j","set","thStyles","getColumnFixedStyles","tableColFixedClasses","colParams","colIndex","customClasses","isFunction","className","type","thClasses","classes","thBordered","colKey","tdAlignClasses","align","withoutChildren","children","length","width","styles","style","innerTh","renderTitle","resizeColumnListener","resizable","onMouseDown","e","onColumnMousedown","onMouseMove","onColumnMouseover","content","ellipsisTitle","React","createElement","key","classNames","rowSpan","colSpan","colspan","thCellInner","ellipsis","TEllipsis","placement","attach","current","parentNode","popupContent","tooltipProps","_typeof","ref"],"mappings":"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"}