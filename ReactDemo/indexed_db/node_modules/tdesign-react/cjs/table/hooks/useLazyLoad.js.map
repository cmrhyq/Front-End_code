{"version":3,"file":"useLazyLoad.js","sources":["../../../src/table/hooks/useLazyLoad.ts"],"sourcesContent":["// import { ref, onMounted, computed, nextTick, Ref, UnwrapRef } from 'vue';\nimport { useState, useMemo, useEffect } from 'react';\nimport observe from '../../_common/js/utils/observe';\n\nexport type UseLazyLoadParams = {\n  type: 'lazy' | 'virtual';\n  rowIndex: number;\n  rowHeight?: number;\n  bufferSize?: number;\n};\n\nexport default function useLazyLoad(\n  containerRef: HTMLElement,\n  childRef: HTMLTableRowElement,\n  params: UseLazyLoadParams,\n) {\n  // useMemo 用意：1. 为了实时响应数据；2. 表格的计算量容易过大，提前存储\n  const tRowHeight = useMemo(() => Math.max(params.rowHeight || 48, 48), [params.rowHeight]);\n  const [isInit, setIsInit] = useState(params.rowIndex === 0);\n  const hasLazyLoadHolder = useMemo(() => params?.type === 'lazy' && !isInit, [isInit, params?.type]);\n\n  const requestAnimationFrame =\n    (typeof window === 'undefined' ? false : window.requestAnimationFrame) || ((cb) => setTimeout(cb, 16.6));\n\n  const init = () => {\n    if (!isInit) {\n      requestAnimationFrame(() => {\n        setIsInit(true);\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (params?.type !== 'lazy') return;\n    const timer = setTimeout(() => {\n      const bufferSize = Math.max(10, params.bufferSize || 10);\n      const height = tRowHeight * bufferSize;\n      childRef && observe(childRef, containerRef, init, height);\n      clearTimeout(timer);\n    });\n    return () => {\n      clearTimeout(timer);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [childRef, containerRef, params.bufferSize, params?.type, tRowHeight]);\n\n  return {\n    hasLazyLoadHolder,\n    tRowHeight,\n  };\n}\n"],"names":["useLazyLoad","containerRef","childRef","params","tRowHeight","useMemo","Math","max","rowHeight","useState","rowIndex","_slicedToArray","isInit","setIsInit","hasLazyLoadHolder","type","requestAnimationFrame","window","cb","setTimeout","init","useEffect","timer","bufferSize","height","observe","clearTimeout"],"mappings":";;;;;;;;;;;;;;;AAWwB,SAAAA,WAAA,CACtBC,YADsB,EAEtBC,QAFsB,EAGtBC,MAHsB,EAItB;EAEA,IAAMC,UAAa,GAAAC,aAAA,CAAQ,YAAA;IAAA,OAAMC,IAAA,CAAKC,GAAL,CAASJ,MAAA,CAAOK,SAAP,IAAoB,EAA7B,EAAiC,EAAjC,CAAN,CAAA;AAAA,GAAR,EAAoD,CAACL,MAAA,CAAOK,SAAR,CAApD,CAAnB,CAAA;;AACA,EAAA,IAAA,SAAA,GAA4BC,cAAS,CAAAN,MAAA,CAAOO,QAAP,KAAoB,CAApB,CAArC;AAAA,MAAA,UAAA,GAAAC,4BAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,MAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAeC,SAAf,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAAMC,iBAAoB,GAAAT,aAAA,CAAQ,YAAA;AAAA,IAAA,OAAM,CAAAF,MAAA,KAAA,IAAA,IAAAA,MAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,MAAA,CAAQY,IAAR,MAAiB,MAAjB,IAA2B,CAACH,MAAlC,CAAA;AAAA,GAAR,EAAkD,CAACA,MAAD,EAAST,MAAT,KAAA,IAAA,IAASA,MAAT,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAASA,MAAQ,CAAAY,IAAjB,CAAlD,CAA1B,CAAA;;AAEM,EAAA,IAAAC,qBAAA,GAAA,CACH,OAAOC,MAAP,KAAkB,WAAlB,GAAgC,KAAhC,GAAwCA,MAAO,CAAAD,qBAD5C,KACuE,UAACE,EAAD,EAAA;AAAA,IAAA,OAAQC,UAAW,CAAAD,EAAA,EAAI,IAAJ,CAAnB,CAAA;GADvE,CAAA;;AAGN,EAAA,IAAME,OAAO,SAAPA,IAAO,GAAM;IACjB,IAAI,CAACR,MAAL,EAAa;AACXI,MAAAA,qBAAA,CAAsB,YAAM;QAC1BH,SAAA,CAAU,IAAV,CAAA,CAAA;AACD,OAFD,CAAA,CAAA;AAGF,KAAA;GALF,CAAA;;AAQAQ,EAAAA,eAAA,CAAU,YAAM;AACd,IAAA,IAAI,CAAAlB,WAAA,IAAA,IAAAA,iBAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAQY,IAAR,MAAiB,MAArB,EAA6B,OAAA;AACvB,IAAA,IAAAO,KAAA,GAAQH,WAAW,YAAM;AAC7B,MAAA,IAAMI,aAAajB,IAAK,CAAAC,GAAL,CAAS,EAAT,EAAaJ,MAAA,CAAOoB,UAAP,IAAqB,EAAlC,CAAnB,CAAA;AACA,MAAA,IAAMC,SAASpB,UAAa,GAAAmB,UAA5B,CAAA;MACArB,QAAA,IAAYuB,mCAAQ,CAAAvB,QAAA,EAAUD,YAAV,EAAwBmB,IAAxB,EAA8BI,MAA9B,CAApB,CAAA;MACAE,YAAA,CAAaJ,KAAb,CAAA,CAAA;AACD,MALK,CAAA;AAMN,IAAA,OAAO,YAAM;MACXI,YAAA,CAAaJ,KAAb,CAAA,CAAA;KADF,CAAA;GARF,EAYG,CAACpB,QAAD,EAAWD,YAAX,EAAyBE,OAAOoB,UAAhC,EAA4CpB,MAA5C,KAA4CA,IAAAA,IAAAA,MAA5C,uBAA4CA,MAAA,CAAQY,IAApD,EAA0DX,UAA1D,CAZH,CAAA,CAAA;EAcO,OAAA;AACLU,IAAAA,iBAAA,EAAAA,iBADK;AAELV,IAAAA,UAAA,EAAAA,UAAAA;GAFK,CAAA;AAIT;;;;"}