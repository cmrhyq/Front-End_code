/**
 * tdesign v0.41.1
 * (c) 2022 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var slicedToArray = require('../../_chunks/dep-9c5d4f93.js');
var React = require('react');
var _common_js_utils_observe = require('../../_common/js/utils/observe.js');
require('../../_chunks/dep-2205decf.js');

function useLazyLoad(containerRef, childRef, params) {
  var tRowHeight = React.useMemo(function () {
    return Math.max(params.rowHeight || 48, 48);
  }, [params.rowHeight]);

  var _useState = React.useState(params.rowIndex === 0),
      _useState2 = slicedToArray._slicedToArray(_useState, 2),
      isInit = _useState2[0],
      setIsInit = _useState2[1];

  var hasLazyLoadHolder = React.useMemo(function () {
    return (params === null || params === void 0 ? void 0 : params.type) === "lazy" && !isInit;
  }, [isInit, params === null || params === void 0 ? void 0 : params.type]);

  var requestAnimationFrame = (typeof window === "undefined" ? false : window.requestAnimationFrame) || function (cb) {
    return setTimeout(cb, 16.6);
  };

  var init = function init() {
    if (!isInit) {
      requestAnimationFrame(function () {
        setIsInit(true);
      });
    }
  };

  React.useEffect(function () {
    if ((params === null || params === void 0 ? void 0 : params.type) !== "lazy") return;
    var timer = setTimeout(function () {
      var bufferSize = Math.max(10, params.bufferSize || 10);
      var height = tRowHeight * bufferSize;
      childRef && _common_js_utils_observe["default"](childRef, containerRef, init, height);
      clearTimeout(timer);
    });
    return function () {
      clearTimeout(timer);
    };
  }, [childRef, containerRef, params.bufferSize, params === null || params === void 0 ? void 0 : params.type, tRowHeight]);
  return {
    hasLazyLoadHolder: hasLazyLoadHolder,
    tRowHeight: tRowHeight
  };
}

exports["default"] = useLazyLoad;
//# sourceMappingURL=useLazyLoad.js.map
