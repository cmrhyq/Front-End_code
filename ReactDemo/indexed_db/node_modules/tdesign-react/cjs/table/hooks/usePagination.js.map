{"version":3,"file":"usePagination.js","sources":["../../../src/table/hooks/usePagination.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport useConfig from '../../hooks/useConfig';\nimport Pagination, { PageInfo } from '../../pagination';\nimport { TdBaseTableProps, TableRowData } from '../type';\n\n// 分页功能包含：远程数据排序受控、远程数据排序非受控、本地数据排序受控、本地数据排序非受控 等 4 类功能\nexport default function usePagination(props: TdBaseTableProps) {\n  const { pagination, data, disableDataPage } = props;\n  const { classPrefix } = useConfig();\n\n  const [dataSource, setDataSource] = useState<TableRowData[]>([]);\n  const [isPaginateData, setIsPaginateData] = useState(false);\n\n  const updateDataSourceAndPaginate = useCallback(\n    (current = 1, pageSize = 10) => {\n      // data 数据数量超出分页大小时，则自动启动本地数据分页\n      const isPaginateData = Boolean(!disableDataPage && data.length > pageSize);\n      setIsPaginateData(isPaginateData);\n      if (isPaginateData) {\n        const start = (current - 1) * pageSize;\n        const end = current * pageSize;\n        setDataSource([...data.slice(start, end)]);\n      } else {\n        setDataSource(data);\n      }\n    },\n    [data, disableDataPage],\n  );\n\n  // 受控情况，只有 pagination.current 或者 pagination.pageSize 变化，才对数据进行排序\n  useEffect(() => {\n    if (!pagination || !pagination.current) return;\n    updateDataSourceAndPaginate(pagination.current, pagination.pageSize);\n  }, [pagination, updateDataSourceAndPaginate]);\n\n  // 非受控情况\n  useEffect(() => {\n    if (!pagination || !pagination.defaultCurrent) return;\n    updateDataSourceAndPaginate(pagination.defaultCurrent, pagination.defaultPageSize);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [updateDataSourceAndPaginate]);\n\n  const renderPagination = () => {\n    if (!pagination) return null;\n    return (\n      <div className={`${classPrefix}-table__pagination`}>\n        <Pagination\n          {...pagination}\n          onChange={(pageInfo: PageInfo) => {\n            props.pagination?.onChange?.(pageInfo);\n            props.onPageChange?.(pageInfo, dataSource);\n            // 如果是非受控情况的分页变化，还需更新分页数据（data）\n            if (pagination && !pagination.current && pagination.defaultCurrent) {\n              updateDataSourceAndPaginate(pageInfo.current, pageInfo.pageSize);\n            }\n          }}\n        />\n      </div>\n    );\n  };\n\n  return {\n    isPaginateData,\n    dataSource,\n    renderPagination,\n  };\n}\n"],"names":["usePagination","props","pagination","data","disableDataPage","useConfig","classPrefix","useState","_slicedToArray","dataSource","setDataSource","isPaginateData","setIsPaginateData","updateDataSourceAndPaginate","useCallback","current","pageSize","Boolean","length","start","end","_toConsumableArray","slice","useEffect","defaultCurrent","defaultPageSize","renderPagination","React","createElement","className","Pagination","onChange","pageInfo","onPageChange"],"mappings":"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"}