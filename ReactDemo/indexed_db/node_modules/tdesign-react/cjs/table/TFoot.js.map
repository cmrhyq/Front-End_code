{"version":3,"file":"TFoot.js","sources":["../../src/table/TFoot.tsx"],"sourcesContent":["import React, { CSSProperties, useRef } from 'react';\nimport isFunction from 'lodash/isFunction';\nimport classNames from 'classnames';\nimport get from 'lodash/get';\nimport { BaseTableCellParams, RowspanColspan, TableRowData, TdBaseTableProps } from './type';\nimport { formatRowAttributes, formatRowClassNames } from './utils';\nimport { RowAndColFixedPosition } from './interface';\nimport { getColumnFixedStyles } from './hooks/useFixed';\nimport useRowspanAndColspan, { getCellKey } from './hooks/useRowspanAndColspan';\nimport useClassName from './hooks/useClassName';\n\nexport interface TFootProps {\n  rowKey: string;\n  // 是否固定表头\n  isFixedHeader: boolean;\n  // 固定列 left/right 具体值\n  rowAndColFixedPosition: RowAndColFixedPosition;\n  footData: TdBaseTableProps['footData'];\n  columns: TdBaseTableProps['columns'];\n  rowAttributes: TdBaseTableProps['rowAttributes'];\n  rowClassName: TdBaseTableProps['rowClassName'];\n  // 表尾吸底内容宽度\n  thWidthList?: { [colKey: string]: number };\n  footerSummary?: TdBaseTableProps['footerSummary'];\n  rowspanAndColspanInFooter: TdBaseTableProps['rowspanAndColspanInFooter'];\n}\n\nexport default function TFoot(props: TFootProps) {\n  const { footData, columns, rowKey, footerSummary } = props;\n  const tfooterRef = useRef();\n  const classnames = useClassName();\n\n  const { skipSpansMap } = useRowspanAndColspan(footData, columns, rowKey, props.rowspanAndColspanInFooter);\n\n  const renderTFootCell = (p: BaseTableCellParams<TableRowData>) => {\n    const { col, row } = p;\n    if (isFunction(col.foot)) {\n      return col.foot(p);\n    }\n    return col.foot || get(row, col.colKey);\n  };\n\n  const theadClasses = [\n    classnames.tableFooterClasses.footer,\n    { [classnames.tableFooterClasses.fixed]: props.isFixedHeader },\n  ];\n\n  if (!columns) return null;\n\n  const footerDomList = footData?.map((row, rowIndex) => {\n    const trAttributes = formatRowAttributes(props.rowAttributes, { row, rowIndex, type: 'foot' });\n    // 自定义行类名\n    const customClasses = formatRowClassNames(\n      props.rowClassName,\n      { row, rowIndex, type: 'foot' },\n      props.rowKey || 'id',\n    );\n    return (\n      <tr key={rowIndex} {...trAttributes} className={classNames(customClasses)}>\n        {columns.map((col, colIndex) => {\n          // 合并单元格过滤\n          const cellSpans: RowspanColspan = {};\n          let spanState = null;\n          if (skipSpansMap.size) {\n            const cellKey = getCellKey(row, rowKey, col.colKey, colIndex);\n            spanState = skipSpansMap.get(cellKey) || {};\n            spanState?.rowspan > 1 && (cellSpans.rowspan = spanState.rowspan);\n            spanState?.colspan > 1 && (cellSpans.colspan = spanState.colspan);\n            if (spanState.skipped) return null;\n          }\n          const tdStyles = getColumnFixedStyles(\n            col,\n            colIndex,\n            props.rowAndColFixedPosition,\n            classnames.tableColFixedClasses,\n          );\n          const style: CSSProperties = { ...tdStyles.style };\n          if (props.thWidthList?.[col.colKey]) {\n            style.width = `${props.thWidthList[col.colKey] || 0}px`;\n          }\n          return (\n            <td\n              key={col.colKey}\n              rowSpan={cellSpans.rowspan}\n              colSpan={cellSpans.colspan}\n              className={classNames(tdStyles.classes)}\n              style={style}\n            >\n              {renderTFootCell({\n                row,\n                rowIndex,\n                col,\n                colIndex,\n              })}\n            </td>\n          );\n        })}\n      </tr>\n    );\n  });\n\n  // 都不存在，则不需要渲染 footer\n  if (!footerSummary && (!props.footData || !props.footData.length)) return null;\n  return (\n    <tfoot ref={tfooterRef} className={classNames(theadClasses)}>\n      {footerSummary && (\n        <tr className={classnames.tableFullRowClasses.base}>\n          <td colSpan={columns.length}>\n            <div className={classnames.tableFullRowClasses.innerFullElement}>{footerSummary}</div>\n          </td>\n        </tr>\n      )}\n      {footerDomList}\n    </tfoot>\n  );\n}\n"],"names":["TFoot","props","footData","columns","rowKey","footerSummary","tfooterRef","useRef","classnames","useClassName","useRowspanAndColspan","rowspanAndColspanInFooter","skipSpansMap","renderTFootCell","p","col","row","isFunction","foot","get","colKey","theadClasses","tableFooterClasses","footer","_defineProperty","fixed","isFixedHeader","footerDomList","map","rowIndex","trAttributes","formatRowAttributes","rowAttributes","type","customClasses","formatRowClassNames","rowClassName","React","createElement","key","className","classNames","colIndex","cellSpans","spanState","size","cellKey","getCellKey","rowspan","colspan","skipped","tdStyles","getColumnFixedStyles","rowAndColFixedPosition","tableColFixedClasses","style","thWidthList","width","rowSpan","colSpan","classes","length","ref","tableFullRowClasses","base","innerFullElement"],"mappings":"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"}