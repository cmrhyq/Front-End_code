{"version":3,"file":"PrimaryTable.js","sources":["../../src/table/PrimaryTable.tsx"],"sourcesContent":["import React, { useRef, forwardRef, useImperativeHandle } from 'react';\nimport get from 'lodash/get';\nimport classNames from 'classnames';\nimport BaseTable from './BaseTable';\nimport useColumnController from './hooks/useColumnController';\nimport useRowExpand from './hooks/useRowExpand';\nimport useTableHeader, { renderTitle } from './hooks/useTableHeader';\nimport useRowSelect from './hooks/useRowSelect';\nimport { TdPrimaryTableProps, PrimaryTableCol, TableRowData, PrimaryTableCellParams } from './type';\nimport useSorter from './hooks/useSorter';\nimport useFilter from './hooks/useFilter';\nimport useDragSort from './hooks/useDragSort';\nimport useAsyncLoading from './hooks/useAsyncLoading';\nimport { PageInfo } from '../pagination';\nimport useClassName from './hooks/useClassName';\nimport { BaseTableProps, PrimaryTableProps } from './interface';\nimport EditableCell, { EditableCellProps } from './EditableCell';\nimport { StyledProps } from '../common';\nimport { useEditableRow } from './hooks/useEditableRow';\n\nexport { BASE_TABLE_ALL_EVENTS } from './BaseTable';\n\nexport interface TPrimaryTableProps extends PrimaryTableProps, StyledProps {}\n\nconst PrimaryTable = forwardRef((props: TPrimaryTableProps, ref) => {\n  const { columns, columnController, editableRowKeys, style, className } = props;\n  const primaryTableRef = useRef(null);\n  const { tableDraggableClasses, tableBaseClass, tableSelectedClasses } = useClassName();\n  // 自定义列配置功能\n  const { tDisplayColumns, renderColumnController } = useColumnController(props);\n  // 展开/收起行功能\n  const { showExpandedRow, showExpandIconColumn, getExpandColumn, renderExpandedRow, onInnerExpandRowClick } =\n    useRowExpand(props);\n  // 排序功能\n  const { renderSortIcon } = useSorter(props);\n  // 行选中功能\n  const { formatToRowSelectColumn, selectedRowClassNames } = useRowSelect(props, tableSelectedClasses);\n  // 过滤功能\n  const { hasEmptyCondition, isTableOverflowHidden, renderFilterIcon, renderFirstFilterRow } = useFilter(\n    props,\n    primaryTableRef,\n  );\n  // 拖拽排序功能\n  const { isRowHandlerDraggable, isRowDraggable, isColDraggable, setDragSortColumns } = useDragSort(\n    props,\n    primaryTableRef,\n  );\n\n  const { renderTitleWidthIcon } = useTableHeader({ columns: props.columns });\n  const { renderAsyncLoading } = useAsyncLoading(props);\n\n  const primaryTableClasses = {\n    [tableDraggableClasses.colDraggable]: isColDraggable,\n    [tableDraggableClasses.rowHandlerDraggable]: isRowHandlerDraggable,\n    [tableDraggableClasses.rowDraggable]: isRowDraggable,\n    [tableBaseClass.overflowVisible]: isTableOverflowHidden === false,\n    [tableBaseClass.tableRowEdit]: editableRowKeys,\n  };\n\n  const { errorListMap, editableKeysMap, validateRowData, validateTableData, onRuleChange, clearValidateData } =\n    useEditableRow(props);\n\n  // 如果想给 TR 添加类名，请在这里补充，不要透传更多额外 Props 到 BaseTable\n  const tRowClassNames = (() => {\n    const tClassNames = [props.rowClassName, selectedRowClassNames];\n    return tClassNames.filter((v) => v);\n  })();\n\n  // 如果想给 TR 添加属性，请在这里补充，不要透传更多额外 Props 到 BaseTable\n  const tRowAttributes = (() => {\n    const tAttributes = [props.rowAttributes];\n    if (isRowHandlerDraggable || isRowDraggable) {\n      tAttributes.push(({ row }) => ({ 'data-id': get(row, props.rowKey || 'id') }));\n    }\n    return tAttributes.filter((v) => v);\n  })();\n\n  useImperativeHandle(ref, () => ({\n    validateRowData,\n    validateTableData,\n    clearValidateData,\n    ...primaryTableRef.current,\n  }));\n\n  // 1. 影响列数量的因素有：自定义列配置、展开/收起行、多级表头；2. 影响表头内容的因素有：排序图标、筛选图标\n  const getColumns = (columns: PrimaryTableCol<TableRowData>[]) => {\n    const arr: PrimaryTableCol<TableRowData>[] = [];\n    for (let i = 0, len = columns.length; i < len; i++) {\n      let item = { ...columns[i] };\n      // 自定义列显示控制\n      const isDisplayColumn = item.children?.length || tDisplayColumns?.includes(item.colKey);\n      if (!isDisplayColumn && props.columnController && tDisplayColumns) continue;\n      item = formatToRowSelectColumn(item);\n      // 添加排序图标和过滤图标\n      if (item.sorter || item.filter) {\n        const titleContent = renderTitle(item, i);\n        const { ellipsisTitle } = item;\n        item.title = (p) => {\n          const sortIcon = item.sorter ? renderSortIcon(p) : null;\n          const filterIcon = item.filter ? renderFilterIcon(p) : null;\n          const attach = primaryTableRef.current?.tableContentRef;\n          return renderTitleWidthIcon([titleContent, sortIcon, filterIcon], p.col, p.colIndex, ellipsisTitle, attach);\n        };\n        item.ellipsisTitle = false;\n      }\n      // 如果是单元格可编辑状态\n      if (item.edit?.component) {\n        const oldCell = item.cell;\n        item.cell = (p: PrimaryTableCellParams<TableRowData>) => {\n          const cellProps: EditableCellProps = {\n            ...p,\n            oldCell,\n            tableBaseClass,\n            cellEmptyContent: props.cellEmptyContent,\n            onChange: props.onRowEdit,\n            onValidate: props.onRowValidate,\n            onRuleChange,\n          };\n          if (props.editableRowKeys) {\n            const rowValue = get(p.row, props.rowKey || 'id');\n            cellProps.editable = editableKeysMap[rowValue] || false;\n            const key = [rowValue, p.col.colKey].join('__');\n            const errorList = errorListMap[key];\n            errorList && (cellProps.errors = errorList);\n          }\n          if (props.editableCellState) {\n            cellProps.readonly = !props.editableCellState(p);\n          }\n          return <EditableCell {...cellProps} />;\n        };\n      }\n      if (item.children?.length) {\n        item.children = getColumns(item.children);\n      }\n      // 多级表头和自定义列配置特殊逻辑：要么子节点不存在，要么子节点长度大于 1，方便做自定义列配置\n      if (!item.children || item.children?.length) {\n        arr.push(item);\n      }\n    }\n    return arr;\n  };\n\n  const tColumns = (() => {\n    const cols = getColumns(columns);\n    if (showExpandIconColumn) {\n      cols.unshift(getExpandColumn());\n    }\n    return cols;\n  })();\n\n  const onInnerPageChange = (pageInfo: PageInfo, newData: Array<TableRowData>) => {\n    props.onPageChange?.(pageInfo, newData);\n    const changeParams: Parameters<TdPrimaryTableProps['onChange']> = [\n      { pagination: pageInfo },\n      { trigger: 'pagination', currentData: newData },\n    ];\n    props.onChange?.(...changeParams);\n  };\n\n  function formatNode(api: string, renderInnerNode: Function, condition: boolean, extra?: { reverse?: boolean }) {\n    if (!condition) return props[api];\n    const innerNode = renderInnerNode();\n    const propsNode = props[api];\n    if (innerNode && !propsNode) return innerNode;\n    if (propsNode && !innerNode) return propsNode;\n    if (innerNode && propsNode) {\n      return extra?.reverse ? (\n        <div>\n          {innerNode}\n          {propsNode}\n        </div>\n      ) : (\n        <div>\n          {propsNode}\n          {innerNode}\n        </div>\n      );\n    }\n    return null;\n  }\n\n  const isColumnController = !!(columnController && Object.keys(columnController).length);\n  const placement = isColumnController ? columnController.placement || 'top-right' : '';\n  const isBottomController = isColumnController && placement?.indexOf('bottom') !== -1;\n  const topContent = formatNode('topContent', renderColumnController, isColumnController && !isBottomController);\n  const bottomContent = formatNode('bottomContent', renderColumnController, isBottomController, {\n    reverse: true,\n  });\n  const firstFullRow = formatNode('firstFullRow', renderFirstFilterRow, !hasEmptyCondition);\n  const lastFullRow = formatNode('lastFullRow', renderAsyncLoading, !!props.asyncLoading);\n\n  const baseTableProps = {\n    ...props,\n    rowClassName: tRowClassNames,\n    rowAttributes: tRowAttributes,\n    columns: tColumns,\n    topContent,\n    bottomContent,\n    firstFullRow,\n    lastFullRow,\n    onPageChange: onInnerPageChange,\n    renderExpandedRow: showExpandedRow ? renderExpandedRow : undefined,\n  } as BaseTableProps;\n\n  if (props.expandOnRowClick) {\n    baseTableProps.onRowClick = onInnerExpandRowClick;\n  }\n\n  return (\n    <BaseTable\n      ref={primaryTableRef}\n      {...baseTableProps}\n      className={classNames(primaryTableClasses, className)}\n      style={style}\n      onLeafColumnsChange={setDragSortColumns}\n    />\n  );\n});\n\nPrimaryTable.displayName = 'PrimaryTable';\n\nexport default PrimaryTable;\n"],"names":["PrimaryTable","forwardRef","props","ref","columns","columnController","editableRowKeys","style","className","primaryTableRef","useRef","useClassName","tableDraggableClasses","tableBaseClass","tableSelectedClasses","useColumnController","tDisplayColumns","renderColumnController","useRowExpand","showExpandedRow","showExpandIconColumn","getExpandColumn","renderExpandedRow","onInnerExpandRowClick","useSorter","renderSortIcon","useRowSelect","formatToRowSelectColumn","selectedRowClassNames","useFilter","hasEmptyCondition","isTableOverflowHidden","renderFilterIcon","renderFirstFilterRow","useDragSort","isRowHandlerDraggable","isRowDraggable","isColDraggable","setDragSortColumns","useTableHeader","renderTitleWidthIcon","useAsyncLoading","renderAsyncLoading","primaryTableClasses","_defineProperty","colDraggable","rowHandlerDraggable","rowDraggable","overflowVisible","tableRowEdit","useEditableRow","errorListMap","editableKeysMap","validateRowData","validateTableData","onRuleChange","clearValidateData","tRowClassNames","tClassNames","rowClassName","filter","v","tRowAttributes","tAttributes","rowAttributes","push","row","get","rowKey","useImperativeHandle","current","getColumns","arr","i","len","item","isDisplayColumn","children","length","includes","colKey","sorter","titleContent","renderTitle","ellipsisTitle","title","p","sortIcon","filterIcon","attach","tableContentRef","col","colIndex","edit","component","oldCell","cell","cellProps","cellEmptyContent","onChange","onRowEdit","onValidate","onRowValidate","rowValue","editable","key","join","errorList","errors","editableCellState","readonly","React","createElement","EditableCell","tColumns","cols","unshift","onInnerPageChange","pageInfo","newData","onPageChange","changeParams","pagination","trigger","currentData","formatNode","api","renderInnerNode","condition","extra","innerNode","propsNode","reverse","isColumnController","Object","keys","placement","isBottomController","indexOf","topContent","bottomContent","firstFullRow","lastFullRow","asyncLoading","baseTableProps","expandOnRowClick","onRowClick","BaseTable","classNames","onLeafColumnsChange","displayName"],"mappings":"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"}