{"version":3,"file":"inputs.js","sources":["../../../../../src/color-picker/components/panel/format/inputs.tsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport { throttle } from 'lodash';\nimport Color from '../../../../_common/js/color-picker/color';\nimport Input from '../../../../input';\nimport InputNumber from '../../../../input-number';\nimport { FORMAT_INPUT_CONFIG } from './config';\n\nconst FormatInputs = (props) => {\n  const { format, enableAlpha, inputProps, disabled, onInputChange, color } = props;\n  const formatValue = useRef<any>({});\n  const lastModelValue = useRef({});\n\n  const object2color = (f: string) => Color.object2color(formatValue.current, f);\n\n  // 获取不同格式的输入输出值\n  const getFormatColorMap = (type: 'encode' | 'decode') => {\n    if (type === 'encode') {\n      return {\n        HSV: color.getHsva(),\n        HSL: color.getHsla(),\n        RGB: color.getRgba(),\n        CMYK: color.getCmyk(),\n        CSS: {\n          css: color.css,\n        },\n        HEX: {\n          hex: color.hex,\n        },\n      };\n    }\n    // decode\n    return {\n      HSV: object2color('HSV'),\n      HSL: object2color('HSL'),\n      RGB: object2color('RGB'),\n      CMYK: object2color('CMYK'),\n      CSS: formatValue.current.css,\n      HEX: formatValue.current.hex,\n    };\n  };\n\n  // 更新 modelValue\n  const updateModelValue = () => {\n    const values: any = getFormatColorMap('encode')[format];\n    values.a = Math.round(color.alpha * 100);\n    Object.keys(values).forEach((key) => {\n      formatValue.current[key] = values[key];\n      lastModelValue.current[key] = values[key];\n    });\n  };\n\n  updateModelValue();\n\n  const throttleUpdate = throttle(updateModelValue, 100);\n\n  const inputConfigs = () => {\n    const configs = [...FORMAT_INPUT_CONFIG[format]];\n    if (enableAlpha) {\n      configs.push({\n        type: 'inputNumber',\n        key: 'a',\n        min: 0,\n        max: 100,\n        format: (value: number) => `${value}%`,\n        flex: 1.15,\n      });\n    }\n    return configs;\n  };\n\n  const handleInputChange = (key: string, v: number | string) => {\n    if (v === lastModelValue[key]) {\n      return;\n    }\n    formatValue.current[key] = v;\n    lastModelValue.current[key] = v;\n    const value = getFormatColorMap('decode')[format];\n    onInputChange(value, formatValue.current.a / 100, key, v);\n  };\n\n  useEffect(() => {\n    throttleUpdate();\n  }, [color.saturation, color.hue, color.value, color.alpha, format, throttleUpdate]);\n\n  return (\n    <div className=\"input-group\">\n      {inputConfigs().map((config) => {\n        const commonProps = {\n          ...inputProps,\n          title: formatValue.current[config.key],\n          value: formatValue.current[config.key],\n          align: 'center',\n          disabled,\n          size: 'small',\n          onBlur: (v: string) => handleInputChange(config.key, v),\n          onEnter: (v: string) => handleInputChange(config.key, v),\n        };\n        return (\n          <div\n            className=\"input-group__item\"\n            key={config.key}\n            style={{\n              flex: config.flex || 1,\n            }}\n          >\n            {config.type === 'input' ? (\n              <Input {...commonProps} maxlength={format === 'HEX' ? 9 : undefined} />\n            ) : (\n              <InputNumber\n                {...commonProps}\n                min={config.min}\n                max={config.max}\n                step={1}\n                format={config.format}\n                theme=\"normal\"\n              />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default React.memo(FormatInputs);\n"],"names":["FormatInputs","props","format","enableAlpha","inputProps","disabled","onInputChange","color","formatValue","useRef","lastModelValue","object2color","f","Color","current","getFormatColorMap","type","HSV","getHsva","HSL","getHsla","RGB","getRgba","CMYK","getCmyk","CSS","css","HEX","hex","updateModelValue","values","a","Math","round","alpha","Object","keys","forEach","key","throttleUpdate","throttle","inputConfigs","configs","FORMAT_INPUT_CONFIG","push","min","max","value","flex","handleInputChange","v","useEffect","saturation","hue","React","createElement","className","map","config","commonProps","title","align","size","onBlur","onEnter","style","Input","maxlength","InputNumber","step","theme","memo"],"mappings":"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"}