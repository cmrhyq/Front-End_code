{"version":3,"file":"ImageViewer.js","sources":["../../src/image-viewer/ImageViewer.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport isFunction from 'lodash/isFunction';\nimport { TdImageViewerProps } from './type';\nimport { ImageModal } from './ImageViewerModel';\nimport { StyledProps, TNode } from '../common';\nimport { imageViewerDefaultProps } from './defaultProps';\nimport useImageScale from './hooks/useImageScale';\nimport useList from './hooks/useList';\nimport useViewerScale from './hooks/useViewerScale';\nimport useControlled from '../hooks/useControlled';\n\nexport interface ImageViewerProps extends TdImageViewerProps, StyledProps {}\n\nconst ImageViewer = (props: ImageViewerProps) => {\n  const { mode, trigger, images, title, imageScale: imageScaleD, viewerScale: viewerScaleD } = props;\n\n  const [visible, setVisible] = useControlled(props, 'visible', (visible, context) => {\n    isFunction(props.onClose) && props.onClose(context);\n  });\n\n  const [visibled, setVisibled] = useState(false);\n  const list = useList(images);\n  const imageScale = useImageScale(imageScaleD);\n  const viewerScale = useViewerScale(viewerScaleD);\n\n  const isMini = mode === 'modeless';\n\n  const close = (context) => {\n    setVisible(false, context);\n    setTimeout(() => setVisibled(false), 196);\n  };\n\n  const open = () => {\n    if (!images) return;\n    setVisible(true, null);\n    setVisibled(true);\n  };\n  // todo 兼容旧api，新： open close 旧： onOpen, onClose\n  const uiImage: TNode = isFunction(trigger) ? trigger({ open, close, onOpen: open, onClose: close }) : trigger;\n\n  return (\n    <>\n      {uiImage}\n      {visibled &&\n        createPortal(\n          <ImageModal\n            title={title}\n            visible={visible}\n            images={list}\n            isMini={isMini}\n            imageScale={imageScale}\n            viewerScale={viewerScale}\n            zIndex={props.zIndex}\n            defaultIndex={props.defaultIndex}\n            index={props.index}\n            onIndexChange={props.onIndexChange}\n            draggable={props.draggable}\n            closeOnOverlay={props.closeOnOverlay}\n            closeBtn={props.closeBtn}\n            showOverlay={props.showOverlay}\n            onClose={close}\n            onOpen={open}\n          />,\n          document.body,\n        )}\n    </>\n  );\n};\n\nImageViewer.displayName = 'ImageViewer';\n\nImageViewer.defaultProps = imageViewerDefaultProps;\n\nexport default ImageViewer;\n"],"names":["ImageViewer","props","mode","trigger","images","title","imageScaleD","imageScale","viewerScaleD","viewerScale","useControlled","visible","context","isFunction","onClose","_slicedToArray","setVisible","useState","visibled","setVisibled","list","useList","useImageScale","useViewerScale","isMini","close","setTimeout","open","uiImage","onOpen","React","createElement","Fragment","createPortal","ImageModal","zIndex","defaultIndex","index","onIndexChange","draggable","closeOnOverlay","closeBtn","showOverlay","document","body","displayName","defaultProps","imageViewerDefaultProps"],"mappings":"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"}