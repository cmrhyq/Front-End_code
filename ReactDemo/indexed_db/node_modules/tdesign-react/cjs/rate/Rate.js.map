{"version":3,"file":"Rate.js","sources":["../../src/rate/Rate.tsx"],"sourcesContent":["import React, { MouseEvent, useState, forwardRef } from 'react';\nimport classNames from 'classnames';\nimport { StarFilledIcon as TdStarFilledIcon } from 'tdesign-icons-react';\nimport Tooltip from '../tooltip';\nimport { TdRateProps } from './type';\nimport { StyledProps } from '../common';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport useControlled from '../hooks/useControlled';\nimport { rateDefaultProps } from './defaultProps';\n\nexport interface RateProps extends TdRateProps, StyledProps {}\n\nconst Rate = forwardRef((props: RateProps, ref: React.Ref<HTMLDivElement>) => {\n  const { allowHalf, color, count, disabled, gap, showText, size, texts, icon, className, style, onChange } = props;\n\n  const { classPrefix } = useConfig();\n  const { StarFilledIcon } = useGlobalIcon({ StarFilledIcon: TdStarFilledIcon });\n  const [starValue = 0, setStarValue] = useControlled(props, 'value', onChange);\n\n  const [hoverValue = undefined, setHoverValue] = useState<number | undefined>(undefined);\n  const displayValue = hoverValue || starValue;\n  const rootRef = React.useRef(null);\n\n  const activeColor = Array.isArray(color) ? color[0] : color;\n  const defaultColor = Array.isArray(color) ? color[1] : 'var(--td-bg-color-component)';\n\n  // 评分图标\n  const RateIcon = (props: any) => {\n    if (React.isValidElement(icon)) {\n      return React.cloneElement(icon, props);\n    }\n    return <StarFilledIcon {...props} />;\n  };\n\n  const getStarValue = (event: MouseEvent<HTMLElement>, index: number) => {\n    if (allowHalf) {\n      const rootNode = rootRef.current;\n      const { left } = rootNode.getBoundingClientRect();\n      const firstStar = rootNode.firstChild as HTMLElement;\n      const { width } = firstStar.getBoundingClientRect();\n      const { clientX } = event;\n      const starMiddle = width * (index - 0.5) + gap * (index - 1);\n      if (clientX - left >= starMiddle) return index;\n      if (clientX - left < starMiddle) return index - 0.5;\n    }\n\n    return index;\n  };\n\n  const mouseEnterHandler = (event: MouseEvent<HTMLElement>, index: number) => {\n    if (disabled) return;\n    setHoverValue(getStarValue(event, index));\n  };\n\n  const mouseLeaveHandler = () => {\n    if (disabled) return;\n    setHoverValue(undefined);\n  };\n\n  const clickHandler = (event: MouseEvent<HTMLElement>, index: number) => {\n    if (disabled) return;\n    setStarValue(getStarValue(event, index));\n  };\n\n  const getStarCls = (index: number) => {\n    if (allowHalf && index + 0.5 === displayValue) return `${classPrefix}-rate__item--half`;\n    if (index >= displayValue) return '';\n    if (index < displayValue) return `${classPrefix}-rate__item--full`;\n  };\n\n  return (\n    <div\n      ref={ref}\n      style={style}\n      className={classNames(`${classPrefix}-rate`, className)}\n      onMouseLeave={mouseLeaveHandler}\n    >\n      <ul className={`${classPrefix}-rate__list`} style={{ gap }} ref={rootRef}>\n        {[...Array(count)].map((_, index) => (\n          <li\n            key={index}\n            className={classNames(`${classPrefix}-rate__item`, getStarCls(index))}\n            onClick={(event) => clickHandler(event, index + 1)}\n            onMouseMove={(event) => mouseEnterHandler(event, index + 1)}\n          >\n            {showText ? (\n              <Tooltip key={index} content={texts[displayValue - 1]}>\n                <div className={`${classPrefix}-rate__star-top`}>\n                  <RateIcon size={size} color={activeColor} />\n                </div>\n                <div className={`${classPrefix}-rate__star-bottom`}>\n                  <RateIcon size={size} color={defaultColor} />\n                </div>\n              </Tooltip>\n            ) : (\n              <>\n                <div className={`${classPrefix}-rate__star-top`}>\n                  <RateIcon size={size} color={activeColor} />\n                </div>\n                <div className={`${classPrefix}-rate__star-bottom`}>\n                  <RateIcon size={size} color={defaultColor} />\n                </div>\n              </>\n            )}\n          </li>\n        ))}\n      </ul>\n      {showText && <div className={`${classPrefix}-rate__text`}>{texts[displayValue - 1]}</div>}\n    </div>\n  );\n});\n\nRate.displayName = 'Rate';\nRate.defaultProps = rateDefaultProps;\n\nexport default Rate;\n"],"names":["Rate","forwardRef","props","ref","allowHalf","color","count","disabled","gap","showText","size","texts","icon","className","style","onChange","useConfig","classPrefix","useGlobalIcon","StarFilledIcon","TdStarFilledIcon","useControlled","_slicedToArray","starValue","setStarValue","useState","hoverValue","setHoverValue","displayValue","rootRef","React","useRef","activeColor","Array","isArray","defaultColor","RateIcon","isValidElement","cloneElement","createElement","getStarValue","event","index","rootNode","current","getBoundingClientRect","left","firstStar","firstChild","width","clientX","starMiddle","mouseEnterHandler","mouseLeaveHandler","clickHandler","getStarCls","classNames","onMouseLeave","_toConsumableArray","map","_","key","onClick","onMouseMove","Tooltip","content","Fragment","displayName","defaultProps","rateDefaultProps"],"mappings":"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"}