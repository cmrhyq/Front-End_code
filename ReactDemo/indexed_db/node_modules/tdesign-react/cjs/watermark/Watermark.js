/**
 * tdesign v0.41.1
 * (c) 2022 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var defineProperty = require('../_chunks/dep-4eb93341.js');
var slicedToArray = require('../_chunks/dep-9c5d4f93.js');
var React = require('react');
var _common_js_watermark_generateBase64Url = require('../_common/js/watermark/generateBase64Url.js');
var _common_js_watermark_randomMovingStyle = require('../_common/js/watermark/randomMovingStyle.js');
var _common_js_utils_injectStyle = require('../_common/js/utils/injectStyle.js');
var hooks_useConfig = require('../hooks/useConfig.js');
var _util_useMutationObserver = require('../_util/useMutationObserver.js');
var watermark_defaultProps = require('./defaultProps.js');
require('../_chunks/dep-2205decf.js');
require('../_chunks/dep-4344eec8.js');
require('../_chunks/dep-fe984d70.js');
require('../_chunks/dep-46cf36fd.js');
require('../_chunks/dep-f5e18a2f.js');
require('../_chunks/dep-53ba6729.js');
require('../_chunks/dep-61a8a7b0.js');
require('../_chunks/dep-2a90f794.js');
require('../_chunks/dep-aab723b3.js');
require('../_chunks/dep-384b291c.js');
require('../_chunks/dep-a0b5d8f6.js');
require('../_chunks/dep-12656997.js');
require('../_chunks/dep-1fff9729.js');
require('../_chunks/dep-bb60493d.js');
require('../_chunks/dep-72020528.js');
require('../_chunks/dep-ad854ba5.js');
require('../_chunks/dep-eebdbd74.js');
require('../_chunks/dep-8f18a7c4.js');
require('../_chunks/dep-9cd0fde8.js');
require('../_chunks/dep-d3ad6e52.js');
require('../_chunks/dep-aafeb50a.js');
require('../_chunks/dep-6fa7a9e9.js');
require('../_chunks/dep-994ec160.js');
require('../_chunks/dep-9429a38a.js');
require('../_common/js/global-config/locale/zh_CN.js');
require('../_common/js/global-config/default-config.js');
require('../_chunks/dep-db2b3323.js');
require('../_chunks/dep-52c5813c.js');
require('../_chunks/dep-09805e35.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefaultLegacy(React);

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { defineProperty._defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

var Watermark = function Watermark(_ref) {
  var _ref$alpha = _ref.alpha,
      alpha = _ref$alpha === void 0 ? watermark_defaultProps.watermarkDefaultProps.alpha : _ref$alpha,
      _ref$x = _ref.x,
      x = _ref$x === void 0 ? 200 : _ref$x,
      _ref$y = _ref.y,
      y = _ref$y === void 0 ? 210 : _ref$y,
      _ref$width = _ref.width,
      width = _ref$width === void 0 ? 120 : _ref$width,
      _ref$height = _ref.height,
      height = _ref$height === void 0 ? 60 : _ref$height,
      _ref$rotate = _ref.rotate,
      tempRotate = _ref$rotate === void 0 ? watermark_defaultProps.watermarkDefaultProps.rotate : _ref$rotate,
      _ref$zIndex = _ref.zIndex,
      zIndex = _ref$zIndex === void 0 ? 10 : _ref$zIndex,
      _ref$lineSpace = _ref.lineSpace,
      lineSpace = _ref$lineSpace === void 0 ? watermark_defaultProps.watermarkDefaultProps.lineSpace : _ref$lineSpace,
      _ref$isRepeat = _ref.isRepeat,
      isRepeat = _ref$isRepeat === void 0 ? watermark_defaultProps.watermarkDefaultProps.isRepeat : _ref$isRepeat,
      _ref$removable = _ref.removable,
      removable = _ref$removable === void 0 ? watermark_defaultProps.watermarkDefaultProps.removable : _ref$removable,
      _ref$movable = _ref.movable,
      movable = _ref$movable === void 0 ? watermark_defaultProps.watermarkDefaultProps.movable : _ref$movable,
      _ref$moveInterval = _ref.moveInterval,
      moveInterval = _ref$moveInterval === void 0 ? watermark_defaultProps.watermarkDefaultProps.moveInterval : _ref$moveInterval,
      _ref$offset = _ref.offset,
      offset = _ref$offset === void 0 ? [] : _ref$offset,
      content = _ref.content,
      children = _ref.children,
      watermarkContent = _ref.watermarkContent,
      className = _ref.className,
      _ref$style = _ref.style,
      style = _ref$style === void 0 ? {} : _ref$style;

  var _useConfig = hooks_useConfig["default"](),
      classPrefix = _useConfig.classPrefix;

  var gapX = x;
  var gapY = y;
  var rotate = tempRotate;

  if (movable) {
    gapX = 0;
    gapY = 0;
    rotate = 0;
  }

  var clsName = "".concat(classPrefix, "-watermark");

  var _useState = React.useState(""),
      _useState2 = slicedToArray._slicedToArray(_useState, 2),
      base64Url = _useState2[0],
      setBase64Url = _useState2[1];

  var watermarkRef = React.useRef();
  var offsetLeft = offset[0] || gapX / 2;
  var offsetTop = offset[1] || gapY / 2;
  React.useEffect(function () {
    _common_js_watermark_generateBase64Url["default"]({
      width: width,
      height: height,
      rotate: rotate,
      lineSpace: lineSpace,
      alpha: alpha,
      gapX: gapX,
      gapY: gapY,
      watermarkContent: watermarkContent,
      offsetLeft: offsetLeft,
      offsetTop: offsetTop
    }, function (url) {
      setBase64Url(url);
    });
  }, [width, height, rotate, zIndex, lineSpace, alpha, offsetLeft, offsetTop, gapX, gapY, watermarkContent]);
  _util_useMutationObserver["default"](watermarkRef.current, function (mutations) {
    if (removable) return;
    mutations.forEach(function (mutation) {
      if (mutation.type === "childList") {
        var removeNodes = mutation.removedNodes;
        removeNodes.forEach(function (node) {
          watermarkRef.current.appendChild(node);
        });
      }
    });
  });
  var parent = React.useRef();
  React.useEffect(function () {
    parent.current = watermarkRef.current.parentElement;
    var keyframesStyle = _common_js_watermark_randomMovingStyle["default"]();
    _common_js_utils_injectStyle["default"](keyframesStyle);
  }, []);
  _util_useMutationObserver["default"](document.body, function (mutations) {
    if (removable) return;
    mutations.forEach(function (mutation) {
      if (mutation.type === "childList") {
        var removeNodes = mutation.removedNodes;
        removeNodes.forEach(function (node) {
          var element = node;

          if (element === watermarkRef.current) {
            parent.current.appendChild(element);
          }
        });
      }
    });
  });
  return /* @__PURE__ */React__default["default"].createElement("div", {
    style: {
      position: "relative",
      overflow: "hidden"
    },
    className: clsName,
    ref: watermarkRef
  }, children || content, /* @__PURE__ */React__default["default"].createElement("div", {
    className: className,
    style: _objectSpread({
      zIndex: zIndex,
      position: "absolute",
      left: 0,
      right: 0,
      top: 0,
      bottom: 0,
      width: "100%",
      height: "100%",
      backgroundSize: "".concat(gapX + width, "px"),
      pointerEvents: "none",
      backgroundRepeat: movable ? "no-repeat" : isRepeat ? "repeat" : "no-repeat",
      backgroundImage: "url('".concat(base64Url, "')"),
      animation: movable ? "watermark infinite ".concat(moveInterval * 4 / 60, "s") : "none"
    }, style)
  }));
};

exports["default"] = Watermark;
//# sourceMappingURL=Watermark.js.map
