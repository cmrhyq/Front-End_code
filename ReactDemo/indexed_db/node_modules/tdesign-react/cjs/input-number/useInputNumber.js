/**
 * tdesign v0.41.1
 * (c) 2022 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var defineProperty = require('../_chunks/dep-4eb93341.js');
var slicedToArray = require('../_chunks/dep-9c5d4f93.js');
var React = require('react');
var classNames = require('classnames');
var hooks_useConfig = require('../hooks/useConfig.js');
var hooks_useControlled = require('../hooks/useControlled.js');
var _util_useCommonClassName = require('../_util/useCommonClassName.js');
var _common_js_inputNumber_number = require('../_common/js/input-number/number.js');
require('../_chunks/dep-2205decf.js');
require('../_chunks/dep-4344eec8.js');
require('../_chunks/dep-fe984d70.js');
require('../_chunks/dep-46cf36fd.js');
require('../_chunks/dep-f5e18a2f.js');
require('../_chunks/dep-53ba6729.js');
require('../_chunks/dep-61a8a7b0.js');
require('../_chunks/dep-2a90f794.js');
require('../_chunks/dep-aab723b3.js');
require('../_chunks/dep-384b291c.js');
require('../_chunks/dep-a0b5d8f6.js');
require('../_chunks/dep-12656997.js');
require('../_chunks/dep-1fff9729.js');
require('../_chunks/dep-bb60493d.js');
require('../_chunks/dep-72020528.js');
require('../_chunks/dep-ad854ba5.js');
require('../_chunks/dep-eebdbd74.js');
require('../_chunks/dep-8f18a7c4.js');
require('../_chunks/dep-9cd0fde8.js');
require('../_chunks/dep-d3ad6e52.js');
require('../_chunks/dep-aafeb50a.js');
require('../_chunks/dep-6fa7a9e9.js');
require('../_chunks/dep-994ec160.js');
require('../_chunks/dep-9429a38a.js');
require('../_common/js/global-config/locale/zh_CN.js');
require('../_common/js/global-config/default-config.js');
require('../_chunks/dep-c76c2a08.js');
require('../_chunks/dep-dc6c808e.js');
require('../_chunks/dep-76deafcc.js');
require('../_chunks/dep-afce8659.js');
require('../_chunks/dep-09805e35.js');
require('../_util/noop.js');
require('../_chunks/dep-9a2dbbb1.js');
require('../_chunks/dep-364d4c00.js');
require('../_common/js/input-number/large-number.js');
require('../_common/js/log/log.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var classNames__default = /*#__PURE__*/_interopDefaultLegacy(classNames);

function useInputNumber(props) {
  var _classNames;

  var _useCommonClassName = _util_useCommonClassName["default"](),
      SIZE = _useCommonClassName.SIZE,
      STATUS = _useCommonClassName.STATUS;

  var _useConfig = hooks_useConfig["default"](),
      classPrefix = _useConfig.classPrefix;

  var _useControlled = hooks_useControlled["default"](props, "value", props.onChange),
      _useControlled2 = slicedToArray._slicedToArray(_useControlled, 2),
      value = _useControlled2[0],
      onChange = _useControlled2[1];

  var _useState = React.useState(""),
      _useState2 = slicedToArray._slicedToArray(_useState, 2),
      userInput = _useState2[0],
      setUserInput = _useState2[1];

  var _useState3 = React.useState(""),
      _useState4 = slicedToArray._slicedToArray(_useState3, 2),
      displayValue = _useState4[0],
      setDisplayValue = _useState4[1];

  var _useState5 = React.useState(),
      _useState6 = slicedToArray._slicedToArray(_useState5, 2),
      isError = _useState6[0],
      setIsError = _useState6[1];

  var inputRef = React.useRef(null);
  var max = props.max,
      min = props.min,
      largeNumber = props.largeNumber,
      onValidate = props.onValidate;
  var disabledReduce = props.disabled || !_common_js_inputNumber_number.canReduceNumber(value, props.min, props.largeNumber);
  var disabledAdd = props.disabled || !_common_js_inputNumber_number.canAddNumber(value, props.max, props.largeNumber);
  var wrapClasses = classNames__default["default"]("".concat(classPrefix, "-input-number"), SIZE[props.size], (_classNames = {}, defineProperty._defineProperty(_classNames, STATUS.disabled, props.disabled), defineProperty._defineProperty(_classNames, "".concat(classPrefix, "-is-controls-right"), props.theme === "column"), defineProperty._defineProperty(_classNames, "".concat(classPrefix, "-input-number--").concat(props.theme), props.theme), defineProperty._defineProperty(_classNames, "".concat(classPrefix, "-input-number--auto-width"), props.autoWidth), _classNames));
  var reduceClasses = classNames__default["default"]("".concat(classPrefix, "-input-number__decrease"), defineProperty._defineProperty({}, STATUS.disabled, disabledReduce));
  var addClasses = classNames__default["default"]("".concat(classPrefix, "-input-number__increase"), defineProperty._defineProperty({}, STATUS.disabled, disabledAdd));

  var getUserInput = function getUserInput(value2) {
    var _inputRef$current$cur, _inputRef$current$cur2;

    if (!value2 && value2 !== 0) return "";
    var inputStr = String(value2);

    if (!((_inputRef$current$cur = (_inputRef$current$cur2 = inputRef.current.currentElement).contains) !== null && _inputRef$current$cur !== void 0 && _inputRef$current$cur.call(_inputRef$current$cur2, document.activeElement))) {
      inputStr = String(_common_js_inputNumber_number.formatToNumber(inputStr, {
        decimalPlaces: props.decimalPlaces,
        largeNumber: props.largeNumber
      }));

      if (props.format) {
        inputStr = String(props.format(value2, {
          fixedNumber: inputStr
        }));
      }
    }

    return inputStr;
  };

  React.useEffect(function () {
    var inputValue = [void 0, null].includes(value) ? "" : String(value);
    setUserInput(getUserInput(inputValue));
  }, [value]);
  React.useEffect(function () {
    if ([void 0, "", null].includes(value)) return;
    var error = _common_js_inputNumber_number.getMaxOrMinValidateResult({
      value: value,
      max: max,
      min: min,
      largeNumber: largeNumber
    });
    setIsError(error);
    onValidate === null || onValidate === void 0 ? void 0 : onValidate({
      error: error
    });
  }, [value, max, min, largeNumber, onValidate]);

  var handleStepValue = function handleStepValue(op) {
    return _common_js_inputNumber_number.getStepValue({
      op: op,
      step: props.step,
      max: props.max,
      min: props.min,
      lastValue: value,
      largeNumber: props.largeNumber
    });
  };

  var handleReduce = function handleReduce(e) {
    if (disabledReduce || props.readonly) return;
    var newValue = handleStepValue("reduce");
    onChange(newValue, {
      type: "reduce",
      e: e
    });
  };

  var handleAdd = function handleAdd(e) {
    if (disabledAdd || props.readonly) return;
    var newValue = handleStepValue("add");
    onChange(newValue, {
      type: "add",
      e: e
    });
  };

  var onInnerInputChange = function onInnerInputChange(val, ctx) {
    if (!_common_js_inputNumber_number.canInputNumber(val, props.largeNumber)) return;
    setUserInput(val);
    var isDelete = ctx.e.inputType === "deleteContentBackward";
    var newVal = isDelete || props.largeNumber || !val ? val : Number(val);

    if (newVal !== value && !["-", ".", "e", "E"].includes(val.slice(-1))) {
      onChange(newVal, {
        type: "input",
        e: ctx.e
      });
    }
  };

  var handleBlur = function handleBlur(value2, ctx) {
    var _props$onBlur;

    setUserInput(getUserInput(value2));
    var newValue = _common_js_inputNumber_number.formatToNumber(value2, {
      decimalPlaces: props.decimalPlaces,
      largeNumber: props.largeNumber
    });

    if (newValue !== value2 && String(newValue) !== value2) {
      onChange(newValue, {
        type: "blur",
        e: ctx.e
      });
    }

    (_props$onBlur = props.onBlur) === null || _props$onBlur === void 0 ? void 0 : _props$onBlur.call(props, newValue, ctx);
  };

  var handleFocus = function handleFocus(_, ctx) {
    var _props$onFocus;

    setUserInput(value);
    (_props$onFocus = props.onFocus) === null || _props$onFocus === void 0 ? void 0 : _props$onFocus.call(props, value, ctx);
  };

  var handleKeydown = function handleKeydown(value2, ctx) {
    var _props$onKeydown;

    var e = ctx.e;
    var keyEvent = {
      ArrowUp: handleAdd,
      ArrowDown: handleReduce
    };
    var code = e.code || e.key;

    if (keyEvent[code] !== void 0) {
      keyEvent[code](e);
    }

    (_props$onKeydown = props.onKeydown) === null || _props$onKeydown === void 0 ? void 0 : _props$onKeydown.call(props, value2, ctx);
  };

  var handleKeyup = function handleKeyup(value2, ctx) {
    var _props$onKeyup;

    (_props$onKeyup = props.onKeyup) === null || _props$onKeyup === void 0 ? void 0 : _props$onKeyup.call(props, value2, ctx);
  };

  var handleKeypress = function handleKeypress(value2, ctx) {
    var _props$onKeypress;

    (_props$onKeypress = props.onKeypress) === null || _props$onKeypress === void 0 ? void 0 : _props$onKeypress.call(props, value2, ctx);
  };

  var handleEnter = function handleEnter(value2, ctx) {
    var _props$onEnter;

    setUserInput(getUserInput(value2));
    var newValue = _common_js_inputNumber_number.formatToNumber(value2, {
      decimalPlaces: props.decimalPlaces,
      largeNumber: props.largeNumber
    });

    if (newValue !== value2 && String(newValue) !== value2) {
      onChange(newValue, {
        type: "enter",
        e: ctx.e
      });
    }

    (_props$onEnter = props.onEnter) === null || _props$onEnter === void 0 ? void 0 : _props$onEnter.call(props, newValue, ctx);
  };

  var focus = function focus() {
    inputRef.current.focus();
  };

  var blur = function blur() {
    inputRef.current.blur();
  };

  var listeners = {
    onBlur: handleBlur,
    onFocus: handleFocus,
    onKeydown: handleKeydown,
    onKeyup: handleKeyup,
    onKeypress: handleKeypress,
    onEnter: handleEnter,
    onClick: focus
  };
  return {
    classPrefix: classPrefix,
    wrapClasses: wrapClasses,
    reduceClasses: reduceClasses,
    addClasses: addClasses,
    inputRef: inputRef,
    listeners: listeners,
    displayValue: displayValue,
    setDisplayValue: setDisplayValue,
    isError: isError,
    setIsError: setIsError,
    userInput: userInput,
    setUserInput: setUserInput,
    value: value,
    focus: focus,
    blur: blur,
    onChange: onChange,
    handleReduce: handleReduce,
    handleAdd: handleAdd,
    onInnerInputChange: onInnerInputChange
  };
}

exports["default"] = useInputNumber;
//# sourceMappingURL=useInputNumber.js.map
