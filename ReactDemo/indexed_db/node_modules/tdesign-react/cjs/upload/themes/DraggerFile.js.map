{"version":3,"file":"DraggerFile.js","sources":["../../../src/upload/themes/DraggerFile.tsx"],"sourcesContent":["import React, { FC, MouseEvent, useMemo, useRef } from 'react';\nimport classNames from 'classnames';\nimport {\n  CheckCircleFilledIcon as TdCheckCircleFilledIcon,\n  ErrorCircleFilledIcon as TdErrorCircleFilledIcon,\n} from 'tdesign-icons-react';\nimport { abridgeName, getFileSizeText, getCurrentDate } from '../../_common/js/upload/utils';\nimport { TdUploadProps, UploadFile } from '../type';\nimport Button from '../../button';\nimport { CommonDisplayFileProps } from '../interface';\nimport useCommonClassName from '../../hooks/useCommonClassName';\nimport TLoading from '../../loading';\nimport useDrag, { UploadDragEvents } from '../hooks/useDrag';\nimport useGlobalIcon from '../../hooks/useGlobalIcon';\n\nexport interface DraggerProps extends CommonDisplayFileProps {\n  trigger?: TdUploadProps['trigger'];\n  triggerUpload?: () => void;\n  uploadFiles?: (toFiles?: UploadFile[]) => void;\n  cancelUpload?: (context: { e: MouseEvent<HTMLElement>; file: UploadFile }) => void;\n  dragEvents: UploadDragEvents;\n}\n\nconst DraggerFile: FC<DraggerProps> = (props) => {\n  const { displayFiles, locale, disabled } = props;\n\n  const { SIZE } = useCommonClassName();\n  const uploadPrefix = `${props.classPrefix}-upload`;\n\n  const drag = useDrag(props.dragEvents);\n  const { dragActive } = drag;\n\n  const draggerFileRef = useRef();\n\n  const { CheckCircleFilledIcon, ErrorCircleFilledIcon } = useGlobalIcon({\n    CheckCircleFilledIcon: TdCheckCircleFilledIcon,\n    ErrorCircleFilledIcon: TdErrorCircleFilledIcon,\n  });\n\n  const classes = useMemo(\n    () => [\n      `${uploadPrefix}__dragger`,\n      { [`${uploadPrefix}__dragger-center`]: !displayFiles[0] },\n      { [`${uploadPrefix}__dragger-error`]: displayFiles[0]?.status === 'fail' },\n    ],\n    [displayFiles, uploadPrefix],\n  );\n\n  const renderImage = () => {\n    const file = displayFiles[0];\n    if (!file) return null;\n    return <div className={`${uploadPrefix}__dragger-img-wrap`}>{file.url && <img src={file.url} />}</div>;\n  };\n\n  const renderUploading = () => {\n    const file = displayFiles[0];\n    if (!file) return null;\n    if (file.status === 'progress') {\n      return (\n        <div className={`${uploadPrefix}__single-progress`}>\n          <TLoading />\n          <span className={`${uploadPrefix}__single-percent`}>{file.percent}%</span>\n        </div>\n      );\n    }\n  };\n\n  const renderMainPreview = () => {\n    const file = displayFiles[0];\n    if (!file) return null;\n    return (\n      <div className={`${uploadPrefix}__dragger-progress`}>\n        {props.theme === 'image' && renderImage()}\n        <div className={`${uploadPrefix}__dragger-progress-info`}>\n          <div className={`${uploadPrefix}__dragger-text`}>\n            <span className={`${uploadPrefix}__single-name`}>{abridgeName(file.name)}</span>\n            {file.status === 'progress' && renderUploading()}\n            {file.status === 'success' && <CheckCircleFilledIcon />}\n            {file.status === 'fail' && <ErrorCircleFilledIcon />}\n          </div>\n          <small className={`${SIZE.small}`}>\n            {locale.file.fileSizeText}：{getFileSizeText(file.size)}\n          </small>\n          <small className={`${SIZE.small}`}>\n            {locale.file.fileOperationDateText}：{file.uploadTime || getCurrentDate()}\n          </small>\n          <div className={`${uploadPrefix}__dragger-btns`}>\n            {['progress', 'waiting'].includes(file.status) && !disabled && (\n              <Button\n                theme=\"primary\"\n                variant=\"text\"\n                className={`${uploadPrefix}__dragger-progress-cancel`}\n                onClick={(e) =>\n                  props.cancelUpload?.({\n                    e,\n                    file: props.toUploadFiles[0] || props.files[0],\n                  })\n                }\n              >\n                {locale?.cancelUploadText}\n              </Button>\n            )}\n            {!props.autoUpload && file.status === 'waiting' && (\n              <Button\n                variant=\"text\"\n                theme=\"primary\"\n                disabled={disabled}\n                onClick={() => props.uploadFiles?.()}\n                className={`${uploadPrefix}__dragger-upload-btn`}\n              >\n                {locale.triggerUploadText.normal}\n              </Button>\n            )}\n          </div>\n          {['fail', 'success'].includes(file?.status) && !disabled && (\n            <div className={`${uploadPrefix}__dragger-btns`}>\n              <Button\n                theme=\"primary\"\n                variant=\"text\"\n                disabled={disabled}\n                className={`${uploadPrefix}__dragger-progress-cancel`}\n                onClick={props.triggerUpload}\n              >\n                {locale.triggerUploadText.reupload}\n              </Button>\n              <Button\n                theme=\"danger\"\n                variant=\"text\"\n                disabled={disabled}\n                className={`${uploadPrefix}__dragger-delete-btn`}\n                onClick={(e) => props.onRemove({ e, index: 0, file })}\n              >\n                {locale.triggerUploadText.delete}\n              </Button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  const renderDefaultDragElement = () => {\n    const unActiveElement = (\n      <div>\n        <span className={`${uploadPrefix}--highlight`}>{locale.triggerUploadText?.normal}</span>\n        <span>&nbsp;&nbsp;/&nbsp;&nbsp;{locale.dragger.draggingText}</span>\n      </div>\n    );\n    const activeElement = <div>{locale.dragger.dragDropText}</div>;\n    return dragActive ? activeElement : unActiveElement;\n  };\n\n  const getContent = () => {\n    const file = displayFiles[0];\n    if (file && ['progress', 'success', 'fail', 'waiting'].includes(file.status)) {\n      return renderMainPreview();\n    }\n    return (\n      <div className={`${uploadPrefix}__trigger`} onClick={props.triggerUpload}>\n        {props.children || renderDefaultDragElement()}\n      </div>\n    );\n  };\n\n  return (\n    <div\n      ref={draggerFileRef}\n      className={classNames(classes)}\n      onDrop={drag.handleDrop}\n      onDragEnter={drag.handleDragenter}\n      onDragOver={drag.handleDragover}\n      onDragLeave={drag.handleDragleave}\n    >\n      {props.trigger?.({ files: displayFiles, dragActive }) || getContent()}\n    </div>\n  );\n};\n\nDraggerFile.displayName = 'DraggerFile';\n\nexport default DraggerFile;\n"],"names":["DraggerFile","props","displayFiles","locale","disabled","useCommonClassName","SIZE","uploadPrefix","classPrefix","drag","useDrag","dragEvents","dragActive","draggerFileRef","useRef","useGlobalIcon","CheckCircleFilledIcon","TdCheckCircleFilledIcon","ErrorCircleFilledIcon","TdErrorCircleFilledIcon","classes","useMemo","_defineProperty","status","renderImage","file","React","createElement","className","url","src","renderUploading","TLoading","percent","renderMainPreview","theme","abridgeName","name","small","fileSizeText","getFileSizeText","size","fileOperationDateText","uploadTime","getCurrentDate","includes","Button","variant","onClick","e","cancelUpload","toUploadFiles","files","cancelUploadText","autoUpload","uploadFiles","triggerUploadText","normal","triggerUpload","reupload","onRemove","index","renderDefaultDragElement","unActiveElement","dragger","draggingText","activeElement","dragDropText","getContent","children","ref","classNames","onDrop","handleDrop","onDragEnter","handleDragenter","onDragOver","handleDragover","onDragLeave","handleDragleave","trigger","displayName"],"mappings":"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"}