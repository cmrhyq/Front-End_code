{"version":3,"file":"upload.js","sources":["../../src/upload/upload.tsx"],"sourcesContent":["import React, { forwardRef } from 'react';\nimport { UploadIcon } from 'tdesign-icons-react';\nimport classNames from 'classnames';\nimport NormalFile from './themes/NormalFile';\nimport DraggerFile from './themes/DraggerFile';\nimport ImageCard from './themes/ImageCard';\nimport MultipleFlowList from './themes/MultipleFlowList';\nimport useUpload from './hooks/useUpload';\nimport Button from '../button';\nimport { uploadDefaultProps } from './defaultProps';\nimport { CommonDisplayFileProps, UploadProps } from './interface';\nimport { UploadDragEvents } from './hooks/useDrag';\nimport CustomFile from './themes/CustomFile';\n\nconst Upload = forwardRef((props: UploadProps, ref) => {\n  const { theme } = props;\n  const {\n    locale,\n    classPrefix,\n    triggerUploadText,\n    toUploadFiles,\n    displayFiles,\n    uploadValue,\n    sizeOverLimitMessage,\n    uploading,\n    tipsClasses,\n    errorClasses,\n    inputRef,\n    disabled,\n    onRemove,\n    uploadFiles,\n    onNormalFileChange,\n    onDragFileChange,\n    triggerUpload,\n    cancelUpload,\n  } = useUpload(props);\n\n  React.useImperativeHandle(ref, () => ({\n    upload: inputRef.current,\n    uploading,\n    triggerUpload,\n    uploadFiles,\n  }));\n\n  const renderTrigger = () => {\n    const getDefaultTrigger = () => {\n      if (theme === 'file-input') {\n        return (\n          <Button disabled={props.disabled} variant=\"outline\" {...props.triggerButtonProps}>\n            {triggerUploadText}\n          </Button>\n        );\n      }\n      return (\n        <Button disabled={props.disabled} variant=\"outline\" icon={<UploadIcon />} {...props.triggerButtonProps}>\n          {triggerUploadText}\n        </Button>\n      );\n    };\n    return props.trigger || props.children || getDefaultTrigger();\n  };\n\n  const triggerElement = renderTrigger();\n\n  const commonDisplayFileProps: CommonDisplayFileProps = {\n    files: uploadValue,\n    toUploadFiles,\n    displayFiles,\n    theme,\n    placeholder: props.placeholder,\n    disabled: props.disabled,\n    tips: props.tips,\n    sizeOverLimitMessage,\n    uploading,\n    classPrefix,\n    tipsClasses,\n    errorClasses,\n    locale,\n    autoUpload: props.autoUpload,\n    fileListDisplay: props.fileListDisplay,\n    onRemove,\n  };\n\n  const dragProps: UploadDragEvents = {\n    onDragFileChange,\n    onDragenter: props.onDragenter,\n    onDragleave: props.onDragleave,\n    onDrop: props.onDrop,\n  };\n\n  const getNormalFileNode = () => (\n    <NormalFile {...commonDisplayFileProps} multiple={props.multiple}>\n      <div className={`${classPrefix}-upload__trigger`} onClick={triggerUpload}>\n        {triggerElement}\n      </div>\n    </NormalFile>\n  );\n\n  const getSingleFileDraggerUploadNode = () => (\n    <DraggerFile\n      {...commonDisplayFileProps}\n      dragEvents={dragProps}\n      trigger={props.trigger}\n      cancelUpload={cancelUpload}\n      triggerUpload={triggerUpload}\n      uploadFiles={uploadFiles}\n    />\n  );\n\n  const getImageCardUploadNode = () => (\n    <ImageCard\n      {...commonDisplayFileProps}\n      multiple={props.multiple}\n      max={props.max}\n      showUploadProgress={props.showUploadProgress}\n      triggerUpload={triggerUpload}\n      uploadFiles={uploadFiles}\n      cancelUpload={cancelUpload}\n      onPreview={props.onPreview}\n    />\n  );\n\n  const getFlowListNode = () => (\n    <MultipleFlowList\n      {...commonDisplayFileProps}\n      isBatchUpload={props.isBatchUpload}\n      draggable={props.draggable}\n      dragEvents={dragProps}\n      uploadFiles={uploadFiles}\n      cancelUpload={cancelUpload}\n      onPreview={props.onPreview}\n    >\n      <div className={`${classPrefix}-upload__trigger`} onClick={triggerUpload}>\n        {triggerElement}\n      </div>\n    </MultipleFlowList>\n  );\n\n  const getCustomFile = () => (\n    <CustomFile\n      {...commonDisplayFileProps}\n      draggable={props.draggable}\n      dragContent={props.dragContent}\n      dragEvents={dragProps}\n      triggerUpload={triggerUpload}\n      childrenNode={props.children}\n      trigger={props.trigger}\n    >\n      {triggerElement}\n    </CustomFile>\n  );\n\n  return (\n    <div className={classNames([props.className, `${classPrefix}-upload`])} style={props.style}>\n      <input\n        ref={inputRef}\n        type=\"file\"\n        disabled={disabled}\n        onChange={onNormalFileChange}\n        multiple={props.multiple}\n        accept={props.accept}\n        hidden\n      />\n      {['file', 'file-input'].includes(theme) && !props.draggable && getNormalFileNode()}\n      {['file', 'image'].includes(theme) && props.draggable && getSingleFileDraggerUploadNode()}\n      {theme === 'image' && !props.draggable && getImageCardUploadNode()}\n      {['image-flow', 'file-flow'].includes(theme) && getFlowListNode()}\n      {theme === 'custom' && getCustomFile()}\n    </div>\n  );\n});\n\nUpload.displayName = 'Upload';\n\nUpload.defaultProps = uploadDefaultProps;\n\nexport default Upload;\n"],"names":["Upload","forwardRef","props","ref","theme","useUpload","locale","classPrefix","triggerUploadText","toUploadFiles","displayFiles","uploadValue","sizeOverLimitMessage","uploading","tipsClasses","errorClasses","inputRef","disabled","onRemove","uploadFiles","onNormalFileChange","onDragFileChange","triggerUpload","cancelUpload","React","useImperativeHandle","upload","current","renderTrigger","getDefaultTrigger","createElement","Button","variant","triggerButtonProps","icon","UploadIcon","trigger","children","triggerElement","commonDisplayFileProps","files","placeholder","tips","autoUpload","fileListDisplay","dragProps","onDragenter","onDragleave","onDrop","getNormalFileNode","NormalFile","multiple","className","onClick","getSingleFileDraggerUploadNode","DraggerFile","dragEvents","getImageCardUploadNode","ImageCard","max","showUploadProgress","onPreview","getFlowListNode","MultipleFlowList","isBatchUpload","draggable","getCustomFile","CustomFile","dragContent","childrenNode","classNames","style","type","onChange","accept","hidden","includes","displayName","defaultProps","uploadDefaultProps"],"mappings":"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"}