{"version":3,"file":"dom.js","sources":["../../src/_util/dom.ts"],"sourcesContent":["import raf from 'raf';\nimport isString from 'lodash/isString';\nimport { easeInOutCubic, EasingFunction } from './easing';\nimport { ScrollContainer, ScrollContainerElement } from '../common';\n\n// 用于判断是否可使用 dom\nexport const canUseDocument = !!(typeof window !== 'undefined' && window.document && window.document.createElement);\n\nconst trim = (str: string): string => (str || '').replace(/^[\\s\\uFEFF]+|[\\s\\uFEFF]+$/g, '');\n\nexport const on = ((): any => {\n  if (canUseDocument && document.addEventListener) {\n    return (element: Node, event: string, handler: EventListenerOrEventListenerObject): any => {\n      if (element && event && handler) {\n        element.addEventListener(event, handler, false);\n      }\n    };\n  }\n  return (element: Node, event: string, handler: EventListenerOrEventListenerObject): any => {\n    if (element && event && handler) {\n      (element as any).attachEvent(`on${event}`, handler);\n    }\n  };\n})();\n\nexport const off = ((): any => {\n  if (canUseDocument && document.removeEventListener) {\n    return (element: Node, event: string, handler: EventListenerOrEventListenerObject): any => {\n      if (element && event) {\n        element.removeEventListener(event, handler, false);\n      }\n    };\n  }\n  return (element: Node, event: string, handler: EventListenerOrEventListenerObject): any => {\n    if (element && event) {\n      (element as any).detachEvent(`on${event}`, handler);\n    }\n  };\n})();\n\nexport function hasClass(el: Element, cls: string) {\n  if (!el || !cls) return false;\n  if (cls.indexOf(' ') !== -1) throw new Error('className should not contain space.');\n  if (el.classList) {\n    return el.classList.contains(cls);\n  }\n  return ` ${el.className} `.indexOf(` ${cls} `) > -1;\n}\n\nexport const addClass = function (el: Element, cls: string) {\n  if (!el) return;\n  let curClass = el.className;\n  const classes = (cls || '').split(' ');\n\n  for (let i = 0, j = classes.length; i < j; i++) {\n    const clsName = classes[i];\n    if (!clsName) continue;\n\n    if (el.classList) {\n      el.classList.add(clsName);\n    } else if (!hasClass(el, clsName)) {\n      curClass += ` ${clsName}`;\n    }\n  }\n  if (!el.classList) {\n    // eslint-disable-next-line\n    el.className = curClass;\n  }\n};\n\nexport const removeClass = function (el: Element, cls: string) {\n  if (!el || !cls) return;\n  const classes = cls.split(' ');\n  let curClass = ` ${el.className} `;\n\n  for (let i = 0, j = classes.length; i < j; i++) {\n    const clsName = classes[i];\n    if (!clsName) continue;\n\n    if (el.classList) {\n      el.classList.remove(clsName);\n    } else if (hasClass(el, clsName)) {\n      curClass = curClass.replace(` ${clsName} `, ' ');\n    }\n  }\n  if (!el.classList) {\n    // eslint-disable-next-line\n    el.className = trim(curClass);\n  }\n};\n\n/**\n * 获取滚动容器\n * 因为 document 不存在 scroll 等属性, 因此排除 document\n * window | HTMLElement\n * @param {ScrollContainerElement} [container='body']\n * @returns {ScrollContainer}\n */\nexport const getScrollContainer = (container: ScrollContainer = 'body'): ScrollContainerElement => {\n  if (isString(container)) {\n    return container ? (document.querySelector(container) as HTMLElement) : window;\n  }\n  if (typeof container === 'function') {\n    return container();\n  }\n  return container;\n};\n\n/**\n * 返回是否 window 对象\n *\n * @export\n * @param {any} obj\n * @returns\n */\nfunction isWindow(obj: any) {\n  return obj && obj === obj.window;\n}\n\ntype ScrollTarget = HTMLElement | Window | Document;\n\n/**\n * 获取滚动距离\n *\n * @export\n * @param {ScrollTarget} target\n * @param {boolean} isLeft true 为获取 scrollLeft, false 为获取 scrollTop\n * @returns {number}\n */\nexport function getScroll(target: ScrollTarget, isLeft?: boolean): number {\n  // node 环境或者 target 为空\n  if (typeof window === 'undefined' || !target) {\n    return 0;\n  }\n  const method = isLeft ? 'scrollLeft' : 'scrollTop';\n  let result = 0;\n  if (isWindow(target)) {\n    result = (target as Window)[isLeft ? 'pageXOffset' : 'pageYOffset'];\n  } else if (target instanceof Document) {\n    result = target.documentElement[method];\n  } else if (target) {\n    result = (target as HTMLElement)[method];\n  }\n  return result;\n}\ninterface ScrollTopOptions {\n  container?: ScrollTarget;\n  duration?: number;\n  easing?: EasingFunction;\n}\n\nexport function scrollTo(target: number, opt: ScrollTopOptions) {\n  const { container = window, duration = 450, easing = easeInOutCubic } = opt;\n  const scrollTop = getScroll(container);\n  const startTime = Date.now();\n  return new Promise((res) => {\n    const fnc = () => {\n      const timestamp = Date.now();\n      const time = timestamp - startTime;\n      const nextScrollTop = easing(Math.min(time, duration), scrollTop, target, duration);\n      if (isWindow(container)) {\n        (container as Window).scrollTo(window.pageXOffset, nextScrollTop);\n      } else if (container instanceof HTMLDocument || container.constructor.name === 'HTMLDocument') {\n        (container as HTMLDocument).documentElement.scrollTop = nextScrollTop;\n      } else {\n        (container as HTMLElement).scrollTop = nextScrollTop;\n      }\n      if (time < duration) {\n        raf(fnc);\n      } else {\n        // 由于上面步骤设置了 scrollTop, 滚动事件可能未触发完毕\n        // 此时应该在下一帧再执行 res\n        raf(res);\n      }\n    };\n    raf(fnc);\n  });\n}\n\n// 用于判断节点内容是否溢出\nexport const isNodeOverflow = (ele: Element | Element[]): boolean => {\n  const { clientWidth = 0, scrollWidth = 0 } = ele as Element & { clientWidth: number; scrollWidth: number };\n\n  if (scrollWidth > clientWidth) {\n    return true;\n  }\n  return false;\n};\n\nexport const getAttach = (node: any): HTMLElement => {\n  const attachNode = typeof node === 'function' ? node() : node;\n  if (!attachNode) {\n    return document.body;\n  }\n  if (isString(attachNode)) {\n    return document.querySelector(attachNode);\n  }\n  if (attachNode instanceof HTMLElement) {\n    return attachNode;\n  }\n  return document.body;\n};\n\n// 获取 css vars\nexport const getCssVarsValue = (name: string, element?: HTMLElement) => {\n  if (!canUseDocument) return;\n\n  const el = element || document.documentElement;\n  return getComputedStyle(el).getPropertyValue(name);\n};\n"],"names":["canUseDocument","window","document","createElement","trim","str","replace","on","addEventListener","element","event","handler","attachEvent","off","removeEventListener","detachEvent","hasClass","el","cls","indexOf","Error","classList","contains","className","addClass","curClass","classes","split","i","j","length","clsName","add","removeClass","remove","getScrollContainer","container","isString","querySelector","isWindow","obj","getScroll","target","isLeft","method","result","Document","documentElement","scrollTo","opt","duration","easing","easeInOutCubic","scrollTop","startTime","Date","now","Promise","res","fnc","timestamp","time","nextScrollTop","Math","min","pageXOffset","HTMLDocument","constructor","name","raf","isNodeOverflow","ele","clientWidth","scrollWidth","getAttach","node","attachNode","body","HTMLElement","getCssVarsValue","getComputedStyle","getPropertyValue"],"mappings":";;;;;;;;;;;;;;;;;;;;;;IAMaA,cAAA,GAAiB,CAAC,EAAE,OAAOC,MAAP,KAAkB,WAAlB,IAAiCA,MAAA,CAAOC,QAAxC,IAAoDD,MAAA,CAAOC,QAAP,CAAgBC,aAAtE,EAAlB;;AAEb,IAAMC,OAAO,SAAPA,IAAO,CAACC,GAAD,EAAA;EAAA,OAAC,CAAyBA,OAAO,EAAhC,EAAoCC,OAApC,CAA4C,4BAA5C,EAA0E,EAA1E,CAAD,CAAA;AAAA,CAAb,CAAA;;AAEO,IAAMC,KAAM,YAAW;AACxB,EAAA,IAAAP,cAAA,IAAkBE,SAASM,gBAA3B,EAA6C;AACxC,IAAA,OAAA,UAACC,OAAD,EAAgBC,KAAhB,EAA+BC,OAA/B,EAAoF;AACrF,MAAA,IAAAF,OAAA,IAAWC,KAAX,IAAoBC,OAApB,EAA6B;AACvBF,QAAAA,OAAA,CAAAD,gBAAA,CAAiBE,KAAjB,EAAwBC,OAAxB,EAAiC,KAAjC,CAAA,CAAA;AACV,OAAA;KAHK,CAAA;AAKT,GAAA;;AACO,EAAA,OAAA,UAACF,OAAD,EAAgBC,KAAhB,EAA+BC,OAA/B,EAAoF;AACrF,IAAA,IAAAF,OAAA,IAAWC,KAAX,IAAoBC,OAApB,EAA6B;AAC9BF,MAAAA,OAAgB,CAAAG,WAAhB,CAAiCF,IAAAA,CAAAA,MAAAA,CAAAA,KAAjC,GAA0CC,OAA1C,CAAA,CAAA;AACH,KAAA;GAHK,CAAA;AAKN,IAbI;AAeA,IAAME,MAAO,YAAW;AACzB,EAAA,IAAAb,cAAA,IAAkBE,SAASY,mBAA3B,EAAgD;AAC3C,IAAA,OAAA,UAACL,OAAD,EAAgBC,KAAhB,EAA+BC,OAA/B,EAAoF;MACzF,IAAIF,WAAWC,KAAf,EAAsB;AACZD,QAAAA,OAAA,CAAAK,mBAAA,CAAoBJ,KAApB,EAA2BC,OAA3B,EAAoC,KAApC,CAAA,CAAA;AACV,OAAA;KAHK,CAAA;AAKT,GAAA;;AACO,EAAA,OAAA,UAACF,OAAD,EAAgBC,KAAhB,EAA+BC,OAA/B,EAAoF;IACzF,IAAIF,WAAWC,KAAf,EAAsB;AACnBD,MAAAA,OAAgB,CAAAM,WAAhB,CAAiCL,IAAAA,CAAAA,MAAAA,CAAAA,KAAjC,GAA0CC,OAA1C,CAAA,CAAA;AACH,KAAA;GAHK,CAAA;AAKN,IAbI;AAeS,SAAAK,QAAA,CAASC,EAAT,EAAsBC,GAAtB,EAAmC;AAC7C,EAAA,IAAA,CAACD,EAAD,IAAO,CAACC,GAAR,EAAoB,OAAA,KAAA,CAAA;AACpB,EAAA,IAAAA,GAAA,CAAIC,OAAJ,CAAY,GAAZ,CAAqB,KAAA,CAAA,CAArB,EAA+B,MAAA,IAAIC,KAAJ,CAAU,qCAAV,CAAA,CAAA;;EACnC,IAAIH,GAAGI,SAAP,EAAkB;AACT,IAAA,OAAAJ,EAAA,CAAGI,SAAH,CAAaC,QAAb,CAAsBJ,GAAtB,CAAA,CAAA;AACT,GAAA;;EACA,OAAO,GAAA,CAAA,MAAA,CAAID,EAAG,CAAAM,SAAP,EAAA,GAAA,CAAA,CAAoBJ,OAApB,CAAgCD,GAAAA,CAAAA,MAAAA,CAAAA,GAAhC,EAA0C,GAAA,CAAA,CAAA,GAAA,CAAA,CAAjD,CAAA;AACF,CAAA;AAEa,IAAAM,QAAA,GAAW,SAAXA,QAAW,CAAUP,EAAV,EAAuBC,GAAvB,EAAoC;EAC1D,IAAI,CAACD,EAAL,EAAS,OAAA;AACT,EAAA,IAAIQ,WAAWR,EAAG,CAAAM,SAAlB,CAAA;EACA,IAAMG,OAAW,GAAA,CAAAR,GAAA,IAAO,EAAP,EAAWS,KAAX,CAAiB,GAAjB,CAAjB,CAAA;;AAEA,EAAA,KAAA,IAASC,IAAI,CAAb,EAAgBC,CAAA,GAAIH,QAAQI,MAA5B,EAAoCF,CAAA,GAAIC,CAAxC,EAA2CD,CAAK,EAAhD,EAAgD;AAC9C,IAAA,IAAMG,UAAUL,OAAQ,CAAAE,CAAA,CAAxB,CAAA;IACA,IAAI,CAACG,OAAL,EAAc,SAAA;;IAEd,IAAId,GAAGI,SAAP,EAAkB;AACbJ,MAAAA,EAAA,CAAAI,SAAA,CAAUW,GAAV,CAAcD,OAAd,CAAA,CAAA;KADL,MAEW,IAAA,CAACf,QAAS,CAAAC,EAAA,EAAIc,OAAJ,CAAV,EAAwB;MACjCN,QAAA,IAAA,GAAA,CAAA,MAAA,CAAgBM,OAAhB,CAAA,CAAA;AACF,KAAA;AACF,GAAA;;AACI,EAAA,IAAA,CAACd,GAAGI,SAAJ,EAAe;IAEjBJ,EAAA,CAAGM,SAAH,GAAeE,QAAf,CAAA;AACF,GAAA;AACF,EAnBa;AAqBA,IAAAQ,WAAA,GAAc,SAAdA,WAAc,CAAUhB,EAAV,EAAuBC,GAAvB,EAAoC;AACzD,EAAA,IAAA,CAACD,EAAD,IAAO,CAACC,GAAR,EAAa,OAAA;AACX,EAAA,IAAAQ,OAAA,GAAUR,GAAI,CAAAS,KAAJ,CAAU,GAAV,CAAV,CAAA;AACF,EAAA,IAAAF,QAAA,GAAA,GAAA,CAAA,MAAA,CAAeR,EAAG,CAAAM,SAAlB,EAAA,GAAA,CAAA,CAAA;;AAEJ,EAAA,KAAA,IAASK,IAAI,CAAb,EAAgBC,CAAA,GAAIH,QAAQI,MAA5B,EAAoCF,CAAA,GAAIC,CAAxC,EAA2CD,CAAK,EAAhD,EAAgD;AAC9C,IAAA,IAAMG,UAAUL,OAAQ,CAAAE,CAAA,CAAxB,CAAA;IACA,IAAI,CAACG,OAAL,EAAc,SAAA;;IAEd,IAAId,GAAGI,SAAP,EAAkB;AACbJ,MAAAA,EAAA,CAAAI,SAAA,CAAUa,MAAV,CAAiBH,OAAjB,CAAA,CAAA;KADL,MAEW,IAAAf,QAAA,CAASC,EAAT,EAAac,OAAb,CAAA,EAAuB;MAChCN,QAAA,GAAWA,QAAS,CAAAnB,OAAT,YAAqByB,OAArB,EAAA,GAAA,CAAA,EAAiC,GAAjC,CAAX,CAAA;AACF,KAAA;AACF,GAAA;;AACI,EAAA,IAAA,CAACd,GAAGI,SAAJ,EAAe;AAEdJ,IAAAA,EAAA,CAAAM,SAAA,GAAYnB,KAAKqB,SAAjB,CAAA;AACL,GAAA;AACF,EAnBa;AA4BAU,IAAAA,kBAAA,GAAqB,SAArBA,kBAAqB,GAAiE;EAAA,IAAhEC,SAAgE,uEAAnC,MAAmC,CAAA;;AAC7F,EAAA,IAAAC,mBAAA,CAASD,SAAT,CAAA,EAAqB;IACvB,OAAOA,SAAa,GAAAlC,QAAA,CAASoC,aAAT,CAAuBF,SAAvB,CAAA,GAAoDnC,MAAxE,CAAA;AACF,GAAA;;AACI,EAAA,IAAA,OAAOmC,SAAP,KAAqB,UAArB,EAAiC;AACnC,IAAA,OAAOA,SAAU,EAAjB,CAAA;AACF,GAAA;;AACO,EAAA,OAAAA,SAAA,CAAA;AACT,EARa;;AAiBb,SAASG,QAAT,CAAkBC,GAAlB,EAA4B;AACnB,EAAA,OAAAA,GAAA,IAAOA,QAAQA,GAAI,CAAAvC,MAAnB,CAAA;AACT,CAAA;;AAYgB,SAAAwC,SAAA,CAAUC,MAAV,EAAgCC,MAAhC,EAA0D;AAExE,EAAA,IAAI,OAAO1C,MAAP,KAAkB,WAAlB,IAAiC,CAACyC,MAAtC,EAA8C;AACrC,IAAA,OAAA,CAAA,CAAA;AACT,GAAA;;AACM,EAAA,IAAAE,MAAA,GAASD,SAAS,eAAe,WAAjC,CAAA;EACN,IAAIE,MAAS,GAAA,CAAb,CAAA;;AACI,EAAA,IAAAN,QAAA,CAASG,MAAT,CAAA,EAAkB;IACVG,MAAA,GAAAH,MAAA,CAAkBC,SAAS,gBAAgB,aAA3C,CAAA,CAAA;AACZ,GAFI,MAEJ,IAAWD,kBAAkBI,QAA7B,EAAuC;AACrCD,IAAAA,MAAA,GAASH,OAAOK,eAAP,CAAuBH,MAAvB,CAAT,CAAA;GADF,UAEWF,QAAQ;AACjBG,IAAAA,MAAA,GAAUH,MAAuB,CAAAE,MAAA,CAAjC,CAAA;AACF,GAAA;;AACO,EAAA,OAAAC,MAAA,CAAA;AACT,CAAA;AAOgB,SAAAG,QAAA,CAASN,MAAT,EAAyBO,GAAzB,EAAgD;EAC9D,IAAwEA,cAAAA,GAAAA,GAAxE,CAAQb,SAAR;MAAQA,SAAR,+BAAoBnC,MAApB,GAAA,cAAA;MAAwEgD,aAAAA,GAAAA,GAAxE,CAA4BC,QAA5B;MAA4BA,QAA5B,8BAAuC,GAAvC,GAAA,aAAA;MAAwED,WAAAA,GAAAA,GAAxE,CAA4CE,MAA5C;MAA4CA,MAA5C,4BAAqDC,2BAArD,GAAA,WAAA,CAAA;AACM,EAAA,IAAAC,SAAA,GAAYZ,UAAUL,UAAtB,CAAA;AACA,EAAA,IAAAkB,SAAA,GAAYC,KAAKC,GAAL,EAAZ,CAAA;AACC,EAAA,OAAA,IAAIC,OAAJ,CAAY,UAACC,GAAD,EAAS;AAC1B,IAAA,IAAMC,MAAM,SAANA,GAAM,GAAM;AACV,MAAA,IAAAC,SAAA,GAAYL,KAAKC,GAAL,EAAZ,CAAA;AACN,MAAA,IAAMK,OAAOD,SAAY,GAAAN,SAAzB,CAAA;AACM,MAAA,IAAAQ,aAAA,GAAgBX,OAAOY,IAAK,CAAAC,GAAL,CAASH,IAAT,EAAeX,QAAf,GAA0BG,WAAWX,QAAQQ,SAApE,CAAA;;AACF,MAAA,IAAAX,QAAA,CAASH,SAAT,CAAA,EAAqB;AACtBA,QAAAA,SAAqB,CAAAY,QAArB,CAA8B/C,MAAO,CAAAgE,WAArC,EAAkDH,aAAlD,CAAA,CAAA;OADC,UAEO1B,SAAqB,YAAA8B,YAArB,IAAqC9B,SAAU,CAAA+B,WAAV,CAAsBC,IAAtB,KAA+B,gBAAgB;AAC5FhC,QAAAA,SAAA,CAA2BW,eAA3B,CAA2CM,SAA3C,GAAuDS,aAAvD,CAAA;AACI,aAAA;QACJ1B,UAA0BiB,SAA1B,GAAsCS,aAAtC,CAAA;AACH,OAAA;;MACA,IAAID,OAAOX,QAAX,EAAqB;QACnBmB,uBAAA,CAAIV,GAAJ,CAAA,CAAA;AACK,OAFP,MAEO;QAGLU,uBAAA,CAAIX,GAAJ,CAAA,CAAA;AACF,OAAA;KAjBF,CAAA;;IAmBAW,uBAAA,CAAIV,GAAJ,CAAA,CAAA;AACD,GArBM,CAAA,CAAA;AAsBT,CAAA;IAGaW,cAAA,GAAiB,SAAjBA,cAAiB,CAACC,GAAD,EAAuC;EACnE,IAA6CA,gBAAAA,GAAAA,GAA7C,CAAQC,WAAR;MAAQA,WAAR,iCAAsB,CAAtB,GAAA,gBAAA;MAA6CD,gBAAAA,GAAAA,GAA7C,CAAyBE,WAAzB;MAAyBA,WAAzB,iCAAuC,CAAvC,GAAA,gBAAA,CAAA;;EAEA,IAAIA,cAAcD,WAAlB,EAA+B;AACtB,IAAA,OAAA,IAAA,CAAA;AACT,GAAA;;AACO,EAAA,OAAA,KAAA,CAAA;AACT,EAPa;IASAE,SAAA,GAAY,SAAZA,SAAY,CAACC,IAAD,EAA4B;EACnD,IAAMC,UAAa,GAAA,OAAOD,IAAP,KAAgB,UAAhB,GAA6BA,MAA7B,GAAsCA,IAAzD,CAAA;;EACA,IAAI,CAACC,UAAL,EAAiB;IACf,OAAO1E,QAAS,CAAA2E,IAAhB,CAAA;AACF,GAAA;;AACI,EAAA,IAAAxC,mBAAA,CAASuC,UAAT,CAAA,EAAsB;AACjB,IAAA,OAAA1E,QAAA,CAASoC,aAAT,CAAuBsC,UAAvB,CAAA,CAAA;AACT,GAAA;;EACA,IAAIA,sBAAsBE,WAA1B,EAAuC;AAC9B,IAAA,OAAAF,UAAA,CAAA;AACT,GAAA;;EACA,OAAO1E,QAAS,CAAA2E,IAAhB,CAAA;AACF,EAZa;AAeA,IAAAE,eAAA,GAAkB,SAAlBA,eAAkB,CAACX,IAAD,EAAe3D,OAAf,EAAyC;EACtE,IAAI,CAACT,cAAL,EAAqB,OAAA;AAEf,EAAA,IAAAiB,EAAA,GAAKR,WAAWP,QAAS,CAAA6C,eAAzB,CAAA;EACN,OAAOiC,gBAAiB,CAAA/D,EAAA,CAAjB,CAAqBgE,gBAArB,CAAsCb,IAAtC,CAAP,CAAA;AACF;;;;;;;;;;;;;;;"}